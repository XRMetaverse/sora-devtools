(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{4268:function(e,t,n){"use strict";n.d(t,{o1:function(){return o},xR:function(){return a},Sh:function(){return i},Q5:function(){return s},Vf:function(){return r},hJ:function(){return c},YX:function(){return u},cJ:function(){return d},w_:function(){return l},n4:function(){return p},Xr:function(){return f},I7:function(){return g},WJ:function(){return h},l9:function(){return m},kt:function(){return v},lt:function(){return y}});var o=["","OPUS"],a=["","8","16","24","32","64","96","128","256"],i=["","VP8","VP9","H264","H265","AV1"],s=["","10","30","50","100","300","500","800","1000","1500","2000","2500","3000","5000","10000","15000","20000","30000","50000"],r=["","UHD 4096x2160","UHD 3840x2160","3840x1920","FHD","HD","VGA","QVGA","HQVGA","QCIF","QQVGA"],c=["","VGA","QVGA"],u=["","60","30","24","20","15","10"],d=["","browser","system"],l=["getUserMedia","getDisplayMedia","fakeMedia"],p=["1","2","3","4","5","6","7","8","true"],f=["","1","2","3","4","5","6","7","8"],g=["","none","r0","r1","r2"],h=["","r0","r1","r2"],m=["","true","false"],v=["","true","false"],y='\nself.onmessage = (event) => {\n  const data = event.data;\n  if (data.type === "start") {\n    const interval = data.interval;\n    self.counter = 0;\n    const intervalId = setInterval(() => {\n      const message = { type: "update", counter: self.counter };\n      self.postMessage(message);\n      self.counter++;\n    }, interval);\n    self.intervalId = intervalId;\n  } else if (data.type === "stop") {\n    if (self.intervalId) {\n      clearInterval(self.intervalId);\n    }\n    const message = { type: "stop" };\n    self.postMessage(message);\n  }\n};\n'},3317:function(e,t,n){"use strict";n.d(t,{ZP:function(){return ve},b_:function(){return O},E1:function(){return R},i4:function(){return M},fL:function(){return b},S3:function(){return I},i8:function(){return V},du:function(){return F},$p:function(){return B},VY:function(){return G},PQ:function(){return U},hS:function(){return L},SV:function(){return W},yn:function(){return Z},cA:function(){return P},Xk:function(){return _},Gc:function(){return J},ew:function(){return H},pD:function(){return Q},I$:function(){return j},c0:function(){return T},LN:function(){return z},lW:function(){return X},pv:function(){return q},rY:function(){return Y},yq:function(){return $},vq:function(){return K},eW:function(){return ee},co:function(){return te},b3:function(){return ne},H_:function(){return D},pI:function(){return k},y5:function(){return oe},yC:function(){return ae},fj:function(){return ie},Ik:function(){return se},H6:function(){return re},vM:function(){return ce},sD:function(){return ue},CV:function(){return de},TT:function(){return le},qV:function(){return pe},ge:function(){return fe},as:function(){return ge},h2:function(){return he},lZ:function(){return me},qM:function(){return A},l4:function(){return N},Lb:function(){return w}});var o=n(809),a=n.n(o),i=n(4121),s=n(2447),r=n(6265),c=n(1355),u=n(2643),d=n(4268),l=n(8471),p={alertMessages:[],audio:!0,audioBitRate:"",audioCodecType:"",audioInput:"",audioInputDevices:[],audioOutput:"",audioOutputDevices:[],autoGainControl:!0,clientId:"",channelId:"sora",googCpuOveruseDetection:null,dataChannelMessages:[],debug:!1,debugType:"log",dataChannelSignaling:"",displayResolution:"",e2ee:!1,echoCancellation:!0,echoCancellationType:"",enabledDataChannel:!1,enabledCamera:!1,enabledClientId:!1,enabledMetadata:!1,enabledMic:!1,enabledSignalingNotifyMetadata:!1,fakeVolume:"0",fakeContents:{worker:null,colorCode:0,gainNode:null},frameRate:"",soraContents:{sora:null,connectionId:null,clientId:null,localMediaStream:null,remoteMediaStreams:[],prevStatsReport:[],statsReport:[]},ignoreDisconnectWebSocket:"",logMessages:[],mediaType:"getUserMedia",metadata:"",mute:!1,noiseSuppression:!0,notifyMessages:[],pushMessages:[],resolution:"",showStats:!1,signalingNotifyMetadata:"",signalingMessages:[],simulcastRid:"",spotlight:"2",spotlightNumber:"",spotlightFocusRid:"",spotlightUnfocusRid:"",spotlightConnectionIds:{},focusedSpotlightConnectionIds:{},video:!0,videoBitRate:"",videoCodecType:"",videoInput:"",videoInputDevices:[],version:JSON.parse('{"i8":"2021.1.0-canary.21"}').i8},f=(0,c.oM)({name:"soraDemo",initialState:p,reducers:{resetState:function(e){Object.assign(e,p)},setAudio:function(e,t){e.audio=t.payload},setAudioInput:function(e,t){e.audioInput=t.payload},setAudioOutput:function(e,t){e.audioOutput=t.payload},setAudioBitRate:function(e,t){e.audioBitRate=t.payload},setAudioCodecType:function(e,t){e.audioCodecType=t.payload},setAutoGainControl:function(e,t){e.autoGainControl=t.payload},setClientId:function(e,t){e.clientId=t.payload},setChannelId:function(e,t){e.channelId=t.payload},setDataChannelMessage:function(e,t){e.dataChannelMessages.push(t.payload)},setDataChannelSignaling:function(e,t){e.dataChannelSignaling=t.payload},setGoogCpuOveruseDetection:function(e,t){e.googCpuOveruseDetection=t.payload},setDisplayResolution:function(e,t){e.displayResolution=t.payload},setE2EE:function(e,t){e.e2ee=t.payload},setEchoCancellation:function(e,t){e.echoCancellation=t.payload},setEchoCancellationType:function(e,t){e.echoCancellationType=t.payload},setEnabledClientId:function(e,t){e.enabledClientId=t.payload},setEnabledDataChannel:function(e,t){e.enabledDataChannel=t.payload},setEnabledMetadata:function(e,t){e.enabledMetadata=t.payload},setIgnoreDisconnectWebSocket:function(e,t){e.ignoreDisconnectWebSocket=t.payload},setSignalingMessage:function(e,t){e.signalingMessages.push(t.payload)},setEnabledSignalingNotifyMetadata:function(e,t){e.enabledSignalingNotifyMetadata=t.payload},setFakeVolume:function(e,t){var n=parseFloat(t.payload);isNaN(n)?e.fakeVolume="0":e.fakeVolume=1<n?"1":String(n),e.fakeContents.gainNode&&e.fakeContents.gainNode.gain.setValueAtTime(parseFloat(e.fakeVolume),0)},setFakeContentsGainNode:function(e,t){e.fakeContents.gainNode=t.payload},setInitialFakeContents:function(e){e.fakeContents.colorCode=Math.floor(16777215*Math.random());var t=URL.createObjectURL(new Blob([d.lt],{type:"application/javascript"}));e.fakeContents.worker=new Worker(t)},setFrameRate:function(e,t){e.frameRate=t.payload},setMute:function(e,t){e.mute=t.payload},setNoiseSuppression:function(e,t){e.noiseSuppression=t.payload},setMediaType:function(e,t){e.mediaType=t.payload},setMetadata:function(e,t){e.metadata=t.payload},setResolution:function(e,t){e.resolution=t.payload},setSignalingNotifyMetadata:function(e,t){e.signalingNotifyMetadata=t.payload},setSimulcastRid:function(e,t){e.simulcastRid=t.payload},setSpotlight:function(e,t){e.spotlight=t.payload},setSpotlightNumber:function(e,t){e.spotlightNumber=t.payload},setSpotlightFocusRid:function(e,t){e.spotlightFocusRid=t.payload},setSpotlightUnfocusRid:function(e,t){e.spotlightUnfocusRid=t.payload},setVideo:function(e,t){e.video=t.payload},setVideoInput:function(e,t){e.videoInput=t.payload},setVideoBitRate:function(e,t){e.videoBitRate=t.payload},setVideoCodecType:function(e,t){e.videoCodecType=t.payload},setSora:function(e,t){e.soraContents.sora=t.payload,e.soraContents.sora?(e.soraContents.connectionId=e.soraContents.sora.connectionId,e.soraContents.clientId=e.soraContents.sora.clientId):(e.soraContents.connectionId=null,e.soraContents.clientId=null)},setLocalMediaStream:function(e,t){e.soraContents.localMediaStream&&e.soraContents.localMediaStream.getTracks().forEach((function(e){e.stop()})),e.soraContents.localMediaStream=t.payload,t.payload?(e.enabledMic=t.payload.getAudioTracks().some((function(e){return e.enabled})),e.enabledCamera=t.payload.getVideoTracks().some((function(e){return e.enabled}))):(e.enabledMic=!1,e.enabledCamera=!1)},setRemoteMediaStream:function(e,t){e.soraContents.remoteMediaStreams.push(t.payload)},setStatsReport:function(e,t){e.soraContents.prevStatsReport=e.soraContents.statsReport,e.soraContents.statsReport=t.payload},removeRemoteMediaStream:function(e,t){var n=e.soraContents.remoteMediaStreams.filter((function(e){return e.id!==t.payload}));e.soraContents.remoteMediaStreams=n},removeAllRemoteMediaStreams:function(e){e.soraContents.remoteMediaStreams=[]},setEnabledMic:function(e,t){e.enabledMic=t.payload},setEnabledCamera:function(e,t){e.enabledCamera=t.payload},setAudioInputDevices:function(e,t){e.audioInputDevices=t.payload},setVideoInputDevices:function(e,t){e.videoInputDevices=t.payload},setAudioOutputDevices:function(e,t){e.audioOutputDevices=t.payload},setSoraInfoAlertMessage:function(e,t){var n={title:"Sora info",type:"info",message:t.payload,timestamp:(new Date).getTime()};g(e.alertMessages,e.logMessages,n)},setSoraErrorAlertMessage:function(e,t){var n={title:"Sora error",type:"error",message:t.payload,timestamp:(new Date).getTime()};g(e.alertMessages,e.logMessages,n)},setAPIInfoAlertMessage:function(e,t){var n={title:"API info",type:"info",message:t.payload,timestamp:(new Date).getTime()};g(e.alertMessages,e.logMessages,n)},setAPIErrorAlertMessage:function(e,t){var n={title:"API error",type:"error",message:t.payload,timestamp:(new Date).getTime()};g(e.alertMessages,e.logMessages,n)},deleteAlertMessage:function(e,t){var n=e.alertMessages.filter((function(e){return e.timestamp!==t.payload}));e.alertMessages=n},setDebug:function(e,t){e.debug=t.payload},setDebugType:function(e,t){e.debugType=t.payload},setLogMessages:function(e,t){e.logMessages.push({timestamp:(new Date).getTime(),message:{title:t.payload.title,description:t.payload.description}})},setNotifyMessages:function(e,t){e.notifyMessages.push(t.payload)},setPushMessages:function(e,t){e.pushMessages.push(t.payload)},setSpotlightConnectionIds:function(e,t){var n=Object.assign(e.spotlightConnectionIds,(0,r.Z)({},t.payload.spotlightId,t.payload.connectionId));e.spotlightConnectionIds=n},setFocusedSpotlightConnectionId:function(e,t){e.focusedSpotlightConnectionIds[t.payload]=!0},setUnFocusedSpotlightConnectionId:function(e,t){e.focusedSpotlightConnectionIds[t.payload]=!1},deleteFocusedSpotlightConnectionId:function(e,t){delete e.focusedSpotlightConnectionIds[t.payload]},setShowStats:function(e,t){e.showStats=t.payload}}});function g(e,t,n){if(5<=e.length)for(var o=0;o<=e.length-5;o++)e.pop();e.unshift(n),t.push({timestamp:n.timestamp,message:{title:"ALERT MESSAGE ".concat(n.title),description:JSON.stringify({title:n.title,type:n.type,message:n.message})}})}function h(e,t){return m.apply(this,arguments)}function m(){return(m=(0,s.Z)(a().mark((function e(t,n){var o,i,s,r,c,u,d,p,g,h,m,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="MEDIA_CONSTRAINTS","getDisplayMedia"!==n.mediaType){e.next=8;break}return i={video:!0},t(f.actions.setLogMessages({title:o,description:JSON.stringify(i)})),e.next=6,navigator.mediaDevices.getDisplayMedia(i);case 6:return e.t0=e.sent,e.abrupt("return",[e.t0,null]);case 8:if("fakeMedia"!==n.mediaType||!n.fakeContents.worker){e.next=15;break}return s=(0,l._8)({audio:n.audio,video:n.video,frameRate:n.frameRate,resolution:n.resolution,volume:n.fakeVolume}),t(f.actions.setLogMessages({title:o,description:JSON.stringify(s)})),r=(0,l.gU)(s),c=r.canvas,u=r.stream,d=r.gainNode,n.fakeContents.worker.onmessage=function(e){var t=e.data;"update"===t.type&&(0,l.zW)(c,n.fakeContents.colorCode,s.fontSize,t.counter.toString())},n.fakeContents.worker.postMessage({type:"start",interval:1e3/s.frameRate}),e.abrupt("return",[u,d]);case 15:if(p=new MediaStream,!(g=(0,l.dV)({audio:n.audio,autoGainControl:n.autoGainControl,noiseSuppression:n.noiseSuppression,echoCancellation:n.echoCancellation,echoCancellationType:n.echoCancellationType,audioInput:n.audioInput}))){e.next=23;break}return t(f.actions.setLogMessages({title:o,description:JSON.stringify({audio:g})})),e.next=21,navigator.mediaDevices.getUserMedia({audio:g});case 21:h=e.sent,p.addTrack(h.getAudioTracks()[0]);case 23:if(!(m=(0,l.Tm)({video:n.video,frameRate:n.frameRate,resolution:n.resolution,videoInput:n.videoInput}))){e.next=30;break}return t(f.actions.setLogMessages({title:o,description:JSON.stringify({video:m})})),e.next=28,navigator.mediaDevices.getUserMedia({video:m});case 28:v=e.sent,p.addTrack(v.getVideoTracks()[0]);case 30:return e.abrupt("return",[p,null]);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n){n.on("log",(function(t,n){e(f.actions.setLogMessages({title:t,description:JSON.stringify(n)}))})),n.on("notify",(function(t,n){"spotlight.changed"===t.event_type&&"string"===typeof t.spotlight_id&&"string"===typeof t.connection_id&&e(f.actions.setSpotlightConnectionIds({spotlightId:t.spotlight_id,connectionId:t.connection_id})),"spotlight.focused"===t.event_type&&"string"===typeof t.connection_id&&e(f.actions.setFocusedSpotlightConnectionId(t.connection_id)),"spotlight.unfocused"===t.event_type&&"string"===typeof t.connection_id&&e(f.actions.setUnFocusedSpotlightConnectionId(t.connection_id)),"connection.destroyed"===t.event_type&&"string"===typeof t.connection_id&&e(f.actions.deleteFocusedSpotlightConnectionId(t.connection_id)),e(f.actions.setNotifyMessages({timestamp:(new Date).getTime(),message:t,transportType:n}))})),n.on("push",(function(t,n){e(f.actions.setPushMessages({timestamp:(new Date).getTime(),message:t,transportType:n}))})),n.on("track",(function(n){t().soraContents.remoteMediaStreams.find((function(e){return e.id===n.streams[0].id}))||e(f.actions.setRemoteMediaStream(n.streams[0]))})),n.on("removetrack",(function(n){t().soraContents.remoteMediaStreams.find((function(e){if(null!==n&&void 0!==n&&n.target)return e.id===n.target.id}))&&e(f.actions.removeRemoteMediaStream(n.target.id))})),n.on("disconnect",(function(){var n=t(),o=n.fakeContents,a=n.soraContents,i=a.localMediaStream,s=a.remoteMediaStreams;i&&i.getTracks().forEach((function(e){e.stop()})),s.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),o.worker&&o.worker.postMessage({type:"stop"}),e(f.actions.setSora(null)),e(f.actions.setLocalMediaStream(null)),e(f.actions.removeAllRemoteMediaStreams()),e(f.actions.setSoraInfoAlertMessage("Disconnect Sora."))})),n.on("datachannel",(function(t){var n={timestamp:(new Date).getTime(),id:t.id,label:t.label,type:t.type,data:{binaryType:t.binaryType,bufferedAmount:t.bufferedAmount,bufferedAmountLowThreshold:t.bufferedAmountLowThreshold,id:t.id,label:t.label,maxPacketLifeTime:t.maxPacketLifeTime,maxRetransmits:t.maxRetransmits,negotiated:t.negotiated,ordered:t.ordered,protocol:t.protocol,readyState:t.readyState}};e(f.actions.setDataChannelMessage(n))})),n.on("signaling",(function(t){var n={timestamp:(new Date).getTime(),transportType:t.transportType,type:t.type,data:t.data};e(f.actions.setSignalingMessage(n))}))}function y(e,t,n,o){var a={audio:e.audio,video:e.video};e.audioCodecType&&(a.audioCodecType=e.audioCodecType);var i=parseInt(e.audioBitRate,10);i&&(a.audioBitRate=i),e.videoCodecType&&(a.videoCodecType=e.videoCodecType);var s=parseInt(e.videoBitRate,10);s&&(a.videoBitRate=s),t&&(a.multistream=!0),e.e2ee&&(a.e2ee=!0);var r=(0,l.E2)(e.spotlight);if(n&&r){a.spotlight=r;var c=parseInt(e.spotlightNumber);!0===r&&c&&(a.spotlightNumber=c),!0===a.spotlight&&e.spotlightFocusRid&&(a.spotlightFocusRid=e.spotlightFocusRid),!0===a.spotlight&&e.spotlightUnfocusRid&&(a.spotlightUnfocusRid=e.spotlightUnfocusRid)}return o&&(a.simulcast=!0,e.simulcastRid&&(a.simulcastRid=e.simulcastRid)),e.enabledSignalingNotifyMetadata&&(a.signalingNotifyMetadata=(0,l.BB)(!0,e.signalingNotifyMetadata)),e.enabledClientId&&(a.clientId=e.clientId),e.enabledDataChannel&&("true"===e.dataChannelSignaling?a.dataChannelSignaling=!0:"false"===e.dataChannelSignaling&&(a.dataChannelSignaling=!1),"true"===e.ignoreDisconnectWebSocket?a.ignoreDisconnectWebSocket=!0:"false"===e.ignoreDisconnectWebSocket&&(a.ignoreDisconnectWebSocket=!1)),a}function C(e,t){return S.apply(this,arguments)}function S(){return(S=(0,s.Z)(a().mark((function e(t,n){var o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.pc||"closed"===(null===(o=n.pc)||void 0===o?void 0:o.iceConnectionState)){e.next=7;break}return e.next=3,n.pc.getStats();case 3:i=e.sent,s=[],i.forEach((function(e){s.push(e)})),t(f.actions.setStatsReport(s));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=function(e){return function(){var t=(0,s.Z)(a().mark((function t(n,o){var r,c,d,p,g,m,S,b,M,I;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=o()).soraContents.sora){t.next=4;break}return t.next=4,r.soraContents.sora.disconnect();case 4:return t.next=6,h(n,r).catch((function(e){throw n(f.actions.setSoraErrorAlertMessage(e.toString())),e}));case 6:return c=t.sent,d=(0,i.Z)(c,2),p=d[0],g=d[1],m=(0,l.EO)(),n(f.actions.setLogMessages({title:"SIGNALING_URL",description:JSON.stringify(m)})),S=u.Z.connection(m,r.debug),b=y({audio:r.audio,audioBitRate:r.audioBitRate,audioCodecType:r.audioCodecType,clientId:r.clientId,dataChannelSignaling:r.dataChannelSignaling,enabledClientId:r.enabledClientId,enabledDataChannel:r.enabledDataChannel,e2ee:r.e2ee,enabledSignalingNotifyMetadata:r.enabledSignalingNotifyMetadata,ignoreDisconnectWebSocket:r.ignoreDisconnectWebSocket,signalingNotifyMetadata:r.signalingNotifyMetadata,simulcastRid:"",spotlight:r.spotlight,spotlightNumber:r.spotlightNumber,spotlightFocusRid:r.spotlightFocusRid,spotlightUnfocusRid:r.spotlightUnfocusRid,video:r.video,videoBitRate:r.videoBitRate,videoCodecType:r.videoCodecType},!0===(null===e||void 0===e?void 0:e.multistream),!0===(null===e||void 0===e?void 0:e.spotlight),!0===(null===e||void 0===e?void 0:e.simulcast)),(M=S.sendonly(r.channelId,null,b)).metadata=(0,l.BB)(r.enabledMetadata,r.metadata),"boolean"===typeof r.googCpuOveruseDetection&&(M.constraints={optional:[{googCpuOveruseDetection:r.googCpuOveruseDetection}]}),v(n,o,M),t.prev=18,t.next=21,M.connect(p);case 21:n(f.actions.setSoraInfoAlertMessage("Succeeded to connect Sora.")),t.next=29;break;case 24:throw t.prev=24,t.t0=t.catch(18),p.getTracks().forEach((function(e){e.stop()})),n(f.actions.setSoraErrorAlertMessage("Failed to connect Sora. ".concat(t.t0.message))),t.t0;case 29:return t.next=31,C(n,M);case 31:I=setInterval((0,s.Z)(a().mark((function e(){var t,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o(),!(i=t.soraContents).sora){e.next=6;break}return e.next=4,C(n,i.sora);case 4:e.next=7;break;case 6:clearInterval(I);case 7:case"end":return e.stop()}}),e)}))),1e3),n(f.actions.setSora(M)),n(f.actions.setLocalMediaStream(p)),n(f.actions.setFakeContentsGainNode(g));case 35:case"end":return t.stop()}}),t,null,[[18,24]])})));return function(e,n){return t.apply(this,arguments)}}()},M=function(e){return function(){var t=(0,s.Z)(a().mark((function t(n,o){var i,r,c,d,p,g;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i=o()).soraContents.sora){t.next=4;break}return t.next=4,i.soraContents.sora.disconnect();case 4:return r=(0,l.EO)(),n(f.actions.setLogMessages({title:"SIGNALING_URL",description:JSON.stringify(r)})),c=u.Z.connection(r,i.debug),d=y({audio:i.audio,audioBitRate:i.audioBitRate,audioCodecType:i.audioCodecType,clientId:i.clientId,dataChannelSignaling:i.dataChannelSignaling,enabledClientId:i.enabledClientId,enabledDataChannel:i.enabledDataChannel,e2ee:i.e2ee,enabledSignalingNotifyMetadata:i.enabledSignalingNotifyMetadata,ignoreDisconnectWebSocket:i.ignoreDisconnectWebSocket,signalingNotifyMetadata:i.signalingNotifyMetadata,simulcastRid:i.simulcastRid,spotlight:i.spotlight,spotlightNumber:i.spotlightNumber,spotlightFocusRid:i.spotlightFocusRid,spotlightUnfocusRid:i.spotlightUnfocusRid,video:i.video,videoBitRate:i.videoBitRate,videoCodecType:i.videoCodecType},!0===(null===e||void 0===e?void 0:e.multistream),!0===(null===e||void 0===e?void 0:e.spotlight),!0===(null===e||void 0===e?void 0:e.simulcast)),(p=c.recvonly(i.channelId,null,d)).metadata=(0,l.BB)(i.enabledMetadata,i.metadata),v(n,o,p),t.prev=11,t.next=14,p.connect();case 14:n(f.actions.setSoraInfoAlertMessage("Succeeded to connect Sora.")),t.next=21;break;case 17:throw t.prev=17,t.t0=t.catch(11),n(f.actions.setSoraErrorAlertMessage("Failed to connect Sora. ".concat(t.t0.message))),t.t0;case 21:return t.next=23,C(n,p);case 23:g=setInterval((0,s.Z)(a().mark((function e(){var t,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o(),!(i=t.soraContents).sora){e.next=6;break}return e.next=4,C(n,i.sora);case 4:e.next=7;break;case 6:clearInterval(g);case 7:case"end":return e.stop()}}),e)}))),1e3),n(f.actions.setSora(p));case 25:case"end":return t.stop()}}),t,null,[[11,17]])})));return function(e,n){return t.apply(this,arguments)}}()},I=function(e){return function(){var t=(0,s.Z)(a().mark((function t(n,o){var r,c,d,p,g,m,S,b,M,I;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=o()).soraContents.sora){t.next=4;break}return t.next=4,r.soraContents.sora.disconnect();case 4:return t.next=6,h(n,r).catch((function(e){throw n(f.actions.setSoraErrorAlertMessage(e.toString())),e}));case 6:return c=t.sent,d=(0,i.Z)(c,2),p=d[0],g=d[1],m=(0,l.EO)(),n(f.actions.setLogMessages({title:"SIGNALING_URL",description:JSON.stringify(m)})),S=u.Z.connection(m,r.debug),b=y({audio:r.audio,audioBitRate:r.audioBitRate,audioCodecType:r.audioCodecType,clientId:r.clientId,dataChannelSignaling:r.dataChannelSignaling,enabledClientId:r.enabledClientId,enabledDataChannel:r.enabledDataChannel,e2ee:r.e2ee,enabledSignalingNotifyMetadata:r.enabledSignalingNotifyMetadata,ignoreDisconnectWebSocket:r.ignoreDisconnectWebSocket,signalingNotifyMetadata:r.signalingNotifyMetadata,simulcastRid:r.simulcastRid,spotlight:r.spotlight,spotlightNumber:r.spotlightNumber,spotlightFocusRid:r.spotlightFocusRid,spotlightUnfocusRid:r.spotlightUnfocusRid,video:r.video,videoBitRate:r.videoBitRate,videoCodecType:r.videoCodecType},!0,!0===(null===e||void 0===e?void 0:e.spotlight),!0===(null===e||void 0===e?void 0:e.simulcast)),(M=S.sendrecv(r.channelId,null,b)).metadata=(0,l.BB)(r.enabledMetadata,r.metadata),"boolean"===typeof r.googCpuOveruseDetection&&(M.constraints={optional:[{googCpuOveruseDetection:r.googCpuOveruseDetection}]}),v(n,o,M),t.prev=18,t.next=21,M.connect(p);case 21:n(f.actions.setSoraInfoAlertMessage("Succeeded to connect Sora.")),t.next=29;break;case 24:throw t.prev=24,t.t0=t.catch(18),p.getTracks().forEach((function(e){e.stop()})),n(f.actions.setSoraErrorAlertMessage("Failed to connect Sora. ".concat(t.t0.message))),t.t0;case 29:return t.next=31,C(n,M);case 31:I=setInterval((0,s.Z)(a().mark((function e(){var t,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o(),!(i=t.soraContents).sora){e.next=6;break}return e.next=4,C(n,i.sora);case 4:e.next=7;break;case 6:clearInterval(I);case 7:case"end":return e.stop()}}),e)}))),1e3),n(f.actions.setSora(M)),n(f.actions.setLocalMediaStream(p)),n(f.actions.setFakeContentsGainNode(g));case 35:case"end":return t.stop()}}),t,null,[[18,24]])})));return function(e,n){return t.apply(this,arguments)}}()},R=function(){return function(){var e=(0,s.Z)(a().mark((function e(t,n){var o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n(),!(i=o.soraContents).sora){e.next=4;break}return e.next=4,i.sora.disconnect();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},k=function(){return function(){var e=(0,s.Z)(a().mark((function e(t,n){var o,i,s,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:o=e.sent,i=[],s=[],r=[],o.forEach((function(e){""!==e.deviceId&&("audioinput"===e.kind?i.push(e.toJSON()):"audiooutput"===e.kind?r.push(e.toJSON()):"videoinput"===e.kind&&s.push(e.toJSON()))})),t(f.actions.setAudioInputDevices(i)),t(f.actions.setVideoInputDevices(s)),t(f.actions.setAudioOutputDevices(r));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},w=function(){return function(){var e=(0,s.Z)(a().mark((function e(t,n){var o,s,r,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=n()).soraContents.sora){e.next=3;break}return e.abrupt("return");case 3:return o.soraContents.localMediaStream&&o.soraContents.localMediaStream.getTracks().forEach((function(e){e.stop()})),e.next=6,h(t,o).catch((function(e){throw t(f.actions.setSoraErrorAlertMessage(e.toString())),e}));case 6:s=e.sent,r=(0,i.Z)(s,2),c=r[0],u=r[1],c.getTracks().forEach((function(e){if(o.soraContents.sora&&o.soraContents.sora.pc){var t=o.soraContents.sora.pc.getSenders().find((function(t){return!!t.track&&t.track.kind===e.kind}));t&&t.replaceTrack(e)}})),t(f.actions.setLocalMediaStream(c)),t(f.actions.setFakeContentsGainNode(u));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},T=function(e){return function(){var t=(0,s.Z)(a().mark((function t(n,o){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=14;break}i="Faild to execute WebAssembly '".concat("https://sora-e2ee-wasm.shiguredo.jp/2020.2/wasm.wasm","'."),t.next=5;break;case 5:return t.prev=5,t.next=8,u.Z.initE2EE("https://sora-e2ee-wasm.shiguredo.jp/2020.2/wasm.wasm");case 8:t.next=14;break;case 10:return t.prev=10,t.t0=t.catch(5),n(f.actions.setSoraErrorAlertMessage(i)),t.abrupt("return");case 14:n(f.actions.setE2EE(e));case 15:case"end":return t.stop()}}),t,null,[[5,10]])})));return function(e,n){return t.apply(this,arguments)}}()};function x(e,t,n,o){void 0!==n&&e(t(n)),void 0!==o&&e(t(o))}var D=function(e){return function(){var t=(0,s.Z)(a().mark((function t(n,o){var i,s,r,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(f.actions.resetState()),i=(0,l.dD)(),x(n,f.actions.setAudio,e.audio,i.audio),x(n,f.actions.setAudioBitRate,e.audioBitRate,i.audioBitRate),x(n,f.actions.setAudioCodecType,e.audioCodecType,i.audioCodecType),t.next=7,navigator.mediaDevices.enumerateDevices();case 7:if(void 0!==(s=t.sent).find((function(e){return"audioinput"===e.kind&&e.deviceId===i.audioInput}))&&x(n,f.actions.setAudioInput,e.audioInput,i.audioInput),void 0!==s.find((function(e){return"audiooutput"===e.kind&&e.deviceId===i.audioOutput}))&&x(n,f.actions.setAudioOutput,e.audioOutput,i.audioOutput),void 0!==s.find((function(e){return"videoinput"===e.kind&&e.deviceId===i.videoInput}))&&x(n,f.actions.setVideoInput,e.videoInput,i.videoInput),x(n,f.actions.setAutoGainControl,e.autoGainControl,i.autoGainControl),x(n,f.actions.setChannelId,e.channelId,i.channelId),x(n,f.actions.setDisplayResolution,e.displayResolution,i.displayResolution),x(n,f.actions.setE2EE,e.e2ee,i.e2ee),x(n,f.actions.setEchoCancellation,e.echoCancellation,i.echoCancellation),x(n,f.actions.setEchoCancellationType,e.echoCancellationType,i.echoCancellationType),x(n,f.actions.setMediaType,e.mediaType,i.mediaType),x(n,f.actions.setFakeVolume,e.fakeVolume,i.fakeVolume),x(n,f.actions.setFrameRate,e.frameRate,i.frameRate),x(n,f.actions.setNoiseSuppression,e.noiseSuppression,i.noiseSuppression),x(n,f.actions.setResolution,e.resolution,i.resolution),x(n,f.actions.setShowStats,e.showStats,i.showStats),x(n,f.actions.setSimulcastRid,e.simulcastRid,i.simulcastRid),x(n,f.actions.setSpotlight,e.spotlight,i.spotlight),x(n,f.actions.setSpotlightNumber,e.spotlightNumber,i.spotlightNumber),x(n,f.actions.setSpotlightFocusRid,e.spotlightFocusRid,i.spotlightFocusRid),x(n,f.actions.setSpotlightUnfocusRid,e.spotlightUnfocusRid,i.spotlightUnfocusRid),x(n,f.actions.setVideo,e.video,i.video),x(n,f.actions.setVideoBitRate,e.videoBitRate,i.videoBitRate),x(n,f.actions.setVideoCodecType,e.videoCodecType,i.videoCodecType),x(n,f.actions.setDebug,e.debug,i.debug),x(n,f.actions.setMute,e.mute,i.mute),x(n,f.actions.setDataChannelSignaling,e.dataChannelSignaling,i.dataChannelSignaling),x(n,f.actions.setIgnoreDisconnectWebSocket,e.ignoreDisconnectWebSocket,i.ignoreDisconnectWebSocket),void 0!==i.googCpuOveruseDetection&&n(f.actions.setGoogCpuOveruseDetection(i.googCpuOveruseDetection)),void 0!==i.clientId&&(n(f.actions.setEnabledClientId(!0)),x(n,f.actions.setClientId,e.clientId,i.clientId)),void 0!==i.metadata&&(n(f.actions.setEnabledMetadata(!0)),x(n,f.actions.setMetadata,e.metadata,i.metadata)),void 0!==i.signalingNotifyMetadata&&(n(f.actions.setEnabledSignalingNotifyMetadata(!0)),x(n,f.actions.setSignalingNotifyMetadata,e.signalingNotifyMetadata,i.signalingNotifyMetadata)),void 0===i.dataChannelSignaling&&void 0===i.ignoreDisconnectWebSocket||n(f.actions.setEnabledDataChannel(!0)),n(f.actions.setInitialFakeContents()),r=o(),!r.e2ee){t.next=56;break}c="Faild to execute WebAssembly '".concat("https://sora-e2ee-wasm.shiguredo.jp/2020.2/wasm.wasm","'."),t.next=47;break;case 47:return t.prev=47,t.next=50,u.Z.initE2EE("https://sora-e2ee-wasm.shiguredo.jp/2020.2/wasm.wasm");case 50:t.next=56;break;case 52:return t.prev=52,t.t0=t.catch(47),n(f.actions.setSoraErrorAlertMessage(c)),t.abrupt("return");case 56:case"end":return t.stop()}}),t,null,[[47,52]])})));return function(e,n){return t.apply(this,arguments)}}()},N=function(){return function(){var e=(0,s.Z)(a().mark((function e(t,n){var o,i,s,r,c,d,p,g,h,m,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n(),i=o.audio,s=o.audioInput,r=o.autoGainControl,c=o.enabledMic,d=o.echoCancellation,p=o.echoCancellationType,g=o.noiseSuppression,h=o.soraContents,!c){e.next=5;break}h.localMediaStream&&u.Z.helpers.stopAudioMediaDevice(h.localMediaStream),e.next=9;break;case 5:if(!h.localMediaStream||null===(m=h.sora)||void 0===m||!m.pc){e.next=9;break}return v=(0,l.dV)({audio:i,autoGainControl:r,noiseSuppression:g,echoCancellation:d,echoCancellationType:p,audioInput:s}),e.next=9,u.Z.helpers.startAudioMediaDevice(h.localMediaStream,h.sora.pc,v);case 9:t(f.actions.setEnabledMic(!c));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},A=function(){return function(){var e=(0,s.Z)(a().mark((function e(t,n){var o,i,s,r,c,d,p,g,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n(),i=o.enabledCamera,s=o.frameRate,r=o.resolution,c=o.soraContents,d=o.video,p=o.videoInput,!i){e.next=5;break}c.localMediaStream&&u.Z.helpers.stopVideoMediaDevice(c.localMediaStream),e.next=9;break;case 5:if(!c.localMediaStream||null===(g=c.sora)||void 0===g||!g.pc){e.next=9;break}return h=(0,l.Tm)({video:d,frameRate:s,resolution:r,videoInput:p}),e.next=9,u.Z.helpers.startVideoMediaDevice(c.localMediaStream,c.sora.pc,h);case 9:t(f.actions.setEnabledCamera(!i));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},E=f.actions,O=E.deleteAlertMessage,V=E.setAPIErrorAlertMessage,F=E.setAPIInfoAlertMessage,B=E.setAudio,G=E.setAudioBitRate,U=E.setAudioCodecType,L=E.setAudioInput,W=E.setAudioOutput,Z=E.setAutoGainControl,_=E.setClientId,P=E.setChannelId,J=E.setDataChannelSignaling,H=E.setDebug,Q=E.setDebugType,j=E.setDisplayResolution,z=E.setEchoCancellation,X=E.setEchoCancellationType,Y=E.setEnabledDataChannel,q=E.setEnabledClientId,$=E.setEnabledMetadata,K=E.setEnabledSignalingNotifyMetadata,ee=E.setFakeVolume,te=E.setFrameRate,ne=E.setIgnoreDisconnectWebSocket,oe=(E.setLocalMediaStream,E.setLogMessages,E.setMediaType),ae=E.setMetadata,ie=E.setNoiseSuppression,se=(E.setNotifyMessages,E.setResolution),re=E.setSignalingNotifyMetadata,ce=E.setSimulcastRid,ue=(E.setSora,E.setSoraErrorAlertMessage,E.setSoraInfoAlertMessage,E.setSpotlight),de=E.setSpotlightFocusRid,le=E.setSpotlightNumber,pe=E.setSpotlightUnfocusRid,fe=E.setVideo,ge=E.setVideoBitRate,he=E.setVideoCodecType,me=E.setVideoInput,ve=f.reducer},8471:function(e,t,n){"use strict";n.d(t,{o5:function(){return i},f7:function(){return s},yP:function(){return r},nu:function(){return c},ou:function(){return u},Uz:function(){return d},zM:function(){return l},ko:function(){return p},F9:function(){return f},Gn:function(){return g},EQ:function(){return h},gW:function(){return m},iF:function(){return v},zG:function(){return y},nm:function(){return C},ug:function(){return S},to:function(){return b},dD:function(){return M},EO:function(){return I},fl:function(){return R},dV:function(){return k},Tm:function(){return w},_8:function(){return T},gU:function(){return x},zW:function(){return D},E2:function(){return N},BB:function(){return A},Sg:function(){return E}});var o=n(7563),a=n(4268);function i(e){var t=new Date(e),n=t.getFullYear(),o=t.getMonth()+1,a=t.getDate(),i=t.getHours(),s=t.getMinutes(),r=t.getSeconds(),c=t.getMilliseconds();return"".concat(n,"-").concat(o,"-").concat(a," ").concat(i,":").concat(s,":").concat(r,".").concat(c)}function s(e){if(navigator.clipboard)return navigator.clipboard.writeText(e);var t=document.createElement("textarea");t.style.position="absolute",t.style.top="-1000px",t.innerText=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(n){Promise.reject(n)}return document.body.removeChild(t),Promise.resolve()}function r(e){return a.o1.indexOf(e)>=0}function c(e){return a.xR.indexOf(e)>=0}function u(e){return a.Sh.indexOf(e)>=0}function d(e){return a.Q5.indexOf(e)>=0}function l(e){return a.Vf.indexOf(e)>=0}function p(e){return a.hJ.indexOf(e)>=0}function f(e){return a.YX.indexOf(e)>=0}function g(e){return a.cJ.indexOf(e)>=0}function h(e){return a.Xr.indexOf(e)>=0}function m(e){return a.n4.indexOf(e)>=0}function v(e){return a.I7.indexOf(e)>=0}function y(e){return a.WJ.indexOf(e)>=0}function C(e){return a.w_.indexOf(e)>=0}function S(e){return a.l9.indexOf(e)>=0}function b(e){return a.kt.indexOf(e)>=0}function M(){var e=o.parse(location.search,{parseBooleans:!0}),t=e.audio,n=e.audioBitRate,a=e.audioCodecType,i=e.audioInput,s=e.audioOutput,M=e.autoGainControl,I=e.channelId,R=e.clientId,k=e.debug,w=e.dataChannelSignaling,T=e.displayResolution,x=e.e2ee,D=e.echoCancellation,N=e.echoCancellationType,A=e.fakeVolume,E=e.frameRate,O=e.googCpuOveruseDetection,V=e.ignoreDisconnectWebSocket,F=e.mediaType,B=e.metadata,G=e.noiseSuppression,U=e.mute,L=e.showStats,W=e.signalingNotifyMetadata,Z=e.spotlight,_=e.spotlightNumber,P=e.spotlightFocusRid,J=e.spotlightUnfocusRid,H=e.simulcastRid,Q=e.resolution,j=e.video,z=e.videoBitRate,X=e.videoCodecType,Y=e.videoInput,q={};"boolean"===typeof t&&(q.audio=t),"string"===typeof n&&c(n)&&(q.audioBitRate=n),"string"===typeof a&&r(a)&&(q.audioCodecType=a),"boolean"===typeof M&&(q.autoGainControl=M),void 0!==I&&(q.channelId=String(I)),void 0!==R&&(q.clientId=String(R)),"boolean"===typeof O&&(q.googCpuOveruseDetection=O),"boolean"===typeof k&&(q.debug=k),"string"===typeof T&&p(T)&&(q.displayResolution=T),"boolean"===typeof x&&(q.e2ee=x),"boolean"===typeof D&&(q.echoCancellation=D),"string"===typeof N&&g(N)&&(q.echoCancellationType=N),"boolean"===typeof G&&(q.noiseSuppression=G),A&&(q.fakeVolume=String(A)),"string"===typeof E&&f(E)&&(q.frameRate=E),"string"===typeof F&&C(F)&&(q.mediaType=F),B&&(q.metadata=String(B)),"boolean"===typeof L&&(q.showStats=L),W&&(q.signalingNotifyMetadata=String(W)),"string"===typeof H&&y(H)&&(q.simulcastRid=H),"string"===typeof Z&&m(Z)&&(q.spotlight=Z),"string"===typeof _&&h(_)&&(q.spotlightNumber=_),"string"===typeof P&&v(P)&&(q.spotlightFocusRid=P),"string"===typeof J&&v(J)&&(q.spotlightUnfocusRid=J),"string"===typeof Q&&l(Q)&&(q.resolution=Q),"boolean"===typeof j&&(q.video=j),"string"===typeof z&&d(z)&&(q.videoBitRate=z),"string"===typeof X&&u(X)&&(q.videoCodecType=X),i&&(q.audioInput=String(i)),Y&&(q.videoInput=String(Y)),s&&(q.audioOutput=String(s)),"boolean"===typeof U&&(q.mute=U);var $=String(w);S($)&&(q.dataChannelSignaling=$);var K=String(V);return b(K)&&(q.ignoreDisconnectWebSocket=K),q}function I(){var e="https:"===window.location.protocol?"wss://":"ws://",t=window.location.port?":".concat(window.location.port):"";return e+window.location.hostname+t+"/signaling"}function R(e){switch(e){case"QQVGA":return{width:160,height:120};case"QCIF":return{width:176,height:144};case"HQVGA":return{width:240,height:160};case"QVGA":return{width:320,height:240};case"VGA":return{width:640,height:480};case"SD":return{width:720,height:480};case"HD":return{width:1280,height:720};case"FHD":return{width:1920,height:1080};case"UHD 3840x2160":return{width:3840,height:2160};case"UHD 4096x2160":return{width:4096,height:2160};case"3840x1920":return{width:3840,height:1920};default:return{width:0,height:0}}}function k(e){var t=e.audio,n=e.autoGainControl,o=e.noiseSuppression,a=e.echoCancellation,i=e.echoCancellationType,s=e.audioInput;if(!t)return!1;var r={};return s&&(r.deviceId={exact:s}),r.autoGainControl=n,r.noiseSuppression=o,r.echoCancellation=a,i&&(r.echoCancellationType=i),r}function w(e){var t=e.video,n=e.frameRate,o=e.resolution,a=e.videoInput;if(!t)return!1;if(!n&&!o&&!a)return t;var i={};if(n&&(i.frameRate={min:parseInt(n,10),max:parseInt(n,10)}),o){var s=R(o),r=s.width,c=s.height;0<r&&0<c&&(i.width={exact:r},i.height={exact:c})}return a&&(i.deviceId={exact:a}),i}function T(e){var t=parseInt(e.frameRate,10)||30,n=R(e.resolution),o=n.width||240,a=n.height||160,i=Math.floor(o/5);return{audio:e.audio,video:e.video,frameRate:t,width:o,height:a,fontSize:i,volume:parseFloat(e.volume)}}function x(e){var t=new MediaStream,n=document.createElement("canvas");n.getContext("2d"),n.width=e.width,n.height=e.height;var o=n.captureStream(e.frameRate).getTracks();t.addTrack(o[0]);var a=new(window.AudioContext||window.webkitAudioContext),i=a.createOscillator();i.type="sine";var s=a.createGain();i.connect(s),i.start(0);var r=a.createMediaStreamDestination();s.connect(r);var c=r.stream.getTracks();return t.addTrack(c[0]),s.gain.setValueAtTime(e.volume,0),{canvas:n,stream:t,gainNode:s}}function D(e,t,n,o){if(null!==e){var a=e.getContext("2d");if(a){a.globalCompositeOperation="source-over",a.clearRect(0,0,e.width,e.height),a.fillStyle="#"+("0".repeat(6)+t.toString(16)).slice(-6),a.fillRect(0,0,e.width,e.height),a.fillStyle="#"+("0".repeat(6)+(16777215-t).toString(16)).slice(-6),a.font="".concat(n,"px Arial");var i=e.width/2-n/2,s=n/4*(o.length-1),r=e.height/2+n/2.5;a.fillText(o,i-s,r)}}}function N(e){if("true"===e)return!0;var t=parseInt(e,10);return!isNaN(t)&&t}function A(e,t){if(e){try{return JSON.parse(t)}catch(n){}return t}}function E(e){if(!RTCRtpSender.getCapabilities)return e;var t=RTCRtpSender.getCapabilities("video");if(!t||!t.codecs)return e;var n=t.codecs.map((function(e){return e.mimeType.replace("video/","")}));return n.includes(e)?e:n.includes("VP9")?"VP9":n.includes("VP8")?"VP8":n.includes("H264")?"H264":n.includes("AV1X")?"AV1":n.includes("H265")?"H265":e}}}]);