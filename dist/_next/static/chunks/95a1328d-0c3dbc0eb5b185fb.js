"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{2923:function(e,t,n){n.d(t,{Z:function(){return Ze}});var r=n(3454),i=n(1876).Buffer;class o{constructor(){if(!!!RTCRtpSender.prototype.createEncodedStreams)throw new Error("E2EE is not supported in this browser.");this.worker=null,this.onWorkerDisconnect=null}startWorker(){const e=atob("InVzZSBzdHJpY3QiOwovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi8KY29uc3QgY29ubmVjdGlvbklkTGVuZ3RoID0gMjY7CmZ1bmN0aW9uIGJ5dGVDb3VudChuKSB7CiAgICBpZiAobiA9PSAwKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICAvLyBsb2cyNTYoeCkgPSBsb2coeCkgLyBsb2coMjU2KQogICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5sb2cobikgLyBNYXRoLmxvZygyICoqIDgpICsgMSk7Cn0KZnVuY3Rpb24gYXJyYXlCdWZmZXJUb051bWJlcihhcnJheUJ1ZmZlcikgewogICAgLy8gMzJiaXQg44G+44Gn44KS5oOz5a6aIChCaWdJbnQg44G444Gu5pu444GN5o+b44GI5pmC44Gr6KaB5L+u5q2jKQogICAgY29uc3QgbmV3QXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgY29uc3QgbmV3RGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcobmV3QXJyYXlCdWZmZXIpOwogICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwogICAgY29uc3QgcGFkZGluZ0xlbmd0aCA9IFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UIC0gZGF0YVZpZXcuYnl0ZUxlbmd0aDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFkZGluZ0xlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgbmV3RGF0YVZpZXcuc2V0VWludDgoaSwgMCk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gcGFkZGluZ0xlbmd0aCwgaiA9IDA7IGkgPCBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDsgaSArPSAxLCBqICs9IDEpIHsKICAgICAgICBuZXdEYXRhVmlldy5zZXRVaW50OChpLCBkYXRhVmlldy5nZXRVaW50OChqKSk7CiAgICB9CiAgICByZXR1cm4gbmV3RGF0YVZpZXcuZ2V0VWludDMyKDApOwp9CmZ1bmN0aW9uIGVuY29kZVNGcmFtZUhlYWRlcihzLCBjb3VudCwga2V5SWQpIHsKICAgIC8vICAwIDEgMiAzIDQgNSA2IDcKICAgIC8vICstKy0rLSstKy0rLSstKy0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICAgIC8vIHxTfExFTiAgfDF8S0xFTiB8ICAgS0lELi4uIChsZW5ndGg9S0xFTikgICAgfCAgICBDVFIuLi4gKGxlbmd0aD1MRU4pICAgIHwKICAgIC8vICstKy0rLSstKy0rLSstKy0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICAgIC8vIFM6IDEgYml0CiAgICAvLyBMRU46IDMgYml0CiAgICAvLyBYOiAxIGJpdAogICAgLy8gS0xFTjogMyBiaXQKICAgIC8vIEtJRDogS0xFTiBieXRlCiAgICAvLyBDVFI6IExFTiBieXRlCiAgICAvLyBUT0RPOiBrZXlJZCAoS0lEKSDjgYwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsIDcgYnl0ZSDjgpLotoXjgYjjgabjgYTjgZ/loLTlkIjjga/jgqjjg6njg7zjgYvkvovlpJYKICAgIC8vIFRPRE86IGNvdW50IChDVFIpIOOBjCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgNyBieXRlIOOCkui2heOBiOOBpuOBhOOBn+WgtOWQiOOBr+OCqOODqeODvOOBi+S+i+WklgogICAgaWYgKG1heEtleUlkIDwga2V5SWQgfHwgbWF4Q291bnQgPCBjb3VudCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRVhDRUVERUQtTUFYSU1VTS1CUk9BRENBU1RJTkctVElNRSIpOwogICAgfQogICAgY29uc3Qga2xlbiA9IGJ5dGVDb3VudChrZXlJZCk7CiAgICBjb25zdCBsZW4gPSBieXRlQ291bnQoY291bnQpOwogICAgY29uc3QgaGVhZGVyQnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDEgKyBrbGVuICsgbGVuKTsKICAgIGNvbnN0IGhlYWRlckRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGhlYWRlckJ1ZmZlcik7CiAgICAvLyBTLCBMRU4sIDEsIEtMRU4g44GnIDEgYnl0ZQogICAgaGVhZGVyRGF0YVZpZXcuc2V0VWludDgoMCwgKHMgPDwgNykgKyAobGVuIDw8IDQpICsgKDEgPDwgMykgKyBrbGVuKTsKICAgIGNvbnN0IGhlYWRlclVpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheShoZWFkZXJCdWZmZXIpOwogICAgY29uc3Qga2V5SWRCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgY29uc3Qga2V5SWREYXRhVmlldyA9IG5ldyBEYXRhVmlldyhrZXlJZEJ1ZmZlcik7CiAgICBrZXlJZERhdGFWaWV3LnNldFVpbnQzMigwLCBrZXlJZCk7CiAgICBjb25zdCBrZXlJZFVpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheShrZXlJZEJ1ZmZlcik7CiAgICBoZWFkZXJVaW50OEFycmF5LnNldChrZXlJZFVpbnQ4QXJyYXkuc3ViYXJyYXkoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgLSBrbGVuKSwgMSk7CiAgICBjb25zdCBjb3VudEJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICBjb25zdCBjb3VudERhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGNvdW50QnVmZmVyKTsKICAgIGNvdW50RGF0YVZpZXcuc2V0VWludDMyKDAsIGNvdW50KTsKICAgIGNvbnN0IGNvdW50VWludDhBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvdW50QnVmZmVyKTsKICAgIGhlYWRlclVpbnQ4QXJyYXkuc2V0KGNvdW50VWludDhBcnJheS5zdWJhcnJheShVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAtIGxlbiksIGtsZW4gKyAxKTsKICAgIHJldHVybiBoZWFkZXJVaW50OEFycmF5Owp9CmZ1bmN0aW9uIHNwbGl0SGVhZGVyKHNmcmFtZSkgewogICAgY29uc3Qgc2ZyYW1lRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoc2ZyYW1lKTsKICAgIGNvbnN0IGhlYWRlciA9IHNmcmFtZURhdGFWaWV3LmdldFVpbnQ4KDApOwogICAgY29uc3QgbGVuID0gKGhlYWRlciAmIDB4NzApID4+IDQ7CiAgICBjb25zdCBrbGVuID0gaGVhZGVyICYgMHgwNzsKICAgIGNvbnN0IHNmcmFtZUhlYWRlckxlbmd0aCA9IDEgKyBrbGVuICsgbGVuOwogICAgY29uc3Qgc2ZyYW1lSGVhZGVyID0gc2ZyYW1lLnNsaWNlKDAsIHNmcmFtZUhlYWRlckxlbmd0aCk7CiAgICBpZiAoc2ZyYW1lSGVhZGVyLmJ5dGVMZW5ndGggPCBzZnJhbWVIZWFkZXJMZW5ndGgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtU0ZSQU1FLUxFTkdUSCIpOwogICAgfQogICAgY29uc3QgY29ubmVjdGlvbklkID0gc2ZyYW1lLnNsaWNlKHNmcmFtZUhlYWRlckxlbmd0aCwgc2ZyYW1lSGVhZGVyTGVuZ3RoICsgY29ubmVjdGlvbklkTGVuZ3RoKTsKICAgIGNvbnN0IGVuY3J5cHRlZEZyYW1lID0gc2ZyYW1lLnNsaWNlKHNmcmFtZUhlYWRlckxlbmd0aCArIGNvbm5lY3Rpb25JZExlbmd0aCwgc2ZyYW1lLmJ5dGVMZW5ndGgpOwogICAgcmV0dXJuIFtzZnJhbWVIZWFkZXIsIGNvbm5lY3Rpb25JZCwgZW5jcnlwdGVkRnJhbWVdOwp9CmZ1bmN0aW9uIHBhcnNlU0ZyYW1lSGVhZGVyKHNmcmFtZUhlYWRlcikgewogICAgY29uc3Qgc2ZyYW1lSGVhZGVyRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoc2ZyYW1lSGVhZGVyKTsKICAgIGNvbnN0IGhlYWRlciA9IHNmcmFtZUhlYWRlckRhdGFWaWV3LmdldFVpbnQ4KDApOwogICAgY29uc3QgcyA9IChoZWFkZXIgJiAweDgwKSA+PiA3OwogICAgY29uc3QgbGVuID0gKGhlYWRlciAmIDB4NzApID4+IDQ7CiAgICBjb25zdCB4ID0gKGhlYWRlciAmIDB4MDgpID4+IDM7CiAgICBjb25zdCBrbGVuID0gaGVhZGVyICYgMHgwNzsKICAgIC8vIHggZmxhZwogICAgaWYgKHggIT09IDEpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtWC1GTEFHIik7CiAgICB9CiAgICBjb25zdCBoZWFkZXJMZW5ndGggPSAxICsga2xlbiArIGxlbjsKICAgIGlmIChzZnJhbWVIZWFkZXJEYXRhVmlldy5ieXRlTGVuZ3RoIDwgaGVhZGVyTGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVTkVYUEVDVEVELVNGUkFNRS1IRUFERVItTEVOR1RIIik7CiAgICB9CiAgICBjb25zdCBrZXlJZEJ1ZmZlciA9IHNmcmFtZUhlYWRlci5zbGljZSgxLCAxICsga2xlbik7CiAgICBjb25zdCBrZXlJZCA9IGFycmF5QnVmZmVyVG9OdW1iZXIoa2V5SWRCdWZmZXIpOwogICAgY29uc3QgY291bnRCdWZmZXIgPSBzZnJhbWVIZWFkZXIuc2xpY2UoMSArIGtsZW4sIGhlYWRlckxlbmd0aCk7CiAgICBjb25zdCBjb3VudCA9IGFycmF5QnVmZmVyVG9OdW1iZXIoY291bnRCdWZmZXIpOwogICAgcmV0dXJuIFtzLCBjb3VudCwga2V5SWRdOwp9Ci8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC90cmlwbGUtc2xhc2gtcmVmZXJlbmNlLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi8KLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi9zZnJhbWUudHMiLz4KLy8gVE9ETzog5omx44GG5pWw5YCk44GM5aSn44GN44GE566H5omA44Gn44GvIE51bWJlciDjgYvjgokgQmlnSW50IOOBq+e9ruOBjeaPm+OBiOOCiwovLyBUT0RPOiBCaWdJbnQg44Gr572u44GN5o+b44GI44KL6Zqb44Gr5aSJ5pu044GZ44KLCmNvbnN0IG1heEtleUlkID0gMiAqKiAzMjsKY29uc3QgbWF4Q291bnQgPSAyICoqIDMyOwpjb25zdCBzZWxmRGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwpjb25zdCBjb3VudE1hcCA9IG5ldyBNYXAoKTsKY29uc3Qgd3JpdGVJVk1hcCA9IG5ldyBNYXAoKTsKY29uc3QgcmVtb3RlRGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwpjb25zdCBsYXRlc3RSZW1vdGVLZXlJZE1hcCA9IG5ldyBNYXAoKTsKY29uc3QgbGl0dGxlRW5kaWFuID0gdHJ1ZTsKY29uc3QgYmlnRW5kaWFuID0gIWxpdHRsZUVuZGlhbjsKY29uc3QgdGV4dEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKY29uc3QgdGV4dERlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKLy8gVlA4IOOBruOBvwovLyBUT0RPKG5ha2FpKTogVlA5IC8gQVYxIOOCguWwhuadpeeahOOBq+WvvuW/nOOCguiAg+OBiOOCiwpjb25zdCB1bmVuY3J5cHRlZEJ5dGVzID0gewogICAgLy8gSSDjg5Xjg6zjg7zjg6AKICAgIGtleTogMTAsCiAgICAvLyDpnZ4gSSDjg5Xjg6zjg7zjg6AKICAgIGRlbHRhOiAzLAogICAgLy8g44Kq44O844OH44Kj44KqCiAgICB1bmRlZmluZWQ6IDEsCn07CmZ1bmN0aW9uIGdldENvdW50KGNvbm5lY3Rpb25JZCkgewogICAgcmV0dXJuIGNvdW50TWFwLmdldChjb25uZWN0aW9uSWQpIHx8IDA7Cn0KZnVuY3Rpb24gc2V0Q291bnQoY29ubmVjdGlvbklkLCBjb3VudCkgewogICAgcmV0dXJuIGNvdW50TWFwLnNldChjb25uZWN0aW9uSWQsIGNvdW50KTsKfQpmdW5jdGlvbiBnZXRSZW1vdGVEZXJpdmVLZXkoY29ubmVjdGlvbklkLCBrZXlJZCkgewogICAgaWYgKCFyZW1vdGVEZXJpdmVLZXlNYXAuaGFzKGNvbm5lY3Rpb25JZCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJFTU9URS1ERVJJVkVLRVktTUFQLU5PVC1GT1VORCIpOwogICAgfQogICAgY29uc3QgZGVyaXZlS2V5TWFwID0gcmVtb3RlRGVyaXZlS2V5TWFwLmdldChjb25uZWN0aW9uSWQpOwogICAgaWYgKCFkZXJpdmVLZXlNYXApIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICByZXR1cm4gZGVyaXZlS2V5TWFwLmdldChrZXlJZCk7Cn0KZnVuY3Rpb24gc2V0UmVtb3RlRGVyaXZlS2V5KGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSkgewogICAgbGV0IGRlcml2ZUtleU1hcCA9IHJlbW90ZURlcml2ZUtleU1hcC5nZXQoY29ubmVjdGlvbklkKTsKICAgIGlmICghZGVyaXZlS2V5TWFwKSB7CiAgICAgICAgZGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwogICAgfQogICAgZGVyaXZlS2V5TWFwLnNldChrZXlJZCwgZGVyaXZlS2V5KTsKICAgIHJlbW90ZURlcml2ZUtleU1hcC5zZXQoY29ubmVjdGlvbklkLCBkZXJpdmVLZXlNYXApOwp9CmZ1bmN0aW9uIHNldExhdGVzdFJlbW90ZUtleUlkKGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIGNvbnN0IGxhdGVzdFJlbW90ZUtleUlkID0gbGF0ZXN0UmVtb3RlS2V5SWRNYXAuZ2V0KGNvbm5lY3Rpb25JZCk7CiAgICBpZiAobGF0ZXN0UmVtb3RlS2V5SWQpIHsKICAgICAgICBpZiAobGF0ZXN0UmVtb3RlS2V5SWQgPCBrZXlJZCkgewogICAgICAgICAgICBsYXRlc3RSZW1vdGVLZXlJZE1hcC5zZXQoY29ubmVjdGlvbklkLCBrZXlJZCk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGF0ZXN0UmVtb3RlS2V5SWRNYXAuc2V0KGNvbm5lY3Rpb25JZCwga2V5SWQpOwogICAgfQp9CmZ1bmN0aW9uIHJlbW92ZU9sZFJlbW90ZURlcml2ZUtleXMoKSB7CiAgICBsYXRlc3RSZW1vdGVLZXlJZE1hcC5mb3JFYWNoKChsYXRlc3RLZXlJZCwgY29ubmVjdGlvbklkKSA9PiB7CiAgICAgICAgY29uc3QgZGVyaXZlS2V5TWFwID0gcmVtb3RlRGVyaXZlS2V5TWFwLmdldChjb25uZWN0aW9uSWQpOwogICAgICAgIGlmIChkZXJpdmVLZXlNYXApIHsKICAgICAgICAgICAgZGVyaXZlS2V5TWFwLmZvckVhY2goKF8sIGtleUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobGF0ZXN0S2V5SWQgIT09IGtleUlkKSB7CiAgICAgICAgICAgICAgICAgICAgZGVyaXZlS2V5TWFwLmRlbGV0ZShrZXlJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwp9CmZ1bmN0aW9uIHJlbW92ZURlcml2ZUtleShjb25uZWN0aW9uSWQpIHsKICAgIGxhdGVzdFJlbW90ZUtleUlkTWFwLmRlbGV0ZShjb25uZWN0aW9uSWQpOwogICAgcmVtb3RlRGVyaXZlS2V5TWFwLmRlbGV0ZShjb25uZWN0aW9uSWQpOwp9CmZ1bmN0aW9uIGdldExhdGVzdFNlbGZEZXJpdmVLZXkoKSB7CiAgICBjb25zdCBkZXJpdmVLZXkgPSBzZWxmRGVyaXZlS2V5TWFwLmdldCgibGF0ZXN0Iik7CiAgICBpZiAoIWRlcml2ZUtleSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTEFURVNULVNFTEYtREVSSVZFS0VZLU5PVF9GT1VORCIpOwogICAgfQogICAgcmV0dXJuIGRlcml2ZUtleTsKfQpmdW5jdGlvbiBzZXRTZWxmRGVyaXZlS2V5KGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSkgewogICAgY29uc3QgY3VycmVudFNlbGZEZXJpdmVLZXkgPSBzZWxmRGVyaXZlS2V5TWFwLmdldCgibGF0ZXN0Iik7CiAgICBpZiAoY3VycmVudFNlbGZEZXJpdmVLZXkpIHsKICAgICAgICBpZiAoY3VycmVudFNlbGZEZXJpdmVLZXlbImtleUlkIl0gPCBrZXlJZCkgewogICAgICAgICAgICBjb25zdCBuZXh0U2VsZkRlcml2ZUtleSA9IHsgY29ubmVjdGlvbklkLCBrZXlJZCwgZGVyaXZlS2V5IH07CiAgICAgICAgICAgIHNlbGZEZXJpdmVLZXlNYXAuc2V0KCJsYXRlc3QiLCBuZXh0U2VsZkRlcml2ZUtleSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgY29uc3QgbmV4dFNlbGZEZXJpdmVLZXkgPSB7IGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSB9OwogICAgICAgIHNlbGZEZXJpdmVLZXlNYXAuc2V0KCJsYXRlc3QiLCBuZXh0U2VsZkRlcml2ZUtleSk7CiAgICB9Cn0KZnVuY3Rpb24gc2lsZW5jZUZyYW1lKGVuY29kZWRGcmFtZSkgewogICAgLy8gY29ubmVjdGlvbi5jcmVhdGVkLCByZWNlaXZlTWVzc2FnZSDlj5fkv6HliY3jga7loLTlkIgKICAgIGlmIChlbmNvZGVkRnJhbWUudHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8g6Z+z5aOw44Gv5pqX5Y+35YyW44Gv44GE44KL44Go6IGe44GR44Gf44KC44Gu44GY44KD44Gq44GE44Gu44Gn572u44GN5o+b44GI44KLCiAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBBcnJheUJ1ZmZlcigzKTsKICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgIC8vIE9wdXMg44K144Kk44Os44Oz44K544OV44Os44O844OgCiAgICAgICAgbmV3VWludDguc2V0KFsweGQ4LCAweGZmLCAweGZlXSk7CiAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgLy8g5pig5YOP44GM5q2j5bi444GY44KD44Gq44GE44Gf44KBIFBMSSDjgrnjg4jjg7zjg6DjgYznmbrnlJ/jgZfjgabjgZfjgb7jgYYKICAgICAgICAvLyDjgZ3jga7jgZ/jgoEgMzIweDI0MCDjga7nnJ/jgaPpu5LjgarnlLvpnaLjgavnva7jgY3mj5vjgYjjgosKICAgICAgICBjb25zdCBuZXdEYXRhID0gbmV3IEFycmF5QnVmZmVyKDYwKTsKICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZQogICAgICAgIG5ld1VpbnQ4LnNldChbMHhiMCwgMHgwNSwgMHgwMCwgMHg5ZCwgMHgwMSwgMHgyYSwgMHhhMCwgMHgwMCwgMHg1YSwgMHgwMCwKICAgICAgICAgICAgMHgzOSwgMHgwMywgMHgwMCwgMHgwMCwgMHgxYywgMHgyMiwgMHgxNiwgMHgxNiwgMHgyMiwgMHg2NiwKICAgICAgICAgICAgMHgxMiwgMHgyMCwgMHgwNCwgMHg5MCwgMHg0MCwgMHgwMCwgMHhjNSwgMHgwMSwgMHhlMCwgMHg3YywKICAgICAgICAgICAgMHg0ZCwgMHgyZiwgMHhmYSwgMHhkZCwgMHg0ZCwgMHhhNSwgMHg3ZiwgMHg4OSwgMHhhNSwgMHhmZiwKICAgICAgICAgICAgMHg1YiwgMHhhOSwgMHhiNCwgMHhhZiwgMHhmMSwgMHgzNCwgMHhiZiwgMHhlYiwgMHg3NSwgMHgzNiwKICAgICAgICAgICAgMHg5NSwgMHhmZSwgMHgyNiwgMHg5NiwgMHg2MCwgMHhmZSwgMHhmZiwgMHhiYSwgMHhmZiwgMHg0MCwKICAgICAgICBdKTsKICAgICAgICBlbmNvZGVkRnJhbWUuZGF0YSA9IG5ld0RhdGE7CiAgICB9CiAgICByZXR1cm4gZW5jb2RlZEZyYW1lOwp9CmZ1bmN0aW9uIHNldFdyaXRlSVYoY29ubmVjdGlvbklkLCBrZXlJZCwgd3JpdGVJVikgewogICAgY29uc3Qga2V5ID0gW2Nvbm5lY3Rpb25JZCwga2V5SWQudG9TdHJpbmcoKV0uam9pbigiOiIpOwogICAgd3JpdGVJVk1hcC5zZXQoa2V5LCB3cml0ZUlWKTsKfQpmdW5jdGlvbiBnZXRXcml0ZUlWKGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIGNvbnN0IGtleSA9IFtjb25uZWN0aW9uSWQsIGtleUlkLnRvU3RyaW5nKCldLmpvaW4oIjoiKTsKICAgIHJldHVybiB3cml0ZUlWTWFwLmdldChrZXkpOwp9CmZ1bmN0aW9uIGdlbmVyYXRlSVYoY291bnQsIGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIC8vIFRPRE86IGtleUlkIOOBjCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgNyBieXRlIOOCkui2heOBiOOBpuOBhOOBn+WgtOWQiOOBr+OCqOODqeODvOOBi+S+i+WklgogICAgLy8gVE9ETzogY291bnQg44GMIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLCA3IGJ5dGUg44KS6LaF44GI44Gm44GE44Gf5aC05ZCI44Gv44Ko44Op44O844GL5L6L5aSWCiAgICAvLyAzMiBiaXQg44G+44GnCiAgICBpZiAobWF4S2V5SWQgPCBrZXlJZCB8fCBtYXhDb3VudCA8IGNvdW50KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFWENFRURFRC1NQVhJTVVNLUJST0FEQ0FTVElORy1USU1FIik7CiAgICB9CiAgICBjb25zdCB3cml0ZUlWID0gZ2V0V3JpdGVJVihjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgIGlmICghd3JpdGVJVikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiV1JJVEVJVi1OT1QtRk9VTkQiKTsKICAgIH0KICAgIGNvbnN0IHBhZGRpbmdMZW5ndGggPSBObiAtIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwogICAgY29uc3QgY291bnRXaXRoUGFkZGluZ0J1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihObik7CiAgICBjb25zdCBjb3VudFdpdGhQYWRkaW5nRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoY291bnRXaXRoUGFkZGluZ0J1ZmZlcik7CiAgICBjb3VudFdpdGhQYWRkaW5nRGF0YVZpZXcuc2V0VWludDMyKHBhZGRpbmdMZW5ndGgsIGNvdW50LCBiaWdFbmRpYW4pOwogICAgY29uc3QgaXYgPSBuZXcgVWludDhBcnJheShObik7CiAgICBjb25zdCBjb3VudFdpdGhQYWRkaW5nID0gbmV3IFVpbnQ4QXJyYXkoY291bnRXaXRoUGFkZGluZ0J1ZmZlcik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5uOyBpKyspIHsKICAgICAgICBpdltpXSA9IHdyaXRlSVZbaV0gXiBjb3VudFdpdGhQYWRkaW5nW2ldOwogICAgfQogICAgcmV0dXJuIGl2Owp9CmZ1bmN0aW9uIHBhcnNlUGF5bG9hZChwYXlsb2FkVHlwZSwgcGF5bG9hZCkgewogICAgcmV0dXJuIFsKICAgICAgICBuZXcgVWludDhBcnJheShwYXlsb2FkLCAwLCB1bmVuY3J5cHRlZEJ5dGVzW3BheWxvYWRUeXBlXSksCiAgICAgICAgbmV3IFVpbnQ4QXJyYXkocGF5bG9hZCwgdW5lbmNyeXB0ZWRCeXRlc1twYXlsb2FkVHlwZV0pLAogICAgXTsKfQpmdW5jdGlvbiBlbmNvZGVGcmFtZUFkZChoZWFkZXIsIHNmcmFtZUhlYWRlciwgY29ubmVjdGlvbklkKSB7CiAgICBjb25zdCBjb25uZWN0aW9uSWREYXRhID0gdGV4dEVuY29kZXIuZW5jb2RlKGNvbm5lY3Rpb25JZCk7CiAgICBjb25zdCBmcmFtZUFkZCA9IG5ldyBVaW50OEFycmF5KGhlYWRlci5ieXRlTGVuZ3RoICsgc2ZyYW1lSGVhZGVyLmJ5dGVMZW5ndGggKyBjb25uZWN0aW9uSWREYXRhLmJ5dGVMZW5ndGgpOwogICAgZnJhbWVBZGQuc2V0KGhlYWRlciwgMCk7CiAgICBmcmFtZUFkZC5zZXQoc2ZyYW1lSGVhZGVyLCBoZWFkZXIuYnl0ZUxlbmd0aCk7CiAgICBmcmFtZUFkZC5zZXQoY29ubmVjdGlvbklkRGF0YSwgaGVhZGVyLmJ5dGVMZW5ndGggKyBzZnJhbWVIZWFkZXIuYnl0ZUxlbmd0aCk7CiAgICByZXR1cm4gZnJhbWVBZGQ7Cn0KYXN5bmMgZnVuY3Rpb24gZW5jcnlwdEZ1bmN0aW9uKGVuY29kZWRGcmFtZSwgY29udHJvbGxlcikgewogICAgY29uc3QgeyBjb25uZWN0aW9uSWQsIGtleUlkLCBkZXJpdmVLZXkgfSA9IGdldExhdGVzdFNlbGZEZXJpdmVLZXkoKTsKICAgIGlmICghZGVyaXZlS2V5KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY3VycmVudENvdW50ID0gZ2V0Q291bnQoY29ubmVjdGlvbklkKTsKICAgIC8vIGNvdW50IOOBjCAzMiBiaXQg5Lul5LiK44Gu5aC05ZCI44Gv5YGc5q2i44GZ44KLCiAgICBpZiAoY3VycmVudENvdW50ID4gbWF4Q291bnQpIHsKICAgICAgICBwb3N0TWVzc2FnZSh7IHR5cGU6ICJkaXNjb25uZWN0IiB9KTsKICAgIH0KICAgIGNvbnN0IGl2ID0gZ2VuZXJhdGVJVihjdXJyZW50Q291bnQsIGNvbm5lY3Rpb25JZCwga2V5SWQpOwogICAgaWYgKCFpdikgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtoZWFkZXIsIHBheWxvYWRdID0gcGFyc2VQYXlsb2FkKGVuY29kZWRGcmFtZS50eXBlLCBlbmNvZGVkRnJhbWUuZGF0YSk7CiAgICBjb25zdCBzZnJhbWVIZWFkZXIgPSBlbmNvZGVTRnJhbWVIZWFkZXIoMCwgY3VycmVudENvdW50LCBrZXlJZCk7CiAgICBjb25zdCBmcmFtZUFkZCA9IGVuY29kZUZyYW1lQWRkKGhlYWRlciwgc2ZyYW1lSGVhZGVyLCBjb25uZWN0aW9uSWQpOwogICAgY3J5cHRvLnN1YnRsZQogICAgICAgIC5lbmNyeXB0KHsKICAgICAgICBuYW1lOiAiQUVTLUdDTSIsCiAgICAgICAgaXY6IGl2LAogICAgICAgIC8vIOaal+WPt+WMluOBleOCjOOBpuOBhOOBquOBhOmDqOWIhgogICAgICAgIGFkZGl0aW9uYWxEYXRhOiBmcmFtZUFkZCwKICAgIH0sIGRlcml2ZUtleSwgcGF5bG9hZCkKICAgICAgICAudGhlbigoY2lwaGVyVGV4dCkgPT4gewogICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgQXJyYXlCdWZmZXIoZnJhbWVBZGQuYnl0ZUxlbmd0aCArIGNpcGhlclRleHQuYnl0ZUxlbmd0aCk7CiAgICAgICAgY29uc3QgbmV3RGF0YVVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobmV3RGF0YSk7CiAgICAgICAgbmV3RGF0YVVpbnQ4LnNldChmcmFtZUFkZCwgMCk7CiAgICAgICAgbmV3RGF0YVVpbnQ4LnNldChuZXcgVWludDhBcnJheShjaXBoZXJUZXh0KSwgZnJhbWVBZGQuYnl0ZUxlbmd0aCk7CiAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVkRnJhbWUpOwogICAgfSk7CiAgICBzZXRDb3VudChjb25uZWN0aW9uSWQsIGN1cnJlbnRDb3VudCArIDEpOwp9CmFzeW5jIGZ1bmN0aW9uIGRlY3J5cHRGdW5jdGlvbihlbmNvZGVkRnJhbWUsIGNvbnRyb2xsZXIpIHsKICAgIC8vIOepuuODleODrOODvOODoOWvvuW/nAogICAgaWYgKGVuY29kZWRGcmFtZS5kYXRhLmJ5dGVMZW5ndGggPCAxKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgICBjb25zdCBmcmFtZU1ldGFkYXRhQnVmZmVyID0gZW5jb2RlZEZyYW1lLmRhdGEuc2xpY2UoMCwgdW5lbmNyeXB0ZWRCeXRlc1tlbmNvZGVkRnJhbWUudHlwZV0pOwogICAgICAgIGNvbnN0IGZyYW1lTWV0YWRhdGEgPSBuZXcgVWludDhBcnJheShmcmFtZU1ldGFkYXRhQnVmZmVyKTsKICAgICAgICBjb25zdCBbc2ZyYW1lSGVhZGVyQnVmZmVyLCBjb25uZWN0aW9uSWRCdWZmZXIsIGVuY3J5cHRlZEZyYW1lQnVmZmVyXSA9IHNwbGl0SGVhZGVyKGVuY29kZWRGcmFtZS5kYXRhLnNsaWNlKHVuZW5jcnlwdGVkQnl0ZXNbZW5jb2RlZEZyYW1lLnR5cGVdKSk7CiAgICAgICAgY29uc3Qgc2ZyYW1lSGVhZGVyID0gbmV3IFVpbnQ4QXJyYXkoc2ZyYW1lSGVhZGVyQnVmZmVyKTsKICAgICAgICBjb25zdCBjb25uZWN0aW9uSWQgPSB0ZXh0RGVjb2Rlci5kZWNvZGUoY29ubmVjdGlvbklkQnVmZmVyKTsKICAgICAgICBjb25zdCBbcywgY291bnQsIGtleUlkXSA9IHBhcnNlU0ZyYW1lSGVhZGVyKHNmcmFtZUhlYWRlckJ1ZmZlcik7CiAgICAgICAgLy8g5LuK5Zue44GvIHMgZmxhZyDjga8gMCDjga7jgb8KICAgICAgICBpZiAocyAhPT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtUy1GTEFHIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRlcml2ZUtleSA9IGdldFJlbW90ZURlcml2ZUtleShjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgICAgICBpZiAoIWRlcml2ZUtleSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGl2ID0gZ2VuZXJhdGVJVihjb3VudCwgY29ubmVjdGlvbklkLCBrZXlJZCk7CiAgICAgICAgaWYgKCFpdikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZyYW1lQWRkID0gZW5jb2RlRnJhbWVBZGQoZnJhbWVNZXRhZGF0YSwgc2ZyYW1lSGVhZGVyLCBjb25uZWN0aW9uSWQpOwogICAgICAgIGNyeXB0by5zdWJ0bGUKICAgICAgICAgICAgLmRlY3J5cHQoewogICAgICAgICAgICBuYW1lOiAiQUVTLUdDTSIsCiAgICAgICAgICAgIGl2OiBpdiwKICAgICAgICAgICAgYWRkaXRpb25hbERhdGE6IGZyYW1lQWRkLAogICAgICAgIH0sIGRlcml2ZUtleSwgbmV3IFVpbnQ4QXJyYXkoZW5jcnlwdGVkRnJhbWVCdWZmZXIpKQogICAgICAgICAgICAudGhlbigocGxhaW5UZXh0KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgQXJyYXlCdWZmZXIoZnJhbWVNZXRhZGF0YUJ1ZmZlci5ieXRlTGVuZ3RoICsgcGxhaW5UZXh0LmJ5dGVMZW5ndGgpOwogICAgICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgICAgICBuZXdVaW50OC5zZXQobmV3IFVpbnQ4QXJyYXkoZnJhbWVNZXRhZGF0YUJ1ZmZlciwgMCwgdW5lbmNyeXB0ZWRCeXRlc1tlbmNvZGVkRnJhbWUudHlwZV0pKTsKICAgICAgICAgICAgbmV3VWludDguc2V0KG5ldyBVaW50OEFycmF5KHBsYWluVGV4dCksIHVuZW5jcnlwdGVkQnl0ZXNbZW5jb2RlZEZyYW1lLnR5cGVdKTsKICAgICAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoZW5jb2RlZEZyYW1lKTsKICAgICAgICB9KTsKICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgICAgLy8g5oOz5a6a5aSW44Gu44OR44Kx44OD44OI44OV44Kp44O844Oe44OD44OI44KS5Y+X5L+h44GX44Gf5aC05ZCICiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHNpbGVuY2VGcmFtZShlbmNvZGVkRnJhbWUpKTsKICAgIH0KfQovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvdHJpcGxlLXNsYXNoLXJlZmVyZW5jZSAqLwovLy8gPHJlZmVyZW5jZSBwYXRoPSIuL2UyZWUudHMiLz4KLy8gbm9uY2Ug44K144Kk44K6CmNvbnN0IE5uID0gMTI7Ci8vIGtleSDjgrXjgqTjgroKY29uc3QgTmsgPSAxNjsKLy8ga2V5IOOCteOCpOOCuu+8iGJpdO+8iQpjb25zdCBrZXlMZW5ndGggPSBOayAqIDg7CmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRGVyaXZlS2V5KG1hdGVyaWFsKSB7CiAgICBjb25zdCBzYWx0ID0gdGV4dEVuY29kZXIuZW5jb2RlKCJTRnJhbWUxMCIpOwogICAgY29uc3QgaW5mbyA9IHRleHRFbmNvZGVyLmVuY29kZSgia2V5Iik7CiAgICBjb25zdCBkZXJpdmVLZXkgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRlcml2ZUtleSh7CiAgICAgICAgbmFtZTogIkhLREYiLAogICAgICAgIHNhbHQ6IHNhbHQsCiAgICAgICAgaGFzaDogIlNIQS0yNTYiLAogICAgICAgIGluZm86IGluZm8sCiAgICB9LCBtYXRlcmlhbCwgewogICAgICAgIG5hbWU6ICJBRVMtR0NNIiwKICAgICAgICBsZW5ndGg6IGtleUxlbmd0aCwKICAgIH0sIGZhbHNlLCBbImVuY3J5cHQiLCAiZGVjcnlwdCJdKTsKICAgIHJldHVybiBkZXJpdmVLZXk7Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXcml0ZUlWKG1hdGVyaWFsKSB7CiAgICBjb25zdCBzYWx0ID0gdGV4dEVuY29kZXIuZW5jb2RlKCJTRnJhbWUxMCIpOwogICAgY29uc3QgaW5mbyA9IHRleHRFbmNvZGVyLmVuY29kZSgic2FsdCIpOwogICAgY29uc3Qgd3JpdGVJVkJ1ZmZlciA9IGF3YWl0IGNyeXB0by5zdWJ0bGUuZGVyaXZlQml0cyh7CiAgICAgICAgbmFtZTogIkhLREYiLAogICAgICAgIHNhbHQ6IHNhbHQsCiAgICAgICAgaGFzaDogIlNIQS0zODQiLAogICAgICAgIGluZm86IGluZm8sCiAgICB9LCBtYXRlcmlhbCwgCiAgICAvLyBJViDjga8gOTYg44OT44OD44OI44Gq44Gu44GnCiAgICBObiAqIDgpOwogICAgY29uc3Qgd3JpdGVJViA9IG5ldyBVaW50OEFycmF5KHdyaXRlSVZCdWZmZXIpOwogICAgcmV0dXJuIHdyaXRlSVY7Cn0KbGV0IHJlbW92YWxUaW1lb3V0SWQgPSAwOwpvbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHsKICAgIGNvbnN0IHsgdHlwZSB9ID0gZXZlbnQuZGF0YTsKICAgIGlmICh0eXBlID09PSAic2VsZlNlY3JldEtleU1hdGVyaWFsIikgewogICAgICAgIGNvbnN0IHsgc2VsZlNlY3JldEtleU1hdGVyaWFsLCBzZWxmQ29ubmVjdGlvbklkLCBzZWxmS2V5SWQsIHdhaXRpbmdUaW1lIH0gPSBldmVudC5kYXRhOwogICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBjcnlwdG8uc3VidGxlCiAgICAgICAgICAgICAgICAuaW1wb3J0S2V5KCJyYXciLCBzZWxmU2VjcmV0S2V5TWF0ZXJpYWwuYnVmZmVyLCAiSEtERiIsIGZhbHNlLCBbImRlcml2ZUJpdHMiLCAiZGVyaXZlS2V5Il0pCiAgICAgICAgICAgICAgICAudGhlbigobWF0ZXJpYWwpID0+IHsKICAgICAgICAgICAgICAgIGdlbmVyYXRlRGVyaXZlS2V5KG1hdGVyaWFsKS50aGVuKChkZXJpdmVLZXkpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRTZWxmRGVyaXZlS2V5KHNlbGZDb25uZWN0aW9uSWQsIHNlbGZLZXlJZCwgZGVyaXZlS2V5KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZ2VuZXJhdGVXcml0ZUlWKG1hdGVyaWFsKS50aGVuKCh3cml0ZUlWKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0V3JpdGVJVihzZWxmQ29ubmVjdGlvbklkLCBzZWxmS2V5SWQsIHdyaXRlSVYpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwgd2FpdGluZ1RpbWUgfHwgMCk7CiAgICAgICAgLy8gVE9ETzogKzEwMDAg44Gn6Y2155Sf5oiQ5b6M44Gr5a6f6KGM44GV44KM44KL44KI44GG44Gr44GX44Gm44GE44KL44GM55+t44GE5aC05ZCI44Gv5Ly444Gw44GZCiAgICAgICAgY29uc3QgcmVtb3ZhbFdhaXRpbmdUaW1lID0gKHdhaXRpbmdUaW1lIHx8IDApICsgMTAwMDsKICAgICAgICBpZiAocmVtb3ZhbFRpbWVvdXRJZCkgewogICAgICAgICAgICAvLyDli5XkvZzmuIjjgb/jgr/jgqTjg57jg7zmnInjgooKICAgICAgICAgICAgaWYgKHdhaXRpbmdUaW1lKSB7CiAgICAgICAgICAgICAgICAvLyBjb25uZWN0aW9uLmRlc3Ryb3llZAogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlbW92YWxUaW1lb3V0SWQpOwogICAgICAgICAgICAgICAgcmVtb3ZhbFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlbW92ZU9sZFJlbW90ZURlcml2ZUtleXMoKTsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVtb3ZhbFRpbWVvdXRJZCk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZhbFRpbWVvdXRJZCA9IDA7CiAgICAgICAgICAgICAgICB9LCByZW1vdmFsV2FpdGluZ1RpbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyDli5XkvZzmuIjjgb/jgr/jgqTjg57jg7zjgarjgZcKICAgICAgICAgICAgLy8gY29ubmVjdGlvbi5jcmVhdGVkIOOBruWgtOWQiOOCguWwkeOBl+Wun+ihjOOCkumBheOCieOBm+OCiwogICAgICAgICAgICByZW1vdmFsVGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICByZW1vdmVPbGRSZW1vdGVEZXJpdmVLZXlzKCk7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVtb3ZhbFRpbWVvdXRJZCk7CiAgICAgICAgICAgICAgICByZW1vdmFsVGltZW91dElkID0gMDsKICAgICAgICAgICAgfSwgcmVtb3ZhbFdhaXRpbmdUaW1lKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09PSAicmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxzIikgewogICAgICAgIGNvbnN0IHsgcmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxzIH0gPSBldmVudC5kYXRhOwogICAgICAgIGZvciAoY29uc3QgW2Nvbm5lY3Rpb25JZCwgcmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxdIG9mIE9iamVjdC5lbnRyaWVzKHJlbW90ZVNlY3JldEtleU1hdGVyaWFscykpIHsKICAgICAgICAgICAgY29uc3QgeyBrZXlJZCwgc2VjcmV0S2V5TWF0ZXJpYWwgfSA9IHJlbW90ZVNlY3JldEtleU1hdGVyaWFsOwogICAgICAgICAgICBjcnlwdG8uc3VidGxlCiAgICAgICAgICAgICAgICAuaW1wb3J0S2V5KCJyYXciLCBzZWNyZXRLZXlNYXRlcmlhbC5idWZmZXIsICJIS0RGIiwgZmFsc2UsIFsiZGVyaXZlQml0cyIsICJkZXJpdmVLZXkiXSkKICAgICAgICAgICAgICAgIC50aGVuKChtYXRlcmlhbCkgPT4gewogICAgICAgICAgICAgICAgZ2VuZXJhdGVEZXJpdmVLZXkobWF0ZXJpYWwpLnRoZW4oKGRlcml2ZUtleSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFJlbW90ZURlcml2ZUtleShjb25uZWN0aW9uSWQsIGtleUlkLCBkZXJpdmVLZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZVdyaXRlSVYobWF0ZXJpYWwpLnRoZW4oKHdyaXRlSVYpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRXcml0ZUlWKGNvbm5lY3Rpb25JZCwga2V5SWQsIHdyaXRlSVYpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRMYXRlc3RSZW1vdGVLZXlJZChjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAodHlwZSA9PT0gInJlbW92ZVJlbW90ZURlcml2ZUtleSIpIHsKICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb25JZCB9ID0gZXZlbnQuZGF0YTsKICAgICAgICByZW1vdmVEZXJpdmVLZXkoY29ubmVjdGlvbklkKTsKICAgIH0KICAgIGVsc2UgaWYgKHR5cGUgPT09ICJlbmNyeXB0IikgewogICAgICAgIGNvbnN0IHsgcmVhZGFibGVTdHJlYW0sIHdyaXRhYmxlU3RyZWFtIH0gPSBldmVudC5kYXRhOwogICAgICAgIGNvbnN0IHRyYW5zZm9ybVN0cmVhbSA9IG5ldyBUcmFuc2Zvcm1TdHJlYW0oewogICAgICAgICAgICB0cmFuc2Zvcm06IGVuY3J5cHRGdW5jdGlvbiwKICAgICAgICB9KTsKICAgICAgICByZWFkYWJsZVN0cmVhbS5waXBlVGhyb3VnaCh0cmFuc2Zvcm1TdHJlYW0pLnBpcGVUbyh3cml0YWJsZVN0cmVhbSk7CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09PSAiZGVjcnlwdCIpIHsKICAgICAgICBjb25zdCB7IHJlYWRhYmxlU3RyZWFtLCB3cml0YWJsZVN0cmVhbSB9ID0gZXZlbnQuZGF0YTsKICAgICAgICBjb25zdCB0cmFuc2Zvcm1TdHJlYW0gPSBuZXcgVHJhbnNmb3JtU3RyZWFtKHsKICAgICAgICAgICAgdHJhbnNmb3JtOiBkZWNyeXB0RnVuY3Rpb24sCiAgICAgICAgfSk7CiAgICAgICAgcmVhZGFibGVTdHJlYW0ucGlwZVRocm91Z2godHJhbnNmb3JtU3RyZWFtKS5waXBlVG8od3JpdGFibGVTdHJlYW0pOwogICAgfQogICAgZWxzZSBpZiAodHlwZSA9PT0gImNsZWFyIikgewogICAgICAgIGNvdW50TWFwLmNsZWFyKCk7CiAgICAgICAgd3JpdGVJVk1hcC5jbGVhcigpOwogICAgICAgIHJlbW90ZURlcml2ZUtleU1hcC5jbGVhcigpOwogICAgICAgIGxhdGVzdFJlbW90ZUtleUlkTWFwLmNsZWFyKCk7CiAgICAgICAgc2VsZkRlcml2ZUtleU1hcC5jbGVhcigpOwogICAgfQp9Owo=");this.worker=new Worker(URL.createObjectURL(new Blob([e],{type:"application/javascript"}))),this.worker.onmessage=e=>{const{operation:t}=e.data;"disconnect"===t&&"function"===typeof this.onWorkerDisconnect&&this.onWorkerDisconnect()}}clearWorker(){this.worker&&this.worker.postMessage({type:"clear"})}terminateWorker(){this.worker&&this.worker.terminate()}async init(){const{preKeyBundle:e}=await window.e2ee.init();return e}setupSenderTransform(e,t){if(!this.worker)throw new Error("Worker is null. Call startWorker in advance.");const n={type:"encrypt",readableStream:e,writableStream:t};this.worker.postMessage(n,[e,t])}setupReceiverTransform(e,t){if(!this.worker)throw new Error("Worker is null. Call startWorker in advance.");const n={type:"decrypt",readableStream:e,writableStream:t};this.worker.postMessage(n,[e,t])}postRemoteSecretKeyMaterials(e){if(!this.worker)throw new Error("Worker is null. Call startWorker in advance.");this.worker.postMessage({type:"remoteSecretKeyMaterials",remoteSecretKeyMaterials:e.remoteSecretKeyMaterials})}postRemoveRemoteDeriveKey(e){if(!this.worker)throw new Error("Worker is null. Call startWorker in advance.");this.worker.postMessage({type:"removeRemoteDeriveKey",connectionId:e})}postSelfSecretKeyMaterial(e,t,n,r=0){if(!this.worker)throw new Error("Worker is null. Call startWorker in advance.");this.worker.postMessage({type:"selfSecretKeyMaterial",selfConnectionId:e,selfKeyId:t,selfSecretKeyMaterial:n,waitingTime:r})}startSession(e,t){const[n,r]=window.e2ee.startSession(e,t.identityKey,t.signedPreKey,t.preKeySignature);if(r)throw r;return n}stopSession(e){const[t,n]=window.e2ee.stopSession(e);if(n)throw n;return t}receiveMessage(e){const[t,n]=window.e2ee.receiveMessage(e);if(n)throw n;return t}start(e){const[t,n]=window.e2ee.start(e);if(n)throw n;return t}addPreKeyBundle(e,t){const n=window.e2ee.addPreKeyBundle(e,t.identityKey,t.signedPreKey,t.preKeySignature);if(n)throw n}selfFingerprint(){return window.e2ee.selfFingerprint()}remoteFingerprints(){return window.e2ee.remoteFingerprints()}static async loadWasm(e){if(void 0===!window.e2ee)return void console.warn("E2ee wasm is already loaded. Will not be reload.");if((()=>{if("undefined"!==typeof global);else if("undefined"!==typeof window)window.global=window;else{if("undefined"===typeof self)throw new Error("cannot export Go (neither global, window nor self is defined)");self.global=self}if(global.require||"undefined"===typeof require||(global.require=require),!global.fs&&global.require){const e=require("fs");0!==Object.keys(e)&&(global.fs=e)}const e=()=>{const e=new Error("not implemented");return e.code="ENOSYS",e};if(!global.fs){let t="";global.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(e,r){t+=n.decode(r);const i=t.lastIndexOf("\n");return-1!=i&&(console.log(t.substr(0,i)),t=t.substr(i+1)),r.length},write(t,n,r,i,o,a){0===r&&i===n.length&&null===o?a(null,this.writeSync(t,n)):a(e())},chmod(t,n,r){r(e())},chown(t,n,r,i){i(e())},close(t,n){n(e())},fchmod(t,n,r){r(e())},fchown(t,n,r,i){i(e())},fstat(t,n){n(e())},fsync(e,t){t(null)},ftruncate(t,n,r){r(e())},lchown(t,n,r,i){i(e())},link(t,n,r){r(e())},lstat(t,n){n(e())},mkdir(t,n,r){r(e())},open(t,n,r,i){i(e())},read(t,n,r,i,o,a){a(e())},readdir(t,n){n(e())},readlink(t,n){n(e())},rename(t,n,r){r(e())},rmdir(t,n){n(e())},stat(t,n){n(e())},symlink(t,n,r){r(e())},truncate(t,n,r){r(e())},unlink(t,n){n(e())},utimes(t,n,r,i){i(e())}}}if(global.process||(global.process={getuid:()=>-1,getgid:()=>-1,geteuid:()=>-1,getegid:()=>-1,getgroups(){throw e()},pid:-1,ppid:-1,umask(){throw e()},cwd(){throw e()},chdir(){throw e()}}),!global.crypto){const e=require("crypto");global.crypto={getRandomValues(t){e.randomFillSync(t)}}}global.performance||(global.performance={now(){const[e,t]=r.hrtime();return 1e3*e+t/1e6}}),global.TextEncoder||(global.TextEncoder=require("util").TextEncoder),global.TextDecoder||(global.TextDecoder=require("util").TextDecoder);const t=new TextEncoder("utf-8"),n=new TextDecoder("utf-8");if(global.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=e=>{0!==e&&console.warn("exit code:",e)},this._exitPromise=new Promise((e=>{this._resolveExitPromise=e})),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const e=(e,t)=>{this.mem.setUint32(e+0,t,!0),this.mem.setUint32(e+4,Math.floor(t/4294967296),!0)},r=e=>this.mem.getUint32(e+0,!0)+4294967296*this.mem.getInt32(e+4,!0),i=e=>{const t=this.mem.getFloat64(e,!0);if(0===t)return;if(!isNaN(t))return t;const n=this.mem.getUint32(e,!0);return this._values[n]},o=(e,t)=>{const n=2146959360;if("number"===typeof t&&0!==t)return isNaN(t)?(this.mem.setUint32(e+4,n,!0),void this.mem.setUint32(e,0,!0)):void this.mem.setFloat64(e,t,!0);if(void 0===t)return void this.mem.setFloat64(e,0,!0);let r=this._ids.get(t);void 0===r&&(r=this._idPool.pop(),void 0===r&&(r=this._values.length),this._values[r]=t,this._goRefCounts[r]=0,this._ids.set(t,r)),this._goRefCounts[r]++;let i=0;switch(typeof t){case"object":null!==t&&(i=1);break;case"string":i=2;break;case"symbol":i=3;break;case"function":i=4}this.mem.setUint32(e+4,n|i,!0),this.mem.setUint32(e,r,!0)},a=e=>{const t=r(e+0),n=r(e+8);return new Uint8Array(this._inst.exports.mem.buffer,t,n)},s=e=>{const t=r(e+0),n=r(e+8),o=new Array(n);for(let r=0;r<n;r++)o[r]=i(t+8*r);return o},l=e=>{const t=r(e+0),i=r(e+8);return n.decode(new DataView(this._inst.exports.mem.buffer,t,i))},c=Date.now()-performance.now();this.importObject={go:{"runtime.wasmExit":e=>{const t=this.mem.getInt32(e+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(t)},"runtime.wasmWrite":e=>{const t=r(e+8),n=r(e+16),i=this.mem.getInt32(e+24,!0);fs.writeSync(t,new Uint8Array(this._inst.exports.mem.buffer,n,i))},"runtime.resetMemoryDataView":e=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":t=>{e(t+8,1e6*(c+performance.now()))},"runtime.walltime1":t=>{const n=(new Date).getTime();e(t+8,n/1e3),this.mem.setInt32(t+16,n%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":e=>{const t=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(t,setTimeout((()=>{for(this._resume();this._scheduledTimeouts.has(t);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()}),r(e+8)+1)),this.mem.setInt32(e+16,t,!0)},"runtime.clearTimeoutEvent":e=>{const t=this.mem.getInt32(e+8,!0);clearTimeout(this._scheduledTimeouts.get(t)),this._scheduledTimeouts.delete(t)},"runtime.getRandomData":e=>{crypto.getRandomValues(a(e+8))},"syscall/js.finalizeRef":e=>{const t=this.mem.getUint32(e+8,!0);if(this._goRefCounts[t]--,0===this._goRefCounts[t]){const e=this._values[t];this._values[t]=null,this._ids.delete(e),this._idPool.push(t)}},"syscall/js.stringVal":e=>{o(e+24,l(e+8))},"syscall/js.valueGet":e=>{const t=Reflect.get(i(e+8),l(e+16));e=this._inst.exports.getsp(),o(e+32,t)},"syscall/js.valueSet":e=>{Reflect.set(i(e+8),l(e+16),i(e+32))},"syscall/js.valueDelete":e=>{Reflect.deleteProperty(i(e+8),l(e+16))},"syscall/js.valueIndex":e=>{o(e+24,Reflect.get(i(e+8),r(e+16)))},"syscall/js.valueSetIndex":e=>{Reflect.set(i(e+8),r(e+16),i(e+24))},"syscall/js.valueCall":e=>{try{const t=i(e+8),n=Reflect.get(t,l(e+16)),r=s(e+32),a=Reflect.apply(n,t,r);e=this._inst.exports.getsp(),o(e+56,a),this.mem.setUint8(e+64,1)}catch(Q){o(e+56,Q),this.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":e=>{try{const t=i(e+8),n=s(e+16),r=Reflect.apply(t,void 0,n);e=this._inst.exports.getsp(),o(e+40,r),this.mem.setUint8(e+48,1)}catch(Q){o(e+40,Q),this.mem.setUint8(e+48,0)}},"syscall/js.valueNew":e=>{try{const t=i(e+8),n=s(e+16),r=Reflect.construct(t,n);e=this._inst.exports.getsp(),o(e+40,r),this.mem.setUint8(e+48,1)}catch(Q){o(e+40,Q),this.mem.setUint8(e+48,0)}},"syscall/js.valueLength":t=>{e(t+16,parseInt(i(t+8).length))},"syscall/js.valuePrepareString":n=>{const r=t.encode(String(i(n+8)));o(n+16,r),e(n+24,r.length)},"syscall/js.valueLoadString":e=>{const t=i(e+8);a(e+16).set(t)},"syscall/js.valueInstanceOf":e=>{this.mem.setUint8(e+24,i(e+8)instanceof i(e+16)?1:0)},"syscall/js.copyBytesToGo":t=>{const n=a(t+8),r=i(t+32);if(!(r instanceof Uint8Array||r instanceof Uint8ClampedArray))return void this.mem.setUint8(t+48,0);const o=r.subarray(0,n.length);n.set(o),e(t+40,o.length),this.mem.setUint8(t+48,1)},"syscall/js.copyBytesToJS":t=>{const n=i(t+8),r=a(t+16);if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))return void this.mem.setUint8(t+48,0);const o=r.subarray(0,n.length);n.set(o),e(t+40,o.length),this.mem.setUint8(t+48,1)},debug:e=>{console.log(e)}}}}async run(e){this._inst=e,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,global,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[global,5],[this,6]]),this._idPool=[],this.exited=!1;let n=4096;const r=e=>{const r=n,i=t.encode(e+"\0");return new Uint8Array(this.mem.buffer,n,i.length).set(i),n+=i.length,n%8!==0&&(n+=8-n%8),r},i=this.argv.length,o=[];this.argv.forEach((e=>{o.push(r(e))})),o.push(0),Object.keys(this.env).sort().forEach((e=>{o.push(r(`${e}=${this.env[e]}`))})),o.push(0);const a=n;o.forEach((e=>{this.mem.setUint32(n,e,!0),this.mem.setUint32(n+4,0,!0),n+=8})),this._inst.exports.run(i,a),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(e){const t=this;return function(){const n={id:e,this:this,args:arguments};return t._pendingEvent=n,t._resume(),n.result}}},global.require&&global.require.main===module&&global.process&&global.process.versions&&!global.process.versions.electron){r.argv.length<3&&(console.error("usage: go_js_wasm_exec [wasm binary] [arguments]"),r.exit(1));const e=new Go;e.argv=r.argv.slice(2),e.env=Object.assign({TMPDIR:require("os").tmpdir()},r.env),e.exit=r.exit,WebAssembly.instantiate(fs.readFileSync(r.argv[2]),e.importObject).then((t=>(r.on("exit",(t=>{0!==t||e.exited||(e._pendingEvent={id:0},e._resume())})),e.run(t.instance)))).catch((e=>{console.error(e),r.exit(1)}))}})(),!window.Go)throw new Error(`Failed to load module Go. window.Go is ${window.Go}.`);const t=new Go,{instance:n}=await WebAssembly.instantiateStreaming(fetch(e),t.importObject);if(t.run(n),!window.e2ee)throw new Error(`Failed to load module e2ee. window.e2ee is ${window.e2ee}.`)}static version(){return"2021.1.0"}static wasmVersion(){return window.e2ee.version()}}var a=(()=>{var e="file:///Users/voluntas/shiguredo/sora-devtools/node_modules/sora-js-sdk/dist/sora.mjs";return function(t){function o(){return F.buffer!=N&&te(F.buffer),X}function a(){return F.buffer!=N&&te(F.buffer),P}function s(){return F.buffer!=N&&te(F.buffer),Y}function l(){return F.buffer!=N&&te(F.buffer),j}function c(){return F.buffer!=N&&te(F.buffer),U}function u(){return F.buffer!=N&&te(F.buffer),x}function d(){return F.buffer!=N&&te(F.buffer),J}var g,h,m="undefined"!=typeof(t=t||{})?t:{};m.ready=new Promise((function(e,t){g=e,h=t}));var f,p,C,w=Object.assign({},m),y="./this.program",I=(e,t)=>{throw t},v="object"==typeof window,b="function"==typeof importScripts,A="object"==typeof r&&"object"==typeof r.versions&&"string"==typeof r.versions.node,S=m.ENVIRONMENT_IS_PTHREAD||!1,k="";function Z(e){return m.locateFile?m.locateFile(e,k):k+e}if(A){var _,E;let e;k=b?require("path").dirname(k)+"/":__dirname+"/","function"===typeof require&&(_=require("fs"),E=require("path")),f=(e,t)=>(e=E.normalize(e),_.readFileSync(e,t?void 0:"utf8")),C=e=>{var t=f(e,!0);return t.buffer||(t=new Uint8Array(t)),t},p=(e,t,n)=>{e=E.normalize(e),_.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},r.argv.length>1&&(y=r.argv[1].replace(/\\/g,"/")),r.argv.slice(2),r.on("uncaughtException",(function(e){if(!(e instanceof Ae))throw e})),r.on("unhandledRejection",(function(e){throw e})),I=(e,t)=>{if(se())throw r.exitCode=e,t;!function(e){if(e instanceof Ae)return;R("exiting due to exception: "+e)}(t),r.exit(e)},m.inspect=function(){return"[Emscripten Module object]"};try{e=require("worker_threads")}catch(Wr){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),Wr}global.Worker=e.Worker}else(v||b)&&(b?k=self.location.href:"undefined"!=typeof document&&document.currentScript&&(k=document.currentScript.src),k=0!==(k=e).indexOf("blob:")?k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1):"",A||(f=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},b&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));A&&"undefined"==typeof performance&&(global.performance=require("perf_hooks").performance);var V=console.log.bind(console),W=console.warn.bind(console);A&&(V=e=>_.writeSync(1,e+"\n"),W=e=>_.writeSync(2,e+"\n"));var T=m.print||V,R=m.printErr||W;Object.assign(m,w),w=null,m.arguments&&m.arguments,m.thisProgram&&(y=m.thisProgram),m.quit&&(I=m.quit);var G;m.wasmBinary&&(G=m.wasmBinary);var F,O,L=m.noExitRuntime||!0;"object"!=typeof WebAssembly&&he("no native wasm support detected");var D,B=!1;function M(e,t){e||he(t)}var N,X,P,Y,j,U,x,K,J,H="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.buffer&&H)return H.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,i):e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function Q(e,t){return e?z(a(),e,t):""}function $(e,t,n,r){if(!(r>0))return 0;for(var i=n,o=n+r-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a);if(s<=127){if(n>=o)break;t[n++]=s}else if(s<=2047){if(n+1>=o)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=o)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function q(e,t,n){return $(e,a(),t,n)}function ee(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t}function te(e){N=e,m.HEAP8=X=new Int8Array(e),m.HEAP16=Y=new Int16Array(e),m.HEAP32=U=new Int32Array(e),m.HEAPU8=P=new Uint8Array(e),m.HEAPU16=j=new Uint16Array(e),m.HEAPU32=x=new Uint32Array(e),m.HEAPF32=K=new Float32Array(e),m.HEAPF64=J=new Float64Array(e)}S&&(N=m.buffer);var ne,re=m.INITIAL_MEMORY||16777216;if(S)F=m.wasmMemory,N=m.buffer;else if(m.wasmMemory)F=m.wasmMemory;else if(!((F=new WebAssembly.Memory({initial:re/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw R("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),A&&R("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");F&&(N=F.buffer),re=N.byteLength,te(N);var ie=[],oe=[],ae=[];function se(){return L}function le(){S||(m.noFSInit||Te.init.initialized||Te.init(),Te.ignorePermissions=!1,Ye(oe))}var ce=0,ue=null;function de(e){ce++,m.monitorRunDependencies&&m.monitorRunDependencies(ce)}function ge(e){if(ce--,m.monitorRunDependencies&&m.monitorRunDependencies(ce),0==ce&&ue){var t=ue;ue=null,t()}}function he(e){m.onAbort&&m.onAbort(e),R(e="Aborted("+e+")"),B=!0,D=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw h(t),t}var me,fe,pe;function Ce(e){return e.startsWith("data:application/octet-stream;base64,")}function we(e){return e.startsWith("file://")}function ye(e){try{if(e==me&&G)return new Uint8Array(G);if(C)return C(e);throw"both async and sync fetching of the wasm failed"}catch(R){he(R)}}m.locateFile?Ce(me="lyra.wasm")||(me=Z(me)):me=new n.U(n(9025)).toString();var Ie,ve={209600:()=>"undefined"!==typeof wasmOffsetConverter};function be(e,t){if(Me.mainLoop.timingMode=e,Me.mainLoop.timingValue=t,!Me.mainLoop.func)return 1;if(Me.mainLoop.running||(Me.mainLoop.running=!0),0==e)Me.mainLoop.scheduler=function(){var e=0|Math.max(0,Me.mainLoop.tickStartTime+t-Ie());setTimeout(Me.mainLoop.runner,e)},Me.mainLoop.method="timeout";else if(1==e)Me.mainLoop.scheduler=function(){Me.requestAnimationFrame(Me.mainLoop.runner)},Me.mainLoop.method="rAF";else if(2==e){if("undefined"==typeof setImmediate){var n=[],r="setimmediate";addEventListener("message",(e=>{e.data!==r&&e.data.target!==r||(e.stopPropagation(),n.shift()())}),!0),setImmediate=function(e){n.push(e),b?(void 0===m.setImmediates&&(m.setImmediates=[]),m.setImmediates.push(e),postMessage({target:r})):postMessage(r,"*")}}Me.mainLoop.scheduler=function(){setImmediate(Me.mainLoop.runner)},Me.mainLoop.method="immediate"}return 0}function Ae(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Ie=A?()=>{var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:S?()=>performance.now()-m.__performance_now_clock_drift:()=>performance.now();var Se={isAbs:e=>"/"===e.charAt(0),splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},normalize:e=>{var t=Se.isAbs(e),n="/"===e.substr(-1);return(e=Se.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=Se.splitPath(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},basename:e=>{if("/"===e)return"/";var t=(e=(e=Se.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},join:function(){var e=Array.prototype.slice.call(arguments);return Se.normalize(e.join("/"))},join2:(e,t)=>Se.normalize(e+"/"+t)};function ke(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}if(A)try{var t=require("crypto");return()=>t.randomBytes(1)[0]}catch(Wr){}return()=>he("randomDevice")}var Ze={resolve:function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:Te.cwd();if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";e=r+"/"+e,t=Se.isAbs(r)}return(t?"/":"")+(e=Se.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||"."},relative:(e,t)=>{function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=Ze.resolve(e).substr(1),t=Ze.resolve(t).substr(1);for(var r=n(e.split("/")),i=n(t.split("/")),o=Math.min(r.length,i.length),a=o,s=0;s<o;s++)if(r[s]!==i[s]){a=s;break}var l=[];for(s=a;s<r.length;s++)l.push("..");return(l=l.concat(i.slice(a))).join("/")}};function _e(e,t,n){var r=n>0?n:ee(e)+1,i=new Array(r),o=$(e,i,0,i.length);return t&&(i.length=o),i}var Ee={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){Ee.ttys[e]={input:[],output:[],ops:t},Te.registerDevice(e,Ee.stream_ops)},stream_ops:{open:function(e){var t=Ee.ttys[e.node.rdev];if(!t)throw new Te.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.fsync(e.tty)},fsync:function(e){e.tty.ops.fsync(e.tty)},read:function(e,t,n,r,i){if(!e.tty||!e.tty.ops.get_char)throw new Te.ErrnoError(60);for(var o=0,a=0;a<r;a++){var s;try{s=e.tty.ops.get_char(e.tty)}catch(Wr){throw new Te.ErrnoError(29)}if(void 0===s&&0===o)throw new Te.ErrnoError(6);if(null===s||void 0===s)break;o++,t[n+a]=s}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,n,r,i){if(!e.tty||!e.tty.ops.put_char)throw new Te.ErrnoError(60);try{for(var o=0;o<r;o++)e.tty.ops.put_char(e.tty,t[n+o])}catch(Wr){throw new Te.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(A){var n=i.alloc(256),o=0;try{o=_.readSync(r.stdin.fd,n,0,256,-1)}catch(Wr){if(!Wr.toString().includes("EOF"))throw Wr;o=0}t=o>0?n.slice(0,o).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=_e(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(T(z(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(T(z(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(R(z(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(R(z(e.output,0)),e.output=[])}}};function Ve(e){e=function(e,t){return Math.ceil(e/t)*t}(e,65536);var t=Cr(65536,e);return t?function(e,t){return a().fill(0,e,e+t),e}(t,e):0}var We={ops_table:null,mount:function(e){return We.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(Te.isBlkdev(n)||Te.isFIFO(n))throw new Te.ErrnoError(63);We.ops_table||(We.ops_table={dir:{node:{getattr:We.node_ops.getattr,setattr:We.node_ops.setattr,lookup:We.node_ops.lookup,mknod:We.node_ops.mknod,rename:We.node_ops.rename,unlink:We.node_ops.unlink,rmdir:We.node_ops.rmdir,readdir:We.node_ops.readdir,symlink:We.node_ops.symlink},stream:{llseek:We.stream_ops.llseek}},file:{node:{getattr:We.node_ops.getattr,setattr:We.node_ops.setattr},stream:{llseek:We.stream_ops.llseek,read:We.stream_ops.read,write:We.stream_ops.write,allocate:We.stream_ops.allocate,mmap:We.stream_ops.mmap,msync:We.stream_ops.msync}},link:{node:{getattr:We.node_ops.getattr,setattr:We.node_ops.setattr,readlink:We.node_ops.readlink},stream:{}},chrdev:{node:{getattr:We.node_ops.getattr,setattr:We.node_ops.setattr},stream:Te.chrdev_stream_ops}});var i=Te.createNode(e,t,n,r);return Te.isDir(i.mode)?(i.node_ops=We.ops_table.dir.node,i.stream_ops=We.ops_table.dir.stream,i.contents={}):Te.isFile(i.mode)?(i.node_ops=We.ops_table.file.node,i.stream_ops=We.ops_table.file.stream,i.usedBytes=0,i.contents=null):Te.isLink(i.mode)?(i.node_ops=We.ops_table.link.node,i.stream_ops=We.ops_table.link.stream):Te.isChrdev(i.mode)&&(i.node_ops=We.ops_table.chrdev.node,i.stream_ops=We.ops_table.chrdev.stream),i.timestamp=Date.now(),e&&(e.contents[t]=i,e.timestamp=i.timestamp),i},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var n=e.contents?e.contents.length:0;if(!(n>=t)){t=Math.max(t,n*(n<1048576?2:1.125)>>>0),0!=n&&(t=Math.max(t,256));var r=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(r.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var n=e.contents;e.contents=new Uint8Array(t),n&&e.contents.set(n.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=Te.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Te.isDir(e.mode)?t.size=4096:Te.isFile(e.mode)?t.size=e.usedBytes:Te.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&We.resizeFileStorage(e,t.size)},lookup:function(e,t){throw Te.genericErrors[44]},mknod:function(e,t,n,r){return We.createNode(e,t,n,r)},rename:function(e,t,n){if(Te.isDir(e.mode)){var r;try{r=Te.lookupNode(t,n)}catch(Wr){}if(r)for(var i in r.contents)throw new Te.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=n,t.contents[n]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var n=Te.lookupNode(e,t);for(var r in n.contents)throw new Te.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var n in e.contents)e.contents.hasOwnProperty(n)&&t.push(n);return t},symlink:function(e,t,n){var r=We.createNode(e,t,41471,0);return r.link=n,r},readlink:function(e){if(!Te.isLink(e.mode))throw new Te.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,n,r,i){var o=e.node.contents;if(i>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-i,r);if(a>8&&o.subarray)t.set(o.subarray(i,i+a),n);else for(var s=0;s<a;s++)t[n+s]=o[i+s];return a},write:function(e,t,n,r,i,a){if(t.buffer===o().buffer&&(a=!1),!r)return 0;var s=e.node;if(s.timestamp=Date.now(),t.subarray&&(!s.contents||s.contents.subarray)){if(a)return s.contents=t.subarray(n,n+r),s.usedBytes=r,r;if(0===s.usedBytes&&0===i)return s.contents=t.slice(n,n+r),s.usedBytes=r,r;if(i+r<=s.usedBytes)return s.contents.set(t.subarray(n,n+r),i),r}if(We.expandFileStorage(s,i+r),s.contents.subarray&&t.subarray)s.contents.set(t.subarray(n,n+r),i);else for(var l=0;l<r;l++)s.contents[i+l]=t[n+l];return s.usedBytes=Math.max(s.usedBytes,i+r),r},llseek:function(e,t,n){var r=t;if(1===n?r+=e.position:2===n&&Te.isFile(e.node.mode)&&(r+=e.node.usedBytes),r<0)throw new Te.ErrnoError(28);return r},allocate:function(e,t,n){We.expandFileStorage(e.node,t+n),e.node.usedBytes=Math.max(e.node.usedBytes,t+n)},mmap:function(e,t,n,r,i){if(!Te.isFile(e.node.mode))throw new Te.ErrnoError(43);var a,s,l=e.node.contents;if(2&i||l.buffer!==N){if((n>0||n+t<l.length)&&(l=l.subarray?l.subarray(n,n+t):Array.prototype.slice.call(l,n,n+t)),s=!0,!(a=Ve(t)))throw new Te.ErrnoError(48);o().set(l,a)}else s=!1,a=l.byteOffset;return{ptr:a,allocated:s}},msync:function(e,t,n,r,i){return We.stream_ops.write(e,t,0,r,n,!1),0}}};var Te={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(e,t={})=>{if(!(e=Ze.resolve(e)))return{path:"",node:null};if((t=Object.assign({follow_mount:!0,recurse_count:0},t)).recurse_count>8)throw new Te.ErrnoError(32);for(var n=e.split("/").filter((e=>!!e)),r=Te.root,i="/",o=0;o<n.length;o++){var a=o===n.length-1;if(a&&t.parent)break;if(r=Te.lookupNode(r,n[o]),i=Se.join2(i,n[o]),Te.isMountpoint(r)&&(!a||a&&t.follow_mount)&&(r=r.mounted.root),!a||t.follow)for(var s=0;Te.isLink(r.mode);){var l=Te.readlink(i);if(i=Ze.resolve(Se.dirname(i),l),r=Te.lookupPath(i,{recurse_count:t.recurse_count+1}).node,s++>40)throw new Te.ErrnoError(32)}}return{path:i,node:r}},getPath:e=>{for(var t;;){if(Te.isRoot(e)){var n=e.mount.mountpoint;return t?"/"!==n[n.length-1]?n+"/"+t:n+t:n}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:(e,t)=>{for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%Te.nameTable.length},hashAddNode:e=>{var t=Te.hashName(e.parent.id,e.name);e.name_next=Te.nameTable[t],Te.nameTable[t]=e},hashRemoveNode:e=>{var t=Te.hashName(e.parent.id,e.name);if(Te.nameTable[t]===e)Te.nameTable[t]=e.name_next;else for(var n=Te.nameTable[t];n;){if(n.name_next===e){n.name_next=e.name_next;break}n=n.name_next}},lookupNode:(e,t)=>{var n=Te.mayLookup(e);if(n)throw new Te.ErrnoError(n,e);for(var r=Te.hashName(e.id,t),i=Te.nameTable[r];i;i=i.name_next){var o=i.name;if(i.parent.id===e.id&&o===t)return i}return Te.lookup(e,t)},createNode:(e,t,n,r)=>{var i=new Te.FSNode(e,t,n,r);return Te.hashAddNode(i),i},destroyNode:e=>{Te.hashRemoveNode(e)},isRoot:e=>e===e.parent,isMountpoint:e=>!!e.mounted,isFile:e=>32768===(61440&e),isDir:e=>16384===(61440&e),isLink:e=>40960===(61440&e),isChrdev:e=>8192===(61440&e),isBlkdev:e=>24576===(61440&e),isFIFO:e=>4096===(61440&e),isSocket:e=>49152===(49152&e),flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:e=>{var t=Te.flagModes[e];if("undefined"==typeof t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:e=>{var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:(e,t)=>Te.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2,mayLookup:e=>{var t=Te.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:(e,t)=>{try{Te.lookupNode(e,t);return 20}catch(Wr){}return Te.nodePermissions(e,"wx")},mayDelete:(e,t,n)=>{var r;try{r=Te.lookupNode(e,t)}catch(Wr){return Wr.errno}var i=Te.nodePermissions(e,"wx");if(i)return i;if(n){if(!Te.isDir(r.mode))return 54;if(Te.isRoot(r)||Te.getPath(r)===Te.cwd())return 10}else if(Te.isDir(r.mode))return 31;return 0},mayOpen:(e,t)=>e?Te.isLink(e.mode)?32:Te.isDir(e.mode)&&("r"!==Te.flagsToPermissionString(t)||512&t)?31:Te.nodePermissions(e,Te.flagsToPermissionString(t)):44,MAX_OPEN_FDS:4096,nextfd:(e=0,t=Te.MAX_OPEN_FDS)=>{for(var n=e;n<=t;n++)if(!Te.streams[n])return n;throw new Te.ErrnoError(33)},getStream:e=>Te.streams[e],createStream:(e,t,n)=>{Te.FSStream||(Te.FSStream=function(){this.shared={}},Te.FSStream.prototype={},Object.defineProperties(Te.FSStream.prototype,{object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!==(2097155&this.flags)}},isWrite:{get:function(){return 0!==(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(e){this.shared.flags=e}},position:{get:function(){return this.shared.position},set:function(e){this.shared.position=e}}})),e=Object.assign(new Te.FSStream,e);var r=Te.nextfd(t,n);return e.fd=r,Te.streams[r]=e,e},closeStream:e=>{Te.streams[e]=null},chrdev_stream_ops:{open:e=>{var t=Te.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:()=>{throw new Te.ErrnoError(70)}},major:e=>e>>8,minor:e=>255&e,makedev:(e,t)=>e<<8|t,registerDevice:(e,t)=>{Te.devices[e]={stream_ops:t}},getDevice:e=>Te.devices[e],getMounts:e=>{for(var t=[],n=[e];n.length;){var r=n.pop();t.push(r),n.push.apply(n,r.mounts)}return t},syncfs:(e,t)=>{"function"==typeof e&&(t=e,e=!1),Te.syncFSRequests++,Te.syncFSRequests>1&&R("warning: "+Te.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var n=Te.getMounts(Te.root.mount),r=0;function i(e){return Te.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,i(e));++r>=n.length&&i(null)}n.forEach((t=>{if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:(e,t,n)=>{var r,i="/"===n,o=!n;if(i&&Te.root)throw new Te.ErrnoError(10);if(!i&&!o){var a=Te.lookupPath(n,{follow_mount:!1});if(n=a.path,r=a.node,Te.isMountpoint(r))throw new Te.ErrnoError(10);if(!Te.isDir(r.mode))throw new Te.ErrnoError(54)}var s={type:e,opts:t,mountpoint:n,mounts:[]},l=e.mount(s);return l.mount=s,s.root=l,i?Te.root=l:r&&(r.mounted=s,r.mount&&r.mount.mounts.push(s)),l},unmount:e=>{var t=Te.lookupPath(e,{follow_mount:!1});if(!Te.isMountpoint(t.node))throw new Te.ErrnoError(28);var n=t.node,r=n.mounted,i=Te.getMounts(r);Object.keys(Te.nameTable).forEach((e=>{for(var t=Te.nameTable[e];t;){var n=t.name_next;i.includes(t.mount)&&Te.destroyNode(t),t=n}})),n.mounted=null;var o=n.mount.mounts.indexOf(r);n.mount.mounts.splice(o,1)},lookup:(e,t)=>e.node_ops.lookup(e,t),mknod:(e,t,n)=>{var r=Te.lookupPath(e,{parent:!0}).node,i=Se.basename(e);if(!i||"."===i||".."===i)throw new Te.ErrnoError(28);var o=Te.mayCreate(r,i);if(o)throw new Te.ErrnoError(o);if(!r.node_ops.mknod)throw new Te.ErrnoError(63);return r.node_ops.mknod(r,i,t,n)},create:(e,t)=>(t=void 0!==t?t:438,t&=4095,t|=32768,Te.mknod(e,t,0)),mkdir:(e,t)=>(t=void 0!==t?t:511,t&=1023,t|=16384,Te.mknod(e,t,0)),mkdirTree:(e,t)=>{for(var n=e.split("/"),r="",i=0;i<n.length;++i)if(n[i]){r+="/"+n[i];try{Te.mkdir(r,t)}catch(Wr){if(20!=Wr.errno)throw Wr}}},mkdev:(e,t,n)=>("undefined"==typeof n&&(n=t,t=438),t|=8192,Te.mknod(e,t,n)),symlink:(e,t)=>{if(!Ze.resolve(e))throw new Te.ErrnoError(44);var n=Te.lookupPath(t,{parent:!0}).node;if(!n)throw new Te.ErrnoError(44);var r=Se.basename(t),i=Te.mayCreate(n,r);if(i)throw new Te.ErrnoError(i);if(!n.node_ops.symlink)throw new Te.ErrnoError(63);return n.node_ops.symlink(n,r,e)},rename:(e,t)=>{var n,r,i=Se.dirname(e),o=Se.dirname(t),a=Se.basename(e),s=Se.basename(t);if(n=Te.lookupPath(e,{parent:!0}).node,r=Te.lookupPath(t,{parent:!0}).node,!n||!r)throw new Te.ErrnoError(44);if(n.mount!==r.mount)throw new Te.ErrnoError(75);var l,c=Te.lookupNode(n,a),u=Ze.relative(e,o);if("."!==u.charAt(0))throw new Te.ErrnoError(28);if("."!==(u=Ze.relative(t,i)).charAt(0))throw new Te.ErrnoError(55);try{l=Te.lookupNode(r,s)}catch(Wr){}if(c!==l){var d=Te.isDir(c.mode),g=Te.mayDelete(n,a,d);if(g)throw new Te.ErrnoError(g);if(g=l?Te.mayDelete(r,s,d):Te.mayCreate(r,s))throw new Te.ErrnoError(g);if(!n.node_ops.rename)throw new Te.ErrnoError(63);if(Te.isMountpoint(c)||l&&Te.isMountpoint(l))throw new Te.ErrnoError(10);if(r!==n&&(g=Te.nodePermissions(n,"w")))throw new Te.ErrnoError(g);Te.hashRemoveNode(c);try{n.node_ops.rename(c,r,s)}catch(Wr){throw Wr}finally{Te.hashAddNode(c)}}},rmdir:e=>{var t=Te.lookupPath(e,{parent:!0}).node,n=Se.basename(e),r=Te.lookupNode(t,n),i=Te.mayDelete(t,n,!0);if(i)throw new Te.ErrnoError(i);if(!t.node_ops.rmdir)throw new Te.ErrnoError(63);if(Te.isMountpoint(r))throw new Te.ErrnoError(10);t.node_ops.rmdir(t,n),Te.destroyNode(r)},readdir:e=>{var t=Te.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new Te.ErrnoError(54);return t.node_ops.readdir(t)},unlink:e=>{var t=Te.lookupPath(e,{parent:!0}).node;if(!t)throw new Te.ErrnoError(44);var n=Se.basename(e),r=Te.lookupNode(t,n),i=Te.mayDelete(t,n,!1);if(i)throw new Te.ErrnoError(i);if(!t.node_ops.unlink)throw new Te.ErrnoError(63);if(Te.isMountpoint(r))throw new Te.ErrnoError(10);t.node_ops.unlink(t,n),Te.destroyNode(r)},readlink:e=>{var t=Te.lookupPath(e).node;if(!t)throw new Te.ErrnoError(44);if(!t.node_ops.readlink)throw new Te.ErrnoError(28);return Ze.resolve(Te.getPath(t.parent),t.node_ops.readlink(t))},stat:(e,t)=>{var n=Te.lookupPath(e,{follow:!t}).node;if(!n)throw new Te.ErrnoError(44);if(!n.node_ops.getattr)throw new Te.ErrnoError(63);return n.node_ops.getattr(n)},lstat:e=>Te.stat(e,!0),chmod:(e,t,n)=>{var r;"string"==typeof e?r=Te.lookupPath(e,{follow:!n}).node:r=e;if(!r.node_ops.setattr)throw new Te.ErrnoError(63);r.node_ops.setattr(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})},lchmod:(e,t)=>{Te.chmod(e,t,!0)},fchmod:(e,t)=>{var n=Te.getStream(e);if(!n)throw new Te.ErrnoError(8);Te.chmod(n.node,t)},chown:(e,t,n,r)=>{var i;"string"==typeof e?i=Te.lookupPath(e,{follow:!r}).node:i=e;if(!i.node_ops.setattr)throw new Te.ErrnoError(63);i.node_ops.setattr(i,{timestamp:Date.now()})},lchown:(e,t,n)=>{Te.chown(e,t,n,!0)},fchown:(e,t,n)=>{var r=Te.getStream(e);if(!r)throw new Te.ErrnoError(8);Te.chown(r.node,t,n)},truncate:(e,t)=>{if(t<0)throw new Te.ErrnoError(28);var n;"string"==typeof e?n=Te.lookupPath(e,{follow:!0}).node:n=e;if(!n.node_ops.setattr)throw new Te.ErrnoError(63);if(Te.isDir(n.mode))throw new Te.ErrnoError(31);if(!Te.isFile(n.mode))throw new Te.ErrnoError(28);var r=Te.nodePermissions(n,"w");if(r)throw new Te.ErrnoError(r);n.node_ops.setattr(n,{size:t,timestamp:Date.now()})},ftruncate:(e,t)=>{var n=Te.getStream(e);if(!n)throw new Te.ErrnoError(8);if(0===(2097155&n.flags))throw new Te.ErrnoError(28);Te.truncate(n.node,t)},utime:(e,t,n)=>{var r=Te.lookupPath(e,{follow:!0}).node;r.node_ops.setattr(r,{timestamp:Math.max(t,n)})},open:(e,t,n)=>{if(""===e)throw new Te.ErrnoError(44);var r;if(n="undefined"==typeof n?438:n,n=64&(t="string"==typeof t?Te.modeStringToFlags(t):t)?4095&n|32768:0,"object"==typeof e)r=e;else{e=Se.normalize(e);try{r=Te.lookupPath(e,{follow:!(131072&t)}).node}catch(Wr){}}var i=!1;if(64&t)if(r){if(128&t)throw new Te.ErrnoError(20)}else r=Te.mknod(e,n,0),i=!0;if(!r)throw new Te.ErrnoError(44);if(Te.isChrdev(r.mode)&&(t&=-513),65536&t&&!Te.isDir(r.mode))throw new Te.ErrnoError(54);if(!i){var o=Te.mayOpen(r,t);if(o)throw new Te.ErrnoError(o)}512&t&&!i&&Te.truncate(r,0),t&=-131713;var a=Te.createStream({node:r,path:Te.getPath(r),flags:t,seekable:!0,position:0,stream_ops:r.stream_ops,ungotten:[],error:!1});return a.stream_ops.open&&a.stream_ops.open(a),!m.logReadFiles||1&t||(Te.readFiles||(Te.readFiles={}),e in Te.readFiles||(Te.readFiles[e]=1)),a},close:e=>{if(Te.isClosed(e))throw new Te.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(Wr){throw Wr}finally{Te.closeStream(e.fd)}e.fd=null},isClosed:e=>null===e.fd,llseek:(e,t,n)=>{if(Te.isClosed(e))throw new Te.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new Te.ErrnoError(70);if(0!=n&&1!=n&&2!=n)throw new Te.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,n),e.ungotten=[],e.position},read:(e,t,n,r,i)=>{if(r<0||i<0)throw new Te.ErrnoError(28);if(Te.isClosed(e))throw new Te.ErrnoError(8);if(1===(2097155&e.flags))throw new Te.ErrnoError(8);if(Te.isDir(e.node.mode))throw new Te.ErrnoError(31);if(!e.stream_ops.read)throw new Te.ErrnoError(28);var o="undefined"!=typeof i;if(o){if(!e.seekable)throw new Te.ErrnoError(70)}else i=e.position;var a=e.stream_ops.read(e,t,n,r,i);return o||(e.position+=a),a},write:(e,t,n,r,i,o)=>{if(r<0||i<0)throw new Te.ErrnoError(28);if(Te.isClosed(e))throw new Te.ErrnoError(8);if(0===(2097155&e.flags))throw new Te.ErrnoError(8);if(Te.isDir(e.node.mode))throw new Te.ErrnoError(31);if(!e.stream_ops.write)throw new Te.ErrnoError(28);e.seekable&&1024&e.flags&&Te.llseek(e,0,2);var a="undefined"!=typeof i;if(a){if(!e.seekable)throw new Te.ErrnoError(70)}else i=e.position;var s=e.stream_ops.write(e,t,n,r,i,o);return a||(e.position+=s),s},allocate:(e,t,n)=>{if(Te.isClosed(e))throw new Te.ErrnoError(8);if(t<0||n<=0)throw new Te.ErrnoError(28);if(0===(2097155&e.flags))throw new Te.ErrnoError(8);if(!Te.isFile(e.node.mode)&&!Te.isDir(e.node.mode))throw new Te.ErrnoError(43);if(!e.stream_ops.allocate)throw new Te.ErrnoError(138);e.stream_ops.allocate(e,t,n)},mmap:(e,t,n,r,i)=>{if(0!==(2&r)&&0===(2&i)&&2!==(2097155&e.flags))throw new Te.ErrnoError(2);if(1===(2097155&e.flags))throw new Te.ErrnoError(2);if(!e.stream_ops.mmap)throw new Te.ErrnoError(43);return e.stream_ops.mmap(e,t,n,r,i)},msync:(e,t,n,r,i)=>e.stream_ops.msync?e.stream_ops.msync(e,t,n,r,i):0,munmap:e=>0,ioctl:(e,t,n)=>{if(!e.stream_ops.ioctl)throw new Te.ErrnoError(59);return e.stream_ops.ioctl(e,t,n)},readFile:(e,t={})=>{if(t.flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var n,r=Te.open(e,t.flags),i=Te.stat(e).size,o=new Uint8Array(i);return Te.read(r,o,0,i,0),"utf8"===t.encoding?n=z(o,0):"binary"===t.encoding&&(n=o),Te.close(r),n},writeFile:(e,t,n={})=>{n.flags=n.flags||577;var r=Te.open(e,n.flags,n.mode);if("string"==typeof t){var i=new Uint8Array(ee(t)+1),o=$(t,i,0,i.length);Te.write(r,i,0,o,void 0,n.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");Te.write(r,t,0,t.byteLength,void 0,n.canOwn)}Te.close(r)},cwd:()=>Te.currentPath,chdir:e=>{var t=Te.lookupPath(e,{follow:!0});if(null===t.node)throw new Te.ErrnoError(44);if(!Te.isDir(t.node.mode))throw new Te.ErrnoError(54);var n=Te.nodePermissions(t.node,"x");if(n)throw new Te.ErrnoError(n);Te.currentPath=t.path},createDefaultDirectories:()=>{Te.mkdir("/tmp"),Te.mkdir("/home"),Te.mkdir("/home/web_user")},createDefaultDevices:()=>{Te.mkdir("/dev"),Te.registerDevice(Te.makedev(1,3),{read:()=>0,write:(e,t,n,r,i)=>r}),Te.mkdev("/dev/null",Te.makedev(1,3)),Ee.register(Te.makedev(5,0),Ee.default_tty_ops),Ee.register(Te.makedev(6,0),Ee.default_tty1_ops),Te.mkdev("/dev/tty",Te.makedev(5,0)),Te.mkdev("/dev/tty1",Te.makedev(6,0));var e=ke();Te.createDevice("/dev","random",e),Te.createDevice("/dev","urandom",e),Te.mkdir("/dev/shm"),Te.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{Te.mkdir("/proc");var e=Te.mkdir("/proc/self");Te.mkdir("/proc/self/fd"),Te.mount({mount:()=>{var t=Te.createNode(e,"fd",16895,73);return t.node_ops={lookup:(e,t)=>{var n=+t,r=Te.getStream(n);if(!r)throw new Te.ErrnoError(8);var i={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>r.path}};return i.parent=i,i}},t}},{},"/proc/self/fd")},createStandardStreams:()=>{m.stdin?Te.createDevice("/dev","stdin",m.stdin):Te.symlink("/dev/tty","/dev/stdin"),m.stdout?Te.createDevice("/dev","stdout",null,m.stdout):Te.symlink("/dev/tty","/dev/stdout"),m.stderr?Te.createDevice("/dev","stderr",null,m.stderr):Te.symlink("/dev/tty1","/dev/stderr"),Te.open("/dev/stdin",0),Te.open("/dev/stdout",1),Te.open("/dev/stderr",1)},ensureErrnoError:()=>{Te.ErrnoError||(Te.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},Te.ErrnoError.prototype=new Error,Te.ErrnoError.prototype.constructor=Te.ErrnoError,[44].forEach((e=>{Te.genericErrors[e]=new Te.ErrnoError(e),Te.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:()=>{Te.ensureErrnoError(),Te.nameTable=new Array(4096),Te.mount(We,{},"/"),Te.createDefaultDirectories(),Te.createDefaultDevices(),Te.createSpecialDirectories(),Te.filesystems={MEMFS:We}},init:(e,t,n)=>{Te.init.initialized=!0,Te.ensureErrnoError(),m.stdin=e||m.stdin,m.stdout=t||m.stdout,m.stderr=n||m.stderr,Te.createStandardStreams()},quit:()=>{Te.init.initialized=!1;for(var e=0;e<Te.streams.length;e++){var t=Te.streams[e];t&&Te.close(t)}},getMode:(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},findObject:(e,t)=>{var n=Te.analyzePath(e,t);return n.exists?n.object:null},analyzePath:(e,t)=>{try{e=(r=Te.lookupPath(e,{follow:!t})).path}catch(Wr){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=Te.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=Se.basename(e),r=Te.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot="/"===r.path}catch(Wr){n.error=Wr.errno}return n},createPath:(e,t,n,r)=>{e="string"==typeof e?e:Te.getPath(e);for(var i=t.split("/").reverse();i.length;){var o=i.pop();if(o){var a=Se.join2(e,o);try{Te.mkdir(a)}catch(Wr){}e=a}}return a},createFile:(e,t,n,r,i)=>{var o=Se.join2("string"==typeof e?e:Te.getPath(e),t),a=Te.getMode(r,i);return Te.create(o,a)},createDataFile:(e,t,n,r,i,o)=>{var a=t;e&&(e="string"==typeof e?e:Te.getPath(e),a=t?Se.join2(e,t):e);var s=Te.getMode(r,i),l=Te.create(a,s);if(n){if("string"==typeof n){for(var c=new Array(n.length),u=0,d=n.length;u<d;++u)c[u]=n.charCodeAt(u);n=c}Te.chmod(l,146|s);var g=Te.open(l,577);Te.write(g,n,0,n.length,0,o),Te.close(g),Te.chmod(l,s)}return l},createDevice:(e,t,n,r)=>{var i=Se.join2("string"==typeof e?e:Te.getPath(e),t),o=Te.getMode(!!n,!!r);Te.createDevice.major||(Te.createDevice.major=64);var a=Te.makedev(Te.createDevice.major++,0);return Te.registerDevice(a,{open:e=>{e.seekable=!1},close:e=>{r&&r.buffer&&r.buffer.length&&r(10)},read:(e,t,r,i,o)=>{for(var a=0,s=0;s<i;s++){var l;try{l=n()}catch(Wr){throw new Te.ErrnoError(29)}if(void 0===l&&0===a)throw new Te.ErrnoError(6);if(null===l||void 0===l)break;a++,t[r+s]=l}return a&&(e.node.timestamp=Date.now()),a},write:(e,t,n,i,o)=>{for(var a=0;a<i;a++)try{r(t[n+a])}catch(Wr){throw new Te.ErrnoError(29)}return i&&(e.node.timestamp=Date.now()),a}}),Te.mkdev(i,o,a)},forceLoadFile:e=>{if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!f)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=_e(f(e.url),!0),e.usedBytes=e.contents.length}catch(Wr){throw new Te.ErrnoError(29)}},createLazyFile:(e,t,n,r,i)=>{function a(){this.lengthKnown=!1,this.chunks=[]}if(a.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,n=e/this.chunkSize|0;return this.getter(n)[t]}},a.prototype.setDataGetter=function(e){this.getter=e},a.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",n,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+n+". Status: "+e.status);var t,r=Number(e.getResponseHeader("Content-length")),i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;i||(a=r);var s=this;s.setDataGetter((e=>{var t=e*a,i=(e+1)*a-1;if(i=Math.min(i,r-1),"undefined"==typeof s.chunks[e]&&(s.chunks[e]=((e,t)=>{if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>r-1)throw new Error("only "+r+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",n,!1),r!==a&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+n+". Status: "+i.status);return void 0!==i.response?new Uint8Array(i.response||[]):_e(i.responseText||"",!0)})(t,i)),"undefined"==typeof s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!o&&r||(a=r=1,r=this.getter(0).length,a=r,T("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=r,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!b)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var s=new a;Object.defineProperties(s,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var l={isDevice:!1,contents:s}}else l={isDevice:!1,url:n};var c=Te.createFile(e,t,l,r,i);l.contents?c.contents=l.contents:l.url&&(c.contents=null,c.url=l.url),Object.defineProperties(c,{usedBytes:{get:function(){return this.contents.length}}});var u={};function d(e,t,n,r,i){var o=e.node.contents;if(i>=o.length)return 0;var a=Math.min(o.length-i,r);if(o.slice)for(var s=0;s<a;s++)t[n+s]=o[i+s];else for(s=0;s<a;s++)t[n+s]=o.get(i+s);return a}return Object.keys(c.stream_ops).forEach((e=>{var t=c.stream_ops[e];u[e]=function(){return Te.forceLoadFile(c),t.apply(null,arguments)}})),u.read=(e,t,n,r,i)=>(Te.forceLoadFile(c),d(e,t,n,r,i)),u.mmap=(e,t,n,r,i)=>{Te.forceLoadFile(c);var a=Ve(t);if(!a)throw new Te.ErrnoError(48);return d(e,o(),a,t,n),{ptr:a,allocated:!0}},c.stream_ops=u,c},createPreloadedFile:(e,t,n,r,i,o,a,s,l,c)=>{var u=t?Ze.resolve(Se.join2(e,t)):e;function d(n){function d(n){c&&c(),s||Te.createDataFile(e,t,n,r,i,l),o&&o(),ge()}Me.handledByPreloadPlugin(n,u,d,(()=>{a&&a(),ge()}))||d(n)}de(),"string"==typeof n?function(e,t,n,r){var i=r?"":"al "+e;p(e,(n=>{M(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),i&&ge()}),(t=>{if(!n)throw'Loading data file "'+e+'" failed.';n()})),i&&de()}(n,(e=>d(e)),a):d(n)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(e,t,n)=>{t=t||(()=>{}),n=n||(()=>{});var r=Te.indexedDB();try{var i=r.open(Te.DB_NAME(),Te.DB_VERSION)}catch(Wr){return n(Wr)}i.onupgradeneeded=()=>{T("creating db"),i.result.createObjectStore(Te.DB_STORE_NAME)},i.onsuccess=()=>{var r=i.result.transaction([Te.DB_STORE_NAME],"readwrite"),o=r.objectStore(Te.DB_STORE_NAME),a=0,s=0,l=e.length;function c(){0==s?t():n()}e.forEach((e=>{var t=o.put(Te.analyzePath(e).object.contents,e);t.onsuccess=()=>{++a+s==l&&c()},t.onerror=()=>{s++,a+s==l&&c()}})),r.onerror=n},i.onerror=n},loadFilesFromDB:(e,t,n)=>{t=t||(()=>{}),n=n||(()=>{});var r=Te.indexedDB();try{var i=r.open(Te.DB_NAME(),Te.DB_VERSION)}catch(Wr){return n(Wr)}i.onupgradeneeded=n,i.onsuccess=()=>{var r=i.result;try{var o=r.transaction([Te.DB_STORE_NAME],"readonly")}catch(Wr){return void n(Wr)}var a=o.objectStore(Te.DB_STORE_NAME),s=0,l=0,c=e.length;function u(){0==l?t():n()}e.forEach((e=>{var t=a.get(e);t.onsuccess=()=>{Te.analyzePath(e).exists&&Te.unlink(e),Te.createDataFile(Se.dirname(e),Se.basename(e),t.result,!0,!0,!0),++s+l==c&&u()},t.onerror=()=>{l++,s+l==c&&u()}})),o.onerror=n},i.onerror=n}},Re={DEFAULT_POLLMASK:5,calculateAt:function(e,t,n){if(Se.isAbs(t))return t;var r;-100===e?r=Te.cwd():r=Re.getStreamFromFD(e).path;if(0==t.length){if(!n)throw new Te.ErrnoError(44);return r}return Se.join2(r,t)},doStat:function(e,t,n){try{var r=e(t)}catch(Wr){if(Wr&&Wr.node&&Se.normalize(t)!==Se.normalize(Te.getPath(Wr.node)))return-54;throw Wr}return c()[n>>2]=r.dev,c()[n+8>>2]=r.ino,c()[n+12>>2]=r.mode,u()[n+16>>2]=r.nlink,c()[n+20>>2]=r.uid,c()[n+24>>2]=r.gid,c()[n+28>>2]=r.rdev,pe=[r.size>>>0,(fe=r.size,+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[n+40>>2]=pe[0],c()[n+44>>2]=pe[1],c()[n+48>>2]=4096,c()[n+52>>2]=r.blocks,pe=[Math.floor(r.atime.getTime()/1e3)>>>0,(fe=Math.floor(r.atime.getTime()/1e3),+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[n+56>>2]=pe[0],c()[n+60>>2]=pe[1],u()[n+64>>2]=0,pe=[Math.floor(r.mtime.getTime()/1e3)>>>0,(fe=Math.floor(r.mtime.getTime()/1e3),+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[n+72>>2]=pe[0],c()[n+76>>2]=pe[1],u()[n+80>>2]=0,pe=[Math.floor(r.ctime.getTime()/1e3)>>>0,(fe=Math.floor(r.ctime.getTime()/1e3),+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[n+88>>2]=pe[0],c()[n+92>>2]=pe[1],u()[n+96>>2]=0,pe=[r.ino>>>0,(fe=r.ino,+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[n+104>>2]=pe[0],c()[n+108>>2]=pe[1],0},doMsync:function(e,t,n,r,i){if(!Te.isFile(t.node.mode))throw new Te.ErrnoError(43);if(2&r)return 0;var o=a().slice(e,e+n);Te.msync(t,o,i,n,r)},varargs:void 0,get:function(){return Re.varargs+=4,c()[Re.varargs-4>>2]},getStr:function(e){return Q(e)},getStreamFromFD:function(e){var t=Te.getStream(e);if(!t)throw new Te.ErrnoError(8);return t}};function Ge(e){if(S)return Un(1,1,e);D=e,se()||(Pe.terminateAllThreads(),m.onExit&&m.onExit(e),B=!0),I(e,new Ae(e))}var Fe=function(e,t){if(D=e,!t&&S)throw je(e),"unwind";Ge(e)};function Oe(e){if(e instanceof Ae||"unwind"==e)return D;I(1,e)}function Le(e){if(!B)try{e()}catch(Wr){Oe(Wr)}}function De(e,t){return setTimeout((function(){Le(e)}),t)}function Be(e){Be.shown||(Be.shown={}),Be.shown[e]||(Be.shown[e]=1,A&&(e="warning: "+e),R(e))}var Me={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Me.mainLoop.scheduler=null,Me.mainLoop.currentlyRunningMainloop++},resume:function(){Me.mainLoop.currentlyRunningMainloop++;var e=Me.mainLoop.timingMode,t=Me.mainLoop.timingValue,n=Me.mainLoop.func;Me.mainLoop.func=null,function(e,t,n,r,i){M(!Me.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Me.mainLoop.func=e,Me.mainLoop.arg=r;var o=Me.mainLoop.currentlyRunningMainloop;function a(){return!(o<Me.mainLoop.currentlyRunningMainloop)}if(Me.mainLoop.running=!1,Me.mainLoop.runner=function(){if(!B)if(Me.mainLoop.queue.length>0){var t=Date.now(),n=Me.mainLoop.queue.shift();if(n.func(n.arg),Me.mainLoop.remainingBlockers){var r=Me.mainLoop.remainingBlockers,i=r%1==0?r-1:Math.floor(r);n.counted?Me.mainLoop.remainingBlockers=i:(i+=.5,Me.mainLoop.remainingBlockers=(8*r+i)/9)}if(T('main loop blocker "'+n.name+'" took '+(Date.now()-t)+" ms"),Me.mainLoop.updateStatus(),!a())return;setTimeout(Me.mainLoop.runner,0)}else a()&&(Me.mainLoop.currentFrameNumber=Me.mainLoop.currentFrameNumber+1|0,1==Me.mainLoop.timingMode&&Me.mainLoop.timingValue>1&&Me.mainLoop.currentFrameNumber%Me.mainLoop.timingValue!=0?Me.mainLoop.scheduler():(0==Me.mainLoop.timingMode&&(Me.mainLoop.tickStartTime=Ie()),Me.mainLoop.runIter(e),a()&&("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),Me.mainLoop.scheduler())))},i||(t&&t>0?be(0,1e3/t):be(1,1),Me.mainLoop.scheduler()),n)throw"unwind"}(n,0,!1,Me.mainLoop.arg,!0),be(e,t),Me.mainLoop.scheduler()},updateStatus:function(){if(m.setStatus){var e=m.statusMessage||"Please wait...",t=Me.mainLoop.remainingBlockers,n=Me.mainLoop.expectedBlockers;t?t<n?m.setStatus(e+" ("+(n-t)+"/"+n+")"):m.setStatus(e):m.setStatus("")}},runIter:function(e){if(!B){if(m.preMainLoop)if(!1===m.preMainLoop())return;Le(e),m.postMainLoop&&m.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(m.preloadPlugins||(m.preloadPlugins=[]),!Me.initted){Me.initted=!0;try{new Blob,Me.hasBlobConstructor=!0}catch(Wr){Me.hasBlobConstructor=!1,R("warning: no blob constructor, cannot create blobs with mimetypes")}Me.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Me.hasBlobConstructor?null:R("warning: no BlobBuilder"),Me.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,m.noImageDecoding||"undefined"!=typeof Me.URLObject||(R("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),m.noImageDecoding=!0);var e={canHandle:function(e){return!m.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,r){var i=null;if(Me.hasBlobConstructor)try{(i=new Blob([e],{type:Me.getMimetype(t)})).size!==e.length&&(i=new Blob([new Uint8Array(e).buffer],{type:Me.getMimetype(t)}))}catch(Wr){Be("Blob constructor present but fails: "+Wr+"; falling back to blob builder")}if(!i){var o=new Me.BlobBuilder;o.append(new Uint8Array(e).buffer),i=o.getBlob()}var a=Me.URLObject.createObjectURL(i),s=new Image;s.onload=()=>{M(s.complete,"Image "+t+" could not be decoded");var r=document.createElement("canvas");r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),Me.URLObject.revokeObjectURL(a),n&&n(e)},s.onerror=e=>{T("Image "+a+" could not be decoded"),r&&r()},s.src=a}};m.preloadPlugins.push(e);var t={canHandle:function(e){return!m.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,r){var i=!1;function o(t){i||(i=!0,n&&n(e))}function a(){i||(i=!0,new Audio,r&&r())}if(!Me.hasBlobConstructor)return a();try{var s=new Blob([e],{type:Me.getMimetype(t)})}catch(Wr){return a()}var l=Me.URLObject.createObjectURL(s),c=new Audio;c.addEventListener("canplaythrough",(()=>o()),!1),c.onerror=function(n){i||(R("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),c.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=0,i=0,o=0;o<e.length;o++)for(r=r<<8|e[o],i+=8;i>=6;){var a=r>>i-6&63;i-=6,n+=t[a]}return 2==i?(n+=t[(3&r)<<4],n+="=="):4==i&&(n+=t[(15&r)<<2],n+="="),n}(e),o())},c.src=l,De((function(){o()}),1e4)}};m.preloadPlugins.push(t);var n=m.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("webkitpointerlockchange",r,!1),document.addEventListener("mspointerlockchange",r,!1),m.elementPointerLock&&n.addEventListener("click",(e=>{!Me.pointerLock&&m.canvas.requestPointerLock&&(m.canvas.requestPointerLock(),e.preventDefault())}),!1))}function r(){Me.pointerLock=document.pointerLockElement===m.canvas||document.mozPointerLockElement===m.canvas||document.webkitPointerLockElement===m.canvas||document.msPointerLockElement===m.canvas}},handledByPreloadPlugin:function(e,t,n,r){Me.init();var i=!1;return m.preloadPlugins.forEach((function(o){i||o.canHandle(t)&&(o.handle(e,t,n,r),i=!0)})),i},createContext:function(e,t,n,r){if(t&&m.ctx&&e==m.canvas)return m.ctx;var i,o;if(t){var a={antialias:!1,alpha:!1,majorVersion:1};if(r)for(var s in r)a[s]=r[s];"undefined"!=typeof GL&&(o=GL.createContext(e,a))&&(i=GL.getContext(o).GLctx)}else i=e.getContext("2d");return i?(n&&(t||M("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),m.ctx=i,t&&GL.makeContextCurrent(o),m.useWebGL=t,Me.moduleContextCreatedCallbacks.forEach((function(e){e()})),Me.init()),i):null},destroyContext:function(e,t,n){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(e,t){Me.lockPointer=e,Me.resizeCanvas=t,"undefined"==typeof Me.lockPointer&&(Me.lockPointer=!0),"undefined"==typeof Me.resizeCanvas&&(Me.resizeCanvas=!1);var n=m.canvas;function r(){Me.isFullscreen=!1;var e=n.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(n.exitFullscreen=Me.exitFullscreen,Me.lockPointer&&n.requestPointerLock(),Me.isFullscreen=!0,Me.resizeCanvas?Me.setFullscreenCanvasSize():Me.updateCanvasDimensions(n)):(e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),Me.resizeCanvas?Me.setWindowedCanvasSize():Me.updateCanvasDimensions(n)),m.onFullScreen&&m.onFullScreen(Me.isFullscreen),m.onFullscreen&&m.onFullscreen(Me.isFullscreen)}Me.fullscreenHandlersInstalled||(Me.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1),document.addEventListener("MSFullscreenChange",r,!1));var i=document.createElement("div");n.parentNode.insertBefore(i,n),i.appendChild(n),i.requestFullscreen=i.requestFullscreen||i.mozRequestFullScreen||i.msRequestFullscreen||(i.webkitRequestFullscreen?()=>i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(i.webkitRequestFullScreen?()=>i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),i.requestFullscreen()},exitFullscreen:function(){return!!Me.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===Me.nextRAF)Me.nextRAF=t+1e3/60;else for(;t+2>=Me.nextRAF;)Me.nextRAF+=1e3/60;var n=Math.max(Me.nextRAF-t,0);setTimeout(e,n)},requestAnimationFrame:function(e){"function"!=typeof requestAnimationFrame?(0,Me.fakeRequestAnimationFrame)(e):requestAnimationFrame(e)},safeSetTimeout:function(e,t){return De(e,t)},safeRequestAnimationFrame:function(e){return Me.requestAnimationFrame((function(){Le(e)}))},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail/3;break;case"mousewheel":t=e.wheelDelta/120;break;case"wheel":switch(t=e.deltaY,e.deltaMode){case 0:t/=100;break;case 1:t/=3;break;case 2:t*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(Me.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?Me.mouseMovementX=Me.mouseMovementY=0:(Me.mouseMovementX=Me.getMovementX(e),Me.mouseMovementY=Me.getMovementY(e)),"undefined"!=typeof SDL?(Me.mouseX=SDL.mouseX+Me.mouseMovementX,Me.mouseY=SDL.mouseY+Me.mouseMovementY):(Me.mouseX+=Me.mouseMovementX,Me.mouseY+=Me.mouseMovementY);else{var t=m.canvas.getBoundingClientRect(),n=m.canvas.width,r=m.canvas.height,i="undefined"!=typeof window.scrollX?window.scrollX:window.pageXOffset,o="undefined"!=typeof window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var a=e.touch;if(void 0===a)return;var s=a.pageX-(i+t.left),l=a.pageY-(o+t.top),c={x:s*=n/t.width,y:l*=r/t.height};if("touchstart"===e.type)Me.lastTouches[a.identifier]=c,Me.touches[a.identifier]=c;else if("touchend"===e.type||"touchmove"===e.type){var u=Me.touches[a.identifier];u||(u=c),Me.lastTouches[a.identifier]=u,Me.touches[a.identifier]=c}return}var d=e.pageX-(i+t.left),g=e.pageY-(o+t.top);d*=n/t.width,g*=r/t.height,Me.mouseMovementX=d-Me.mouseX,Me.mouseMovementY=g-Me.mouseY,Me.mouseX=d,Me.mouseY=g}},resizeListeners:[],updateResizeListeners:function(){var e=m.canvas;Me.resizeListeners.forEach((function(t){t(e.width,e.height)}))},setCanvasSize:function(e,t,n){var r=m.canvas;Me.updateCanvasDimensions(r,e,t),n||Me.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=u()[SDL.screen>>2];e|=8388608,c()[SDL.screen>>2]=e}Me.updateCanvasDimensions(m.canvas),Me.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=u()[SDL.screen>>2];e&=-8388609,c()[SDL.screen>>2]=e}Me.updateCanvasDimensions(m.canvas),Me.updateResizeListeners()},updateCanvasDimensions:function(e,t,n){t&&n?(e.widthNative=t,e.heightNative=n):(t=e.widthNative,n=e.heightNative);var r=t,i=n;if(m.forcedAspectRatio&&m.forcedAspectRatio>0&&(r/i<m.forcedAspectRatio?r=Math.round(i*m.forcedAspectRatio):i=Math.round(r/m.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/r,screen.height/i);r=Math.round(r*o),i=Math.round(i*o)}Me.resizeCanvas?(e.width!=r&&(e.width=r),e.height!=i&&(e.height=i),"undefined"!=typeof e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=n&&(e.height=n),"undefined"!=typeof e.style&&(r!=t||i!=n?(e.style.setProperty("width",r+"px","important"),e.style.setProperty("height",i+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}};function Ne(e){var t=Pe.pthreads[e];M(t),Pe.returnWorkerToPool(t)}function Xe(e){var t=Pe.getNewWorker();if(!t)return 6;Pe.runningWorkers.push(t),Pe.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=()=>{n.time=performance.now(),t.postMessage(n,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread),0}var Pe={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){S?Pe.initWorker():Pe.initMainThread()},initMainThread:function(){},initWorker:function(){L=!1},setExitStatus:function(e){D=e},terminateAllThreads:function(){for(var e of Object.values(Pe.pthreads))Pe.returnWorkerToPool(e);for(var e of Pe.unusedWorkers)e.terminate();Pe.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete Pe.pthreads[t],Pe.unusedWorkers.push(e),Pe.runningWorkers.splice(Pe.runningWorkers.indexOf(e),1),e.pthread_ptr=0,Ar(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){Pe.tlsInitFunctions.forEach((e=>e()))},loadWasmModuleToWorker:function(e,t){e.onmessage=n=>{var r,i=n.data,o=i.cmd;if(e.pthread_ptr&&(Pe.currentProxiedOperationCallerThread=e.pthread_ptr),i.targetThread&&i.targetThread!=pr()){var a=Pe.pthreads[i.targetThread];return a?a.postMessage(i,i.transferList):R('Internal error! Worker sent a message "'+o+'" to target pthread '+i.targetThread+", but that thread no longer exists!"),void(Pe.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===o?Wn(i.queue):"spawnThread"===o?Xe(i):"cleanupThread"===o?Ne(i.thread):"killThread"===o?function(e){var t=Pe.pthreads[e];delete Pe.pthreads[e],t.terminate(),Ar(e),Pe.runningWorkers.splice(Pe.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(i.thread):"cancelThread"===o?(r=i.thread,Pe.pthreads[r].postMessage({cmd:"cancel"})):"loaded"===o?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===o?T("Thread "+i.threadId+": "+i.text):"printErr"===o?R("Thread "+i.threadId+": "+i.text):"alert"===o?alert("Thread "+i.threadId+": "+i.text):"setimmediate"===i.target?e.postMessage(i):"callHandler"===o?m[i.handler](...i.args):o&&R("worker sent an unknown command "+o),Pe.currentProxiedOperationCallerThread=void 0},e.onerror=e=>{throw R("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},A&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("detachedExit",(function(){})));var n=[];for(var r of["onExit","onAbort","print","printErr"])m.hasOwnProperty(r)&&n.push(r);e.postMessage({cmd:"load",handlers:n,urlOrBlob:m.mainScriptUrlOrBlob,wasmMemory:F,wasmModule:O})},allocateUnusedWorker:function(){if(m.locateFile){var e=Z("lyra.worker.js");Pe.unusedWorkers.push(new Worker(e))}else Pe.unusedWorkers.push(new Worker(n.tu(new URL(n.p+n.u(101),n.b))))},getNewWorker:function(){return 0==Pe.unusedWorkers.length&&(Pe.allocateUnusedWorker(),Pe.loadWasmModuleToWorker(Pe.unusedWorkers[0])),Pe.unusedWorkers.pop()}};function Ye(e){for(;e.length>0;)e.shift()(m)}function je(e){if(S)return Un(2,0,e);try{Fe(e)}catch(Wr){Oe(Wr)}}m.PThread=Pe,m.establishStackSpace=function(){var e=pr(),t=c()[e+52>>2],n=c()[e+56>>2];kr(t,t-n),_r(t)};var Ue=[];function xe(e){var t=Ue[e];return t||(e>=Ue.length&&(Ue.length=e+1),Ue[e]=t=ne.get(e)),t}function Ke(e){if(!e||!e.callee||!e.callee.name)return[null,"",""];e.callee.toString();var t=e.callee.name,n="(",r=!0;for(var i in e){var o=e[i];r||(n+=", "),r=!1,n+="number"==typeof o||"string"==typeof o?o:"("+typeof o+")"}n+=")";var a=e.callee.caller;return r&&(n=""),[e=a?a.arguments:[],t,n]}function Je(){var e=new Error;if(!e.stack){try{throw new Error}catch(Wr){e=Wr}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function He(e,t,n,r){return S?Un(3,1,e,t,n,r):ze(e,t,n,r)}function ze(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return R("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var i=[];if(S&&0===i.length)return He(e,t,n,r);var o={startRoutine:n,pthread_ptr:e,arg:r,transferList:i};return S?(o.cmd="spawnThread",postMessage(o,i),0):Xe(o)}function Qe(e,t,n){if(S)return Un(4,1,e,t,n);Re.varargs=n;try{var r=Re.getStreamFromFD(e);switch(t){case 0:return(i=Re.get())<0?-28:Te.createStream(r,i).fd;case 1:case 2:case 6:case 7:return 0;case 3:return r.flags;case 4:var i=Re.get();return r.flags|=i,0;case 5:i=Re.get();return s()[i+0>>1]=2,0;case 16:case 8:default:return-28;case 9:return o=28,c()[hr()>>2]=o,-1}}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}var o}function $e(e,t){if(S)return Un(5,1,e,t);try{var n=Re.getStreamFromFD(e);return Re.doStat(Te.stat,n.path,t)}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function qe(e,t,n){if(S)return Un(6,1,e,t,n);try{var r=Re.getStreamFromFD(e);r.getdents||(r.getdents=Te.readdir(r.path));for(var i=280,a=0,l=Te.llseek(r,0,1),u=Math.floor(l/i);u<r.getdents.length&&a+i<=n;){var d,g,h=r.getdents[u];if("."===h)d=r.node.id,g=4;else if(".."===h){d=Te.lookupPath(r.path,{parent:!0}).node.id,g=4}else{var m=Te.lookupNode(r.node,h);d=m.id,g=Te.isChrdev(m.mode)?2:Te.isDir(m.mode)?4:Te.isLink(m.mode)?10:8}pe=[d>>>0,(fe=d,+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[t+a>>2]=pe[0],c()[t+a+4>>2]=pe[1],pe=[(u+1)*i>>>0,(fe=(u+1)*i,+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[t+a+8>>2]=pe[0],c()[t+a+12>>2]=pe[1],s()[t+a+16>>1]=280,o()[t+a+18>>0]=g,q(h,t+a+19,256),a+=i,u+=1}return Te.llseek(r,u*i,0),a}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function et(e,t,n){if(S)return Un(7,1,e,t,n);Re.varargs=n;try{var r=Re.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return r.tty?0:-59;case 21519:if(!r.tty)return-59;var i=Re.get();return c()[i>>2]=0,0;case 21520:return r.tty?-28:-59;case 21531:i=Re.get();return Te.ioctl(r,t,i);default:return-28}}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function tt(e,t){if(S)return Un(8,1,e,t);try{return e=Re.getStr(e),Re.doStat(Te.lstat,e,t)}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function nt(e,t,n,r){if(S)return Un(9,1,e,t,n,r);try{t=Re.getStr(t);var i=256&r,o=4096&r;return r&=-4353,t=Re.calculateAt(e,t,o),Re.doStat(i?Te.lstat:Te.stat,t,n)}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function rt(e,t,n,r){if(S)return Un(10,1,e,t,n,r);Re.varargs=r;try{t=Re.getStr(t),t=Re.calculateAt(e,t);var i=r?Re.get():0;return Te.open(t,n,i).fd}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function it(e,t){if(S)return Un(11,1,e,t);try{return e=Re.getStr(e),Re.doStat(Te.stat,e,t)}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function ot(e,t,n){if(S)return Un(12,1,e,t,n);try{return t=Re.getStr(t),t=Re.calculateAt(e,t),0===n?Te.unlink(t):512===n?Te.rmdir(t):he("Invalid flags passed to unlinkat"),0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}m.invokeEntryPoint=function(e,t){var n=xe(e)(t);se()?Pe.setExitStatus(n):Sr(n)};var at="To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking";function st(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var lt=void 0;function ct(e){for(var t="",n=e;a()[n];)t+=lt[a()[n++]];return t}var ut={},dt={},gt={};function ht(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function mt(e,t){return e=ht(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ft(e,t){var n=mt(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var pt=void 0;function Ct(e){throw new pt(e)}var wt=void 0;function yt(e){throw new wt(e)}function It(e,t,n){function r(t){var r=n(t);r.length!==e.length&&yt("Mismatched type converter count");for(var i=0;i<e.length;++i)vt(e[i],r[i])}e.forEach((function(e){gt[e]=t}));var i=new Array(t.length),o=[],a=0;t.forEach(((e,t)=>{dt.hasOwnProperty(e)?i[t]=dt[e]:(o.push(e),ut.hasOwnProperty(e)||(ut[e]=[]),ut[e].push((()=>{i[t]=dt[e],++a===o.length&&r(i)})))})),0===o.length&&r(i)}function vt(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||Ct('type "'+r+'" must have a positive integer typeid pointer'),dt.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;Ct("Cannot register type '"+r+"' twice")}if(dt[e]=t,delete gt[e],ut.hasOwnProperty(e)){var i=ut[e];delete ut[e],i.forEach((e=>e()))}}function bt(e){if(!(this instanceof jt))return!1;if(!(e instanceof jt))return!1;for(var t=this.$$.ptrType.registeredClass,n=this.$$.ptr,r=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;r.baseClass;)i=r.upcast(i),r=r.baseClass;return t===r&&n===i}function At(e){Ct(e.$$.ptrType.registeredClass.name+" instance already deleted")}var St=!1;function kt(e){}function Zt(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function _t(e,t,n){if(t===n)return e;if(void 0===n.baseClass)return null;var r=_t(e,t,n.baseClass);return null===r?null:n.downcast(r)}var Et={};function Vt(){return Object.keys(Ot).length}function Wt(){var e=[];for(var t in Ot)Ot.hasOwnProperty(t)&&e.push(Ot[t]);return e}var Tt=[];function Rt(){for(;Tt.length;){var e=Tt.pop();e.$$.deleteScheduled=!1,e.delete()}}var Gt=void 0;function Ft(e){Gt=e,Tt.length&&Gt&&Gt(Rt)}var Ot={};function Lt(e,t){return t=function(e,t){for(void 0===t&&Ct("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Ot[t]}function Dt(e,t){return t.ptrType&&t.ptr||yt("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&yt("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Mt(Object.create(e,{$$:{value:t}}))}function Bt(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var n=Lt(this.registeredClass,t);if(void 0!==n){if(0===n.$$.count.value)return n.$$.ptr=t,n.$$.smartPtr=e,n.clone();var r=n.clone();return this.destructor(e),r}function i(){return this.isSmartPointer?Dt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Dt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,a=this.registeredClass.getActualType(t),s=Et[a];if(!s)return i.call(this);o=this.isConst?s.constPointerType:s.pointerType;var l=_t(t,this.registeredClass,o.registeredClass);return null===l?i.call(this):this.isSmartPointer?Dt(o.registeredClass.instancePrototype,{ptrType:o,ptr:l,smartPtrType:this,smartPtr:e}):Dt(o.registeredClass.instancePrototype,{ptrType:o,ptr:l})}function Mt(e){return"undefined"===typeof FinalizationRegistry?(Mt=e=>e,e):(St=new FinalizationRegistry((e=>{Zt(e.$$)})),Mt=e=>{var t=e.$$;if(!!t.smartPtr){var n={$$:t};St.register(e,n,e)}return e},kt=e=>St.unregister(e),Mt(e))}function Nt(){if(this.$$.ptr||At(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=Mt(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function Xt(){this.$$.ptr||At(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ct("Object already scheduled for deletion"),kt(this),Zt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Pt(){return!this.$$.ptr}function Yt(){return this.$$.ptr||At(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ct("Object already scheduled for deletion"),Tt.push(this),1===Tt.length&&Gt&&Gt(Rt),this.$$.deleteScheduled=!0,this}function jt(){}function Ut(e,t,n){if(void 0===e[t].overloadTable){var r=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||Ct("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[r.argCount]=r}}function xt(e,t,n){m.hasOwnProperty(e)?((void 0===n||void 0!==m[e].overloadTable&&void 0!==m[e].overloadTable[n])&&Ct("Cannot register public name '"+e+"' twice"),Ut(m,e,e),m.hasOwnProperty(n)&&Ct("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),m[e].overloadTable[n]=t):(m[e]=t,void 0!==n&&(m[e].numArguments=n))}function Kt(e,t,n,r,i,o,a,s){this.name=e,this.constructor=t,this.instancePrototype=n,this.rawDestructor=r,this.baseClass=i,this.getActualType=o,this.upcast=a,this.downcast=s,this.pureVirtualFunctions=[]}function Jt(e,t,n){for(;t!==n;)t.upcast||Ct("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Ht(e,t){if(null===t)return this.isReference&&Ct("null is not a valid "+this.name),0;t.$$||Ct('Cannot pass "'+In(t)+'" as a '+this.name),t.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name);var n=t.$$.ptrType.registeredClass;return Jt(t.$$.ptr,n,this.registeredClass)}function zt(e,t){var n;if(null===t)return this.isReference&&Ct("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,n),n):0;t.$$||Ct('Cannot pass "'+In(t)+'" as a '+this.name),t.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&Ct("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;if(n=Jt(t.$$.ptr,r,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&Ct("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:Ct("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var i=t.clone();n=this.rawShare(n,yn.toHandle((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,n)}break;default:Ct("Unsupporting sharing policy")}return n}function Qt(e,t){if(null===t)return this.isReference&&Ct("null is not a valid "+this.name),0;t.$$||Ct('Cannot pass "'+In(t)+'" as a '+this.name),t.$$.ptr||Ct("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&Ct("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;return Jt(t.$$.ptr,n,this.registeredClass)}function $t(e){return this.fromWireType(c()[e>>2])}function qt(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function en(e){this.rawDestructor&&this.rawDestructor(e)}function tn(e){null!==e&&e.delete()}function nn(e,t,n,r,i,o,a,s,l,c,u){this.name=e,this.registeredClass=t,this.isReference=n,this.isConst=r,this.isSmartPointer=i,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=s,this.rawConstructor=l,this.rawShare=c,this.rawDestructor=u,i||void 0!==t.baseClass?this.toWireType=zt:r?(this.toWireType=Ht,this.destructorFunction=null):(this.toWireType=Qt,this.destructorFunction=null)}function rn(e,t,n){m.hasOwnProperty(e)||yt("Replacing nonexistant public symbol"),void 0!==m[e].overloadTable&&void 0!==n?m[e].overloadTable[n]=t:(m[e]=t,m[e].argCount=n)}function on(e,t,n){return e.includes("j")?function(e,t,n){var r=m["dynCall_"+e];return n&&n.length?r.apply(null,[t].concat(n)):r.call(null,t)}(e,t,n):xe(t).apply(null,n)}function an(e,t){var n=(e=ct(e)).includes("j")?function(e,t){var n=[];return function(){return n.length=0,Object.assign(n,arguments),on(e,t,n)}}(e,t):xe(t);return"function"!=typeof n&&Ct("unknown function pointer with signature "+e+": "+t),n}var sn=void 0;function ln(e){var t=wr(e),n=ct(t);return fr(t),n}function cn(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||dt[t]||(gt[t]?gt[t].forEach(e):(n.push(t),r[t]=!0))})),new sn(e+": "+n.map(ln).join([", "]))}function un(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var n=mt(e.name||"unknownFunctionName",(function(){}));n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return i instanceof Object?i:r}function dn(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function gn(e,t,n,r,i){var o=t.length;o<2&&Ct("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==n,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var c="void"!==t[0].name,u="",d="";for(l=0;l<o-2;++l)u+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var g="return function "+ht(e)+"("+u+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(g+="var destructors = [];\n");var h=s?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[Ct,r,i,dn,t[0],t[1]];a&&(g+="var thisWired = classParam.toWireType("+h+", this);\n");for(l=0;l<o-2;++l)g+="var arg"+l+"Wired = argType"+l+".toWireType("+h+", arg"+l+"); // "+t[l+2].name+"\n",m.push("argType"+l),f.push(t[l+2]);if(a&&(d="thisWired"+(d.length>0?", ":"")+d),g+=(c?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)g+="runDestructors(destructors);\n";else for(l=a?1:2;l<t.length;++l){var p=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(g+=p+"_dtor("+p+"); // "+t[l].name+"\n",m.push(p+"_dtor"),f.push(t[l].destructorFunction))}return c&&(g+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),g+="}\n",m.push(g),un(Function,m).apply(null,f)}function hn(e,t){for(var n=[],r=0;r<e;r++)n.push(u()[t+4*r>>2]);return n}var mn=[],fn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function pn(e){e>4&&0===--fn[e].refcount&&(fn[e]=void 0,mn.push(e))}function Cn(){for(var e=0,t=5;t<fn.length;++t)void 0!==fn[t]&&++e;return e}function wn(){for(var e=5;e<fn.length;++e)if(void 0!==fn[e])return fn[e];return null}var yn={toValue:e=>(e||Ct("Cannot use deleted val. handle = "+e),fn[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=mn.length?mn.pop():fn.length;return fn[t]={refcount:1,value:e},t}}};function In(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function vn(e,t){switch(t){case 2:return function(e){return this.fromWireType((F.buffer!=N&&te(F.buffer),K)[e>>2])};case 3:return function(e){return this.fromWireType(d()[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function bn(e,t,n){switch(t){case 0:return n?function(e){return o()[e]}:function(e){return a()[e]};case 1:return n?function(e){return s()[e>>1]}:function(e){return l()[e>>1]};case 2:return n?function(e){return c()[e>>2]}:function(e){return u()[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var An="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function Sn(e,t){for(var n=e,r=n>>1,i=r+t/2;!(r>=i)&&l()[r];)++r;if((n=r<<1)-e>32&&An)return An.decode(a().slice(e,n));for(var o="",c=0;!(c>=t/2);++c){var u=s()[e+2*c>>1];if(0==u)break;o+=String.fromCharCode(u)}return o}function kn(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var r=t,i=(n-=2)<2*e.length?n/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);s()[t>>1]=a,t+=2}return s()[t>>1]=0,t-r}function Zn(e){return 2*e.length}function _n(e,t){for(var n=0,r="";!(n>=t/4);){var i=c()[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var o=i-65536;r+=String.fromCharCode(55296|o>>10,56320|1023&o)}else r+=String.fromCharCode(i)}return r}function En(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var r=t,i=r+n-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o);if(c()[t>>2]=a,(t+=4)+4>i)break}return c()[t>>2]=0,t-r}function Vn(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t}function Wn(e){Atomics.store(c(),e>>2,1),pr()&&br(e),Atomics.compareExchange(c(),e>>2,1,0)}m.executeNotifiedProxyingQueue=Wn;var Tn={};var Rn=[];function Gn(e,t){var n=dt[e];return void 0===n&&Ct(t+" has unknown type "+ln(e)),n}var Fn=[];function On(e){return u()[e>>2]+4294967296*c()[e+4>>2]}function Ln(e){return e%4===0&&(e%100!==0||e%400===0)}var Dn=[0,31,60,91,121,152,182,213,244,274,305,335],Bn=[0,31,59,90,120,151,181,212,243,273,304,334];function Mn(e){return(Ln(e.getFullYear())?Dn:Bn)[e.getMonth()]+e.getDate()-1}function Nn(e,t,n,r,i,o,a){if(S)return Un(13,1,e,t,n,r,i,o,a);try{var s=Re.getStreamFromFD(r),l=Te.mmap(s,e,i,t,n),d=l.ptr;return c()[o>>2]=l.allocated,u()[a>>2]=d,0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function Xn(e,t,n,r,i,o){if(S)return Un(14,1,e,t,n,r,i,o);try{var a=Re.getStreamFromFD(i);2&n&&Re.doMsync(e,a,t,r,o),Te.munmap(a)}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return-Wr.errno}}function Pn(e){var t=ee(e)+1,n=mr(t);return n&&$(e,o(),n,t),n}var Yn=[];function jn(e){var t=Zr(),n=e();return _r(t),n}function Un(e,t){var n=arguments.length-2,r=arguments;return jn((()=>{for(var i=n,o=Er(8*i),a=o>>3,s=0;s<n;s++){var l=r[2+s];d()[a+s]=l}return Ir(e,i,o,t)}))}var xn=[];function Kn(e){try{return F.grow(e-N.byteLength+65535>>>16),te(F.buffer),1}catch(Wr){}}function Jn(e){return he("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0}var Hn={};function zn(e){e.forEach((e=>{Jn()}))}var Qn={};function $n(){if(!$n.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"};for(var t in Qn)void 0===Qn[t]?delete e[t]:e[t]=Qn[t];var n=[];for(var t in e)n.push(t+"="+e[t]);$n.strings=n}return $n.strings}function qn(e,t){if(S)return Un(15,1,e,t);var n=0;return $n().forEach((function(r,i){var a=t+n;u()[e+4*i>>2]=a,function(e,t,n){for(var r=0;r<e.length;++r)o()[t++>>0]=e.charCodeAt(r);n||(o()[t>>0]=0)}(r,a),n+=r.length+1})),0}function er(e,t){if(S)return Un(16,1,e,t);var n=$n();u()[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),u()[t>>2]=r,0}function tr(e){if(S)return Un(17,1,e);try{var t=Re.getStreamFromFD(e);return Te.close(t),0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return Wr.errno}}function nr(e,t,n,r){if(S)return Un(18,1,e,t,n,r);try{var i=function(e,t,n,r){for(var i=0,a=0;a<n;a++){var s=u()[t>>2],l=u()[t+4>>2];t+=8;var c=Te.read(e,o(),s,l,r);if(c<0)return-1;if(i+=c,c<l)break}return i}(Re.getStreamFromFD(e),t,n);return u()[r>>2]=i,0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return Wr.errno}}function rr(e,t,n,r,i){if(S)return Un(19,1,e,t,n,r,i);try{var o=(l=n)+2097152>>>0<4194305-!!(s=t)?(s>>>0)+4294967296*l:NaN;if(isNaN(o))return 61;var a=Re.getStreamFromFD(e);return Te.llseek(a,o,r),pe=[a.position>>>0,(fe=a.position,+Math.abs(fe)>=1?fe>0?(0|Math.min(+Math.floor(fe/4294967296),4294967295))>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],c()[i>>2]=pe[0],c()[i+4>>2]=pe[1],a.getdents&&0===o&&0===r&&(a.getdents=null),0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return Wr.errno}var s,l}function ir(e,t,n,r){if(S)return Un(20,1,e,t,n,r);try{var i=function(e,t,n,r){for(var i=0,a=0;a<n;a++){var s=u()[t>>2],l=u()[t+4>>2];t+=8;var c=Te.write(e,o(),s,l,r);if(c<0)return-1;i+=c}return i}(Re.getStreamFromFD(e),t,n);return u()[r>>2]=i,0}catch(Wr){if("undefined"==typeof Te||!(Wr instanceof Te.ErrnoError))throw Wr;return Wr.errno}}var or=[31,29,31,30,31,30,31,31,30,31,30,31],ar=[31,28,31,30,31,30,31,31,30,31,30,31];function sr(e,t,n,r){var i=c()[r+40>>2],a={tm_sec:c()[r>>2],tm_min:c()[r+4>>2],tm_hour:c()[r+8>>2],tm_mday:c()[r+12>>2],tm_mon:c()[r+16>>2],tm_year:c()[r+20>>2],tm_wday:c()[r+24>>2],tm_yday:c()[r+28>>2],tm_isdst:c()[r+32>>2],tm_gmtoff:c()[r+36>>2],tm_zone:i?Q(i):""},s=Q(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in l)s=s.replace(new RegExp(u,"g"),l[u]);var d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(e,t,n){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function m(e,t){return h(e,t,"0")}function f(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function C(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var r=Ln(n.getFullYear()),i=n.getMonth(),o=(r?or:ar)[i];if(!(t>o-n.getDate()))return n.setDate(n.getDate()+t),n;t-=o-n.getDate()+1,n.setDate(1),i<11?n.setMonth(i+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),i=p(n),o=p(r);return f(i,t)<=0?f(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var w={"%a":function(e){return d[e.tm_wday].substring(0,3)},"%A":function(e){return d[e.tm_wday]},"%b":function(e){return g[e.tm_mon].substring(0,3)},"%B":function(e){return g[e.tm_mon]},"%C":function(e){return m((e.tm_year+1900)/100|0,2)},"%d":function(e){return m(e.tm_mday,2)},"%e":function(e){return h(e.tm_mday,2," ")},"%g":function(e){return C(e).toString().substring(2)},"%G":function(e){return C(e)},"%H":function(e){return m(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),m(t,2)},"%j":function(e){return m(e.tm_mday+function(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}(Ln(e.tm_year+1900)?or:ar,e.tm_mon-1),3)},"%m":function(e){return m(e.tm_mon+1,2)},"%M":function(e){return m(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return m(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return m(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&Ln(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&Ln(e.tm_year%400-1))&&t++}return m(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return m(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in s=s.replace(/%%/g,"\0\0"),w)s.includes(u)&&(s=s.replace(new RegExp(u,"g"),w[u](a)));var y=_e(s=s.replace(/\0\0/g,"%"),!1);return y.length>t?0:(function(e,t){o().set(e,t)}(y,e),y.length-1)}m.requestFullscreen=function(e,t){Me.requestFullscreen(e,t)},m.requestAnimationFrame=function(e){Me.requestAnimationFrame(e)},m.setCanvasSize=function(e,t,n){Me.setCanvasSize(e,t,n)},m.pauseMainLoop=function(){Me.mainLoop.pause()},m.resumeMainLoop=function(){Me.mainLoop.resume()},m.getUserMedia=function(){Me.getUserMedia()},m.createContext=function(e,t,n,r){return Me.createContext(e,t,n,r)};var lr=function(e,t,n,r){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=Te.nextInode++,this.name=t,this.mode=n,this.node_ops={},this.stream_ops={},this.rdev=r},cr=365,ur=146;Object.defineProperties(lr.prototype,{read:{get:function(){return(this.mode&cr)===cr},set:function(e){e?this.mode|=cr:this.mode&=-366}},write:{get:function(){return(this.mode&ur)===ur},set:function(e){e?this.mode|=ur:this.mode&=-147}},isFolder:{get:function(){return Te.isDir(this.mode)}},isDevice:{get:function(){return Te.isChrdev(this.mode)}}}),Te.FSNode=lr,Te.staticInit(),m.FS_createPath=Te.createPath,m.FS_createDataFile=Te.createDataFile,m.FS_createPreloadedFile=Te.createPreloadedFile,m.FS_unlink=Te.unlink,m.FS_createLazyFile=Te.createLazyFile,m.FS_createDevice=Te.createDevice,Pe.init(),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);lt=e}(),pt=m.BindingError=ft(Error,"BindingError"),wt=m.InternalError=ft(Error,"InternalError"),jt.prototype.isAliasOf=bt,jt.prototype.clone=Nt,jt.prototype.delete=Xt,jt.prototype.isDeleted=Pt,jt.prototype.deleteLater=Yt,m.getInheritedInstanceCount=Vt,m.getLiveInheritedInstances=Wt,m.flushPendingDeletes=Rt,m.setDelayFunction=Ft,nn.prototype.getPointee=qt,nn.prototype.destructor=en,nn.prototype.argPackAdvance=8,nn.prototype.readValueFromPointer=$t,nn.prototype.deleteObject=tn,nn.prototype.fromWireType=Bt,sn=m.UnboundTypeError=ft(Error,"UnboundTypeError"),m.count_emval_handles=Cn,m.get_first_emval=wn;var dr=[null,Ge,je,He,Qe,$e,qe,et,tt,nt,rt,it,ot,Nn,Xn,qn,er,tr,nr,rr,ir],gr={HaveOffsetConverter:function(){return"undefined"!==typeof wasmOffsetConverter},_Unwind_Backtrace:function(e,t){for(var n=function(e){var t=Je(),n=t.lastIndexOf("_emscripten_log"),r=t.lastIndexOf("_emscripten_get_callstack"),i=t.indexOf("\n",Math.max(n,r))+1;t=t.slice(i),32&e&&Be("EM_LOG_DEMANGLE is deprecated; ignoring"),8&e&&"undefined"==typeof emscripten_source_map&&(Be('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),e^=8,e|=16);var o=null;if(128&e)for(o=Ke(arguments);o[1].includes("_emscripten_");)o=Ke(o[0]);var a=t.split("\n");t="";var s=new RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),l=new RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),c=new RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var u in a){var d=a[u],g="",h="",m=0,f=0,p=c.exec(d);if(p&&5==p.length)g=p[1],h=p[2],m=p[3],f=p[4];else{if((p=s.exec(d))||(p=l.exec(d)),!(p&&p.length>=4)){t+=d+"\n";continue}g=p[1],h=p[2],m=p[3],f=0|p[4]}var C=!1;if(8&e){var w=emscripten_source_map.originalPositionFor({line:m,column:f});(C=w&&w.source)&&(64&e&&(w.source=w.source.substring(w.source.replace(/\\/g,"/").lastIndexOf("/")+1)),t+="    at "+g+" ("+w.source+":"+w.line+":"+w.column+")\n")}(16&e||!C)&&(64&e&&(h=h.substring(h.replace(/\\/g,"/").lastIndexOf("/")+1)),t+=(C?"     = "+g:"    at "+g)+" ("+h+":"+m+":"+f+")\n"),128&e&&o[0]&&(o[1]==g&&o[2].length>0&&(t=t.replace(/\s+$/,""),t+=" with values: "+o[1]+o[2]+"\n"),o=Ke(o[0]))}return t.replace(/\s+$/,"")}(),r=n.split("\n"),i=0;i<r.length;i++){if(0!==xe(e)(0,t))return}},_Unwind_GetIP:function(){R("missing function: _Unwind_GetIP"),he(-1)},__emscripten_init_main_thread_js:function(e){yr(e,!b,1,!v),Pe.threadInitTLS()},__emscripten_thread_cleanup:function(e){S?postMessage({cmd:"cleanupThread",thread:e}):Ne(e)},__pthread_create_js:ze,__syscall_fcntl64:Qe,__syscall_fstat64:$e,__syscall_getdents64:qe,__syscall_ioctl:et,__syscall_lstat64:tt,__syscall_newfstatat:nt,__syscall_openat:rt,__syscall_stat64:it,__syscall_unlinkat:ot,_dlinit:function(e){},_dlopen_js:function(e,t){he(at)},_dlsym_js:function(e,t){he(at)},_embind_register_bigint:function(e,t,n,r,i){},_embind_register_bool:function(e,t,n,r,i){var a=st(n);vt(e,{name:t=ct(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},argPackAdvance:8,readValueFromPointer:function(e){var r;if(1===n)r=o();else if(2===n)r=s();else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=c()}return this.fromWireType(r[e>>a])},destructorFunction:null})},_embind_register_class:function(e,t,n,r,i,o,a,s,l,c,u,d,g){u=ct(u),o=an(i,o),s&&(s=an(a,s)),c&&(c=an(l,c)),g=an(d,g);var h=ht(u);xt(h,(function(){cn("Cannot construct "+u+" due to unbound types",[r])})),It([e,t,n],r?[r]:[],(function(t){var n,i;t=t[0],i=r?(n=t.registeredClass).instancePrototype:jt.prototype;var a=mt(h,(function(){if(Object.getPrototypeOf(this)!==l)throw new pt("Use 'new' to construct "+u);if(void 0===d.constructor_body)throw new pt(u+" has no accessible constructor");var e=d.constructor_body[arguments.length];if(void 0===e)throw new pt("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(d.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),l=Object.create(i,{constructor:{value:a}});a.prototype=l;var d=new Kt(u,a,l,g,n,o,s,c),m=new nn(u,d,!0,!1,!1),f=new nn(u+"*",d,!1,!1,!1),p=new nn(u+" const*",d,!1,!0,!1);return Et[e]={pointerType:f,constPointerType:p},rn(h,a),[m,f,p]}))},_embind_register_class_class_function:function(e,t,n,r,i,o,a){var s=hn(n,r);t=ct(t),o=an(i,o),It([],[e],(function(e){var r=(e=e[0]).name+"."+t;function i(){cn("Cannot call "+r+" due to unbound types",s)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]);var l=e.registeredClass.constructor;return void 0===l[t]?(i.argCount=n-1,l[t]=i):(Ut(l,t,r),l[t].overloadTable[n-1]=i),It([],s,(function(e){var i=[e[0],null].concat(e.slice(1)),s=gn(r,i,null,o,a);return void 0===l[t].overloadTable?(s.argCount=n-1,l[t]=s):l[t].overloadTable[n-1]=s,[]})),[]}))},_embind_register_class_constructor:function(e,t,n,r,i,o){M(t>0);var a=hn(t,n);i=an(r,i),It([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new pt("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=()=>{cn("Cannot construct "+e.name+" due to unbound types",a)},It([],a,(function(r){return r.splice(1,0,null),e.registeredClass.constructor_body[t-1]=gn(n,r,null,i,o),[]})),[]}))},_embind_register_class_function:function(e,t,n,r,i,o,a,s){var l=hn(n,r);t=ct(t),o=an(i,o),It([],[e],(function(e){var r=(e=e[0]).name+"."+t;function i(){cn("Cannot call "+r+" due to unbound types",l)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),s&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,u=c[t];return void 0===u||void 0===u.overloadTable&&u.className!==e.name&&u.argCount===n-2?(i.argCount=n-2,i.className=e.name,c[t]=i):(Ut(c,t,r),c[t].overloadTable[n-2]=i),It([],l,(function(i){var s=gn(r,i,e,o,a);return void 0===c[t].overloadTable?(s.argCount=n-2,c[t]=s):c[t].overloadTable[n-2]=s,[]})),[]}))},_embind_register_emval:function(e,t){vt(e,{name:t=ct(t),fromWireType:function(e){var t=yn.toValue(e);return pn(e),t},toWireType:function(e,t){return yn.toHandle(t)},argPackAdvance:8,readValueFromPointer:$t,destructorFunction:null})},_embind_register_float:function(e,t,n){var r=st(n);vt(e,{name:t=ct(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:vn(t,r),destructorFunction:null})},_embind_register_function:function(e,t,n,r,i,o){var a=hn(t,n);e=ct(e),i=an(r,i),xt(e,(function(){cn("Cannot call "+e+" due to unbound types",a)}),t-1),It([],a,(function(n){var r=[n[0],null].concat(n.slice(1));return rn(e,gn(e,r,null,i,o),t-1),[]}))},_embind_register_integer:function(e,t,n,r,i){t=ct(t);var o=st(n),a=e=>e;if(0===r){var s=32-8*n;a=e=>e<<s>>>s}var l=t.includes("unsigned");vt(e,{name:t,fromWireType:a,toWireType:l?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:8,readValueFromPointer:bn(t,o,0!==r),destructorFunction:null})},_embind_register_memory_view:function(e,t,n){var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){e>>=2;var t=u(),n=t[e],i=t[e+1];return new r(N,i,n)}vt(e,{name:n=ct(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},_embind_register_std_string:function(e,t){var n="std::string"===(t=ct(t));vt(e,{name:t,fromWireType:function(e){var t,r=u()[e>>2],i=e+4;if(n)for(var o=i,s=0;s<=r;++s){var l=i+s;if(s==r||0==a()[l]){var c=Q(o,l-o);void 0===t?t=c:(t+=String.fromCharCode(0),t+=c),o=l+1}}else{var d=new Array(r);for(s=0;s<r;++s)d[s]=String.fromCharCode(a()[i+s]);t=d.join("")}return fr(e),t},toWireType:function(e,t){var r;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||Ct("Cannot pass non-string to std::string"),r=n&&i?ee(t):t.length;var o=mr(4+r+1),s=o+4;if(u()[o>>2]=r,n&&i)q(t,s,r+1);else if(i)for(var l=0;l<r;++l){var c=t.charCodeAt(l);c>255&&(fr(s),Ct("String has UTF-16 code units that do not fit in 8 bits")),a()[s+l]=c}else for(l=0;l<r;++l)a()[s+l]=t[l];return null!==e&&e.push(fr,o),o},argPackAdvance:8,readValueFromPointer:$t,destructorFunction:function(e){fr(e)}})},_embind_register_std_wstring:function(e,t,n){var r,i,o,a,s;n=ct(n),2===t?(r=Sn,i=kn,a=Zn,o=()=>l(),s=1):4===t&&(r=_n,i=En,a=Vn,o=()=>u(),s=2),vt(e,{name:n,fromWireType:function(e){for(var n,i=u()[e>>2],a=o(),l=e+4,c=0;c<=i;++c){var d=e+4+c*t;if(c==i||0==a[d>>s]){var g=r(l,d-l);void 0===n?n=g:(n+=String.fromCharCode(0),n+=g),l=d+t}}return fr(e),n},toWireType:function(e,r){"string"!=typeof r&&Ct("Cannot pass non-string to C++ string type "+n);var o=a(r),l=mr(4+o+t);return u()[l>>2]=o>>s,i(r,l+4,o+t),null!==e&&e.push(fr,l),l},argPackAdvance:8,readValueFromPointer:$t,destructorFunction:function(e){fr(e)}})},_embind_register_void:function(e,t){vt(e,{isVoid:!0,name:t=ct(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},_emscripten_default_pthread_stack_size:function(){return 2097152},_emscripten_get_now_is_monotonic:function(){return true},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((()=>Wn(r)));else if(S)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var i=Pe.pthreads[e];if(!i)return;i.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},_emval_call_void_method:function(e,t,n,r){(e=Rn[e])(t=yn.toValue(t),n=function(e){var t=Tn[e];return void 0===t?ct(e):t}(n),null,r)},_emval_decref:pn,_emval_get_method_caller:function(e,t){var n=function(e,t){for(var n=new Array(e),r=0;r<e;++r)n[r]=Gn(u()[t+4*r>>2],"parameter "+r);return n}(e,t),r=n[0],i=r.name+"_$"+n.slice(1).map((function(e){return e.name})).join("_")+"$",o=Fn[i];if(void 0!==o)return o;for(var a=["retType"],s=[r],l="",c=0;c<e-1;++c)l+=(0!==c?", ":"")+"arg"+c,a.push("argType"+c),s.push(n[1+c]);var d="return function "+ht("methodCaller_"+i)+"(handle, name, destructors, args) {\n",g=0;for(c=0;c<e-1;++c)d+="    var arg"+c+" = argType"+c+".readValueFromPointer(args"+(g?"+"+g:"")+");\n",g+=n[c+1].argPackAdvance;for(d+="    var rv = handle[name]("+l+");\n",c=0;c<e-1;++c)n[c+1].deleteObject&&(d+="    argType"+c+".deleteObject(arg"+c+");\n");return r.isVoid||(d+="    return retType.toWireType(destructors, rv);\n"),d+="};\n",a.push(d),o=function(e){var t=Rn.length;return Rn.push(e),t}(un(Function,a).apply(null,s)),Fn[i]=o,o},_emval_incref:function(e){e>4&&(fn[e].refcount+=1)},_emval_take_value:function(e,t){var n=(e=Gn(e,"_emval_take_value")).readValueFromPointer(t);return yn.toHandle(n)},_gmtime_js:function(e,t){var n=new Date(1e3*On(e));c()[t>>2]=n.getUTCSeconds(),c()[t+4>>2]=n.getUTCMinutes(),c()[t+8>>2]=n.getUTCHours(),c()[t+12>>2]=n.getUTCDate(),c()[t+16>>2]=n.getUTCMonth(),c()[t+20>>2]=n.getUTCFullYear()-1900,c()[t+24>>2]=n.getUTCDay();var r=Date.UTC(n.getUTCFullYear(),0,1,0,0,0,0),i=(n.getTime()-r)/864e5|0;c()[t+28>>2]=i},_localtime_js:function(e,t){var n=new Date(1e3*On(e));c()[t>>2]=n.getSeconds(),c()[t+4>>2]=n.getMinutes(),c()[t+8>>2]=n.getHours(),c()[t+12>>2]=n.getDate(),c()[t+16>>2]=n.getMonth(),c()[t+20>>2]=n.getFullYear()-1900,c()[t+24>>2]=n.getDay();var r=0|Mn(n);c()[t+28>>2]=r,c()[t+36>>2]=-60*n.getTimezoneOffset();var i=new Date(n.getFullYear(),0,1),o=new Date(n.getFullYear(),6,1).getTimezoneOffset(),a=i.getTimezoneOffset(),s=0|(o!=a&&n.getTimezoneOffset()==Math.min(a,o));c()[t+32>>2]=s},_mktime_js:function(e){var t=new Date(c()[e+20>>2]+1900,c()[e+16>>2],c()[e+12>>2],c()[e+8>>2],c()[e+4>>2],c()[e>>2],0),n=c()[e+32>>2],r=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),a=i.getTimezoneOffset(),s=Math.min(a,o);if(n<0)c()[e+32>>2]=Number(o!=a&&s==r);else if(n>0!=(s==r)){var l=Math.max(a,o),u=n>0?s:l;t.setTime(t.getTime()+6e4*(u-r))}c()[e+24>>2]=t.getDay();var d=0|Mn(t);return c()[e+28>>2]=d,c()[e>>2]=t.getSeconds(),c()[e+4>>2]=t.getMinutes(),c()[e+8>>2]=t.getHours(),c()[e+12>>2]=t.getDate(),c()[e+16>>2]=t.getMonth(),c()[e+20>>2]=t.getYear(),t.getTime()/1e3|0},_mmap_js:Nn,_munmap_js:Xn,_tzset_js:function(e,t,n){var r=(new Date).getFullYear(),i=new Date(r,0,1),o=new Date(r,6,1),a=i.getTimezoneOffset(),s=o.getTimezoneOffset(),l=Math.max(a,s);function d(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}u()[e>>2]=60*l,c()[t>>2]=Number(a!=s);var g=d(i),h=d(o),m=Pn(g),f=Pn(h);s<a?(u()[n>>2]=m,u()[n+4>>2]=f):(u()[n>>2]=f,u()[n+4>>2]=m)},abort:function(){he("")},emscripten_asm_const_int:function(e,t,n){var r=function(e,t){var n;for(Yn.length=0,t>>=2;n=a()[e++];)t+=105!=n&t,Yn.push(105==n?c()[t]:d()[t++>>1]),++t;return Yn}(t,n);return ve[e].apply(null,r)},emscripten_check_blocking_allowed:function(){A||b||Be("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 2147483648},emscripten_get_now:Ie,emscripten_memcpy_big:function(e,t,n){a().copyWithin(e,t,t+n)},emscripten_num_logical_cores:function(){return A?require("os").cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){xn.length=t;for(var r=n>>3,i=0;i<t;i++)xn[i]=d()[r+i];return(e<0?ve[-e-1]:dr[e]).apply(null,xn)},emscripten_resize_heap:function(e){var t=a().length;if((e>>>=0)<=t)return!1;var n=2147483648;if(e>n)return!1;let r=(e,t)=>e+(t-e%t)%t;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),Kn(Math.min(n,r(Math.max(e,o),65536))))return!0}return!1},emscripten_stack_snapshot:function(){var e=Je().split("\n");return"Error"==e[0]&&e.shift(),zn(e),Hn.last_addr=Jn(e[3]),Hn.last_stack=e,Hn.last_addr},emscripten_stack_unwind_buffer:function(e,t,n){var r;Hn.last_addr==e?r=Hn.last_stack:("Error"==(r=Je().split("\n"))[0]&&r.shift(),zn(r));for(var i=3;r[i]&&Jn(r[i])!=e;)++i;for(var o=0;o<n&&r[o+i];++o)c()[t+4*o>>2]=Jn(r[o+i]);return o},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},environ_get:qn,environ_sizes_get:er,exit:Fe,fd_close:tr,fd_read:nr,fd_seek:rr,fd_write:ir,getentropy:function e(t,n){e.randomDevice||(e.randomDevice=ke());for(var r=0;r<n;r++)o()[t+r>>0]=e.randomDevice();return 0},memory:F||m.wasmMemory,strftime_l:function(e,t,n,r,i){return sr(e,t,n,r)}};!function(){var e={env:gr,wasi_snapshot_preview1:gr};function t(e,t){var n,r,i=e.exports;m.asm=i,n=m.asm._emscripten_tls_init,Pe.tlsInitFunctions.push(n),ne=m.asm.__indirect_function_table,r=m.asm.__wasm_call_ctors,oe.unshift(r),O=t,S||ge()}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!G&&(v||b)){if("function"==typeof fetch&&!we(me))return fetch(me,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+me+"'";return e.arrayBuffer()})).catch((function(){return ye(me)}));if(p)return new Promise((function(e,t){p(me,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ye(me)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){R("failed to asynchronously prepare wasm: "+e),he(e)}))}if(S||de(),m.instantiateWasm)try{return m.instantiateWasm(e,t)}catch(Wr){R("Module.instantiateWasm callback failed with error: "+Wr),h(Wr)}(G||"function"!=typeof WebAssembly.instantiateStreaming||Ce(me)||we(me)||A||"function"!=typeof fetch?r(n):fetch(me,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return R("wasm streaming compile failed: "+e),R("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(h)}(),m.___wasm_call_ctors=function(){return(m.___wasm_call_ctors=m.asm.__wasm_call_ctors).apply(null,arguments)};var hr=m.___errno_location=function(){return(hr=m.___errno_location=m.asm.__errno_location).apply(null,arguments)},mr=m._malloc=function(){return(mr=m._malloc=m.asm.malloc).apply(null,arguments)},fr=m._free=function(){return(fr=m._free=m.asm.free).apply(null,arguments)},pr=m._pthread_self=function(){return(pr=m._pthread_self=m.asm.pthread_self).apply(null,arguments)};m.__emscripten_tls_init=function(){return(m.__emscripten_tls_init=m.asm._emscripten_tls_init).apply(null,arguments)};var Cr=m._emscripten_builtin_memalign=function(){return(Cr=m._emscripten_builtin_memalign=m.asm.emscripten_builtin_memalign).apply(null,arguments)},wr=m.___getTypeName=function(){return(wr=m.___getTypeName=m.asm.__getTypeName).apply(null,arguments)};m.__embind_initialize_bindings=function(){return(m.__embind_initialize_bindings=m.asm._embind_initialize_bindings).apply(null,arguments)},m.___dl_seterr=function(){return(m.___dl_seterr=m.asm.__dl_seterr).apply(null,arguments)};var yr=m.__emscripten_thread_init=function(){return(yr=m.__emscripten_thread_init=m.asm._emscripten_thread_init).apply(null,arguments)};m.__emscripten_thread_crashed=function(){return(m.__emscripten_thread_crashed=m.asm._emscripten_thread_crashed).apply(null,arguments)},m._emscripten_main_thread_process_queued_calls=function(){return(m._emscripten_main_thread_process_queued_calls=m.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},m._emscripten_main_browser_thread_id=function(){return(m._emscripten_main_browser_thread_id=m.asm.emscripten_main_browser_thread_id).apply(null,arguments)};var Ir=m._emscripten_run_in_main_runtime_thread_js=function(){return(Ir=m._emscripten_run_in_main_runtime_thread_js=m.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)};m._emscripten_dispatch_to_thread_=function(){return(m._emscripten_dispatch_to_thread_=m.asm.emscripten_dispatch_to_thread_).apply(null,arguments)};var vr,br=m.__emscripten_proxy_execute_task_queue=function(){return(br=m.__emscripten_proxy_execute_task_queue=m.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)},Ar=m.__emscripten_thread_free_data=function(){return(Ar=m.__emscripten_thread_free_data=m.asm._emscripten_thread_free_data).apply(null,arguments)},Sr=m.__emscripten_thread_exit=function(){return(Sr=m.__emscripten_thread_exit=m.asm._emscripten_thread_exit).apply(null,arguments)},kr=m._emscripten_stack_set_limits=function(){return(kr=m._emscripten_stack_set_limits=m.asm.emscripten_stack_set_limits).apply(null,arguments)},Zr=m.stackSave=function(){return(Zr=m.stackSave=m.asm.stackSave).apply(null,arguments)},_r=m.stackRestore=function(){return(_r=m.stackRestore=m.asm.stackRestore).apply(null,arguments)},Er=m.stackAlloc=function(){return(Er=m.stackAlloc=m.asm.stackAlloc).apply(null,arguments)};function Vr(e){if(!(ce>0)){if(S)return g(m),le(),void postMessage({cmd:"loaded"});!function(){if(m.preRun)for("function"==typeof m.preRun&&(m.preRun=[m.preRun]);m.preRun.length;)e=m.preRun.shift(),ie.unshift(e);var e;Ye(ie)}(),ce>0||(m.setStatus?(m.setStatus("Running..."),setTimeout((function(){setTimeout((function(){m.setStatus("")}),1),t()}),1)):t())}function t(){vr||(vr=!0,m.calledRun=!0,B||(le(),g(m),m.onRuntimeInitialized&&m.onRuntimeInitialized(),function(){if(!S){if(m.postRun)for("function"==typeof m.postRun&&(m.postRun=[m.postRun]);m.postRun.length;)e=m.postRun.shift(),ae.unshift(e);var e;Ye(ae)}}()))}}if(m.dynCall_jjj=function(){return(m.dynCall_jjj=m.asm.dynCall_jjj).apply(null,arguments)},m.dynCall_jiii=function(){return(m.dynCall_jiii=m.asm.dynCall_jiii).apply(null,arguments)},m.dynCall_iiiijj=function(){return(m.dynCall_iiiijj=m.asm.dynCall_iiiijj).apply(null,arguments)},m.dynCall_viijj=function(){return(m.dynCall_viijj=m.asm.dynCall_viijj).apply(null,arguments)},m.dynCall_viiijjjj=function(){return(m.dynCall_viiijjjj=m.asm.dynCall_viiijjjj).apply(null,arguments)},m.dynCall_jii=function(){return(m.dynCall_jii=m.asm.dynCall_jii).apply(null,arguments)},m.dynCall_viji=function(){return(m.dynCall_viji=m.asm.dynCall_viji).apply(null,arguments)},m.dynCall_ji=function(){return(m.dynCall_ji=m.asm.dynCall_ji).apply(null,arguments)},m.dynCall_vj=function(){return(m.dynCall_vj=m.asm.dynCall_vj).apply(null,arguments)},m.dynCall_viij=function(){return(m.dynCall_viij=m.asm.dynCall_viij).apply(null,arguments)},m.dynCall_vij=function(){return(m.dynCall_vij=m.asm.dynCall_vij).apply(null,arguments)},m.dynCall_viijii=function(){return(m.dynCall_viijii=m.asm.dynCall_viijii).apply(null,arguments)},m.dynCall_iijjiiii=function(){return(m.dynCall_iijjiiii=m.asm.dynCall_iijjiiii).apply(null,arguments)},m.dynCall_jiji=function(){return(m.dynCall_jiji=m.asm.dynCall_jiji).apply(null,arguments)},m.dynCall_iiiiij=function(){return(m.dynCall_iiiiij=m.asm.dynCall_iiiiij).apply(null,arguments)},m.dynCall_iiiiijj=function(){return(m.dynCall_iiiiijj=m.asm.dynCall_iiiiijj).apply(null,arguments)},m.dynCall_iiiiiijj=function(){return(m.dynCall_iiiiiijj=m.asm.dynCall_iiiiiijj).apply(null,arguments)},m.___start_em_js=209657,m.___stop_em_js=209718,m.addRunDependency=de,m.removeRunDependency=ge,m.FS_createPath=Te.createPath,m.FS_createDataFile=Te.createDataFile,m.FS_createPreloadedFile=Te.createPreloadedFile,m.FS_createLazyFile=Te.createLazyFile,m.FS_createDevice=Te.createDevice,m.FS_unlink=Te.unlink,m.keepRuntimeAlive=se,m.wasmMemory=F,m.ExitStatus=Ae,m.PThread=Pe,ue=function e(){vr||Vr(),vr||(ue=e)},m.preInit)for("function"==typeof m.preInit&&(m.preInit=[m.preInit]);m.preInit.length>0;)m.preInit.pop()();return Vr(),t.ready}})();const s="/tmp/",l="1.3.0",c=16e3;class u{wasmModule;constructor(e){this.wasmModule=e}static async load(e,t){const n=await a({locateFile:t=>h(e)+"/"+t,preRun:e=>{const n=["lyra_config.binarypb","soundstream_encoder.tflite","quantizer.tflite","lyragan.tflite"];for(const r of n){const n=h(t)+"/"+r;e.FS_createPreloadedFile(s,r,n,!0,!1)}}});return new u(n)}createEncoder(e={}){m(e.sampleRate),f(e.numberOfChannels),p(e.bitrate);const t=this.wasmModule.LyraEncoder.create(e.sampleRate||c,e.numberOfChannels||1,e.bitrate||9200,e.enableDtx||false,s);if(void 0===t)throw new Error("failed to create lyra encoder");{const n=20*(e.sampleRate||c)/1e3,r=this.wasmModule.newAudioData(n);return new d(this.wasmModule,t,r,e)}}createDecoder(e={}){m(e.sampleRate),f(e.numberOfChannels);const t=this.wasmModule.LyraDecoder.create(e.sampleRate||c,e.numberOfChannels||1,s);if(void 0===t)throw new Error("failed to create lyra decoder");{const n=this.wasmModule.newBytes();return new g(this.wasmModule,t,n,e)}}}class d{wasmModule;encoder;buffer;sampleRate;numberOfChannels;bitrate;enableDtx;frameSize;constructor(e,t,n,r){this.wasmModule=e,this.encoder=t,this.buffer=n,this.sampleRate=r.sampleRate||c,this.numberOfChannels=r.numberOfChannels||1,this.bitrate=r.bitrate||9200,this.enableDtx=r.enableDtx||false,this.frameSize=n.size()}encode(e){if(e.length!==this.frameSize)throw new Error(`expected an audio data with ${this.frameSize} samples, but got one with ${e.length} samples`);this.wasmModule.copyInt16ArrayToAudioData(this.buffer,e);const t=this.encoder.encode(this.buffer);if(void 0===t)throw new Error("failed to encode");try{const e=new Uint8Array(t.size());for(let n=0;n<e.length;n++)e[n]=t.get(n);if(0===e.length)return;return e}finally{t.delete()}}setBitrate(e){if(p(e),!this.encoder.setBitrate(e))throw new Error(`failed to update bitrate from ${this.bitrate} to ${e}`)}destroy(){this.encoder.delete(),this.buffer.delete()}}class g{wasmModule;decoder;buffer;sampleRate;numberOfChannels;frameSize;constructor(e,t,n,r){this.wasmModule=e,this.decoder=t,this.buffer=n,this.sampleRate=r.sampleRate||c,this.numberOfChannels=r.numberOfChannels||1,this.frameSize=20*this.sampleRate/1e3}decode(e){if(void 0!==e){this.buffer.resize(0,0);for(const t of e)this.buffer.push_back(t);if(!this.decoder.setEncodedPacket(this.buffer))throw new Error("failed to set encoded packet")}const t=this.decoder.decodeSamples(this.frameSize);if(void 0===t)throw Error("failed to decode samples");try{const e=new Int16Array(this.frameSize);return this.wasmModule.copyAudioDataToInt16Array(e,t),e}finally{t.delete()}}destroy(){this.decoder.delete(),this.buffer.delete()}}function h(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function m(e){switch(e){case void 0:case 8e3:case 16e3:case 32e3:case 48e3:return}throw new Error(`unsupported sample rate: expected one of 8000, 16000, 32000 or 48000, but got ${e}`)}function f(e){switch(e){case void 0:case 1:return}throw new Error(`unsupported number of channels: expected 1, but got ${e}`)}function p(e){switch(e){case void 0:case 3200:case 6e3:case 9200:return}throw new Error(`unsupported bitrate: expected one of 3200, 6000 or 9200, but got ${e}`)}let C,w;async function y(){if(void 0===C)throw new Error("Lyra has not been initialized. Please call `Sora.initLyra()` beforehand.");return void 0===w&&(w=await u.load(C.wasmPath,C.modelPath)),w}class I{constructor(e,t,n){if(e!==l)throw new Error(`UnsupportedLlyra version: ${e} (supported version is 1.3.0)`);if(3200!==t&&6e3!==t&&9200!==t)throw new Error(`Unsupported Lyra bitrate: ${t} (must be one of 3200, 6000, or 9200)`);this.version=e,this.bitrate=t,this.enableDtx=n}static parseMediaDescription(e){const t=/^a=fmtp:109.*[ ;]version=([0-9.]+)([;]|$)/m.exec(e);if(!t)throw new Error(`Lyra parameter 'version' is not found in media description: ${e}`);const n=/^a=fmtp:109.*[ ;]bitrate=([0-9]+)([;]|$)/m.exec(e);if(!n)throw new Error(`Lyra parameter 'bitrate' is not found in media description: ${e}`);const r=/^a=fmtp:109.*[ ;]usedtx=([01])([;]|$)/m.exec(e);if(!r)throw new Error(`Lyra parameter 'usedtx' is not found in media description: ${e}`);return new I(t[1],Number(n[1]),"1"==r[1])}toFmtpString(){return`a=fmtp:109 version=${this.version};bitrate=${this.bitrate};usedtx=${this.enableDtx?1:0}`}}class v{constructor(){this.encoderOptions={},this.midToLyraParams=new Map}processOfferSdp(e){if(!e.includes("109 lyra/"))return e;const t=this.midToLyraParams;this.midToLyraParams=new Map;const n=e.split(/^m=/m);let r=n[0];for(let i of n.slice(1)){const e=/a=mid:(.*)/.exec(i);if(null===e)continue;const n=e[1];if(i.startsWith("audio")&&i.includes("109 lyra/")){let e=t.get(n);void 0===e&&(e=I.parseMediaDescription(i)),i.includes("a=recvonly")&&(this.encoderOptions.bitrate=e.bitrate,this.encoderOptions.enableDtx=e.enableDtx),this.midToLyraParams.set(n,e),i=i.replace(/SAVPF([0-9 ]*) 109/,"SAVPF$1 109 110").replace(/109 lyra[/]16000[/]1/,"110 opus/48000/2").replace(/a=fmtp:109 .*/,"a=rtpmap:109 L16/16000\r\na=ptime:20")}r+="m="+i}return r}processAnswerSdpForLocal(e){if(!e.includes("a=rtpmap:110 "))return e;const t=e.split(/^m=/m);let n=t[0];for(let r of t.slice(1))r.startsWith("audio")&&r.includes("a=rtpmap:110 ")&&(r=r.replace(/SAVPF([0-9 ]*) 110/,"SAVPF$1 109").replace(/a=rtpmap:110 opus[/]48000[/]2/,"a=rtpmap:109 L16/16000").replace(/a=fmtp:110 .*/,"a=ptime:20")),n+="m="+r;return n}processAnswerSdpForSora(e){if(!e.includes("a=rtpmap:109 L16/16000"))return e;const t=e.split(/^m=/m);let n=t[0];for(let r of t.splice(1)){const e=/a=mid:(.*)/.exec(r);if(null===e)continue;const t=e[1];if(t&&r.startsWith("audio")&&r.includes("a=rtpmap:109 L16/16000")){const e=this.midToLyraParams.get(t);if(void 0===e)throw new Error(`Unknown audio mid ${t}`);r=r.replace(/a=rtpmap:109 L16[/]16000/,"a=rtpmap:109 lyra/16000/1").replace(/a=ptime:20/,e.toFmtpString())}n+="m="+r}return n}async createEncoder(){return await async function(e={}){return(await y()).createEncoder(e)}(this.encoderOptions)}async createDecoder(){return await async function(e={}){return(await y()).createDecoder(e)}({})}}var b=Uint8Array,A=Uint16Array,S=Uint32Array,k=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=function(e,t){for(var n=new A(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new S(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},V=E(k,2),W=V[0],T=V[1];W[28]=258,T[258]=28;for(var R=E(Z,0),G=R[0],F=R[1],O=new A(32768),L=0;L<32768;++L){var D=(43690&L)>>>1|(21845&L)<<1;D=(61680&(D=(52428&D)>>>2|(13107&D)<<2))>>>4|(3855&D)<<4,O[L]=((65280&D)>>>8|(255&D)<<8)>>>1}var B=function(e,t,n){for(var r=e.length,i=0,o=new A(t);i<r;++i)e[i]&&++o[e[i]-1];var a,s=new A(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(n){a=new A(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],d=s[e[i]-1]++<<u,g=d|(1<<u)-1;d<=g;++d)a[O[d]>>>l]=c}else for(a=new A(r),i=0;i<r;++i)e[i]&&(a[i]=O[s[e[i]-1]++]>>>15-e[i]);return a},M=new b(288);for(L=0;L<144;++L)M[L]=8;for(L=144;L<256;++L)M[L]=9;for(L=256;L<280;++L)M[L]=7;for(L=280;L<288;++L)M[L]=8;var N=new b(32);for(L=0;L<32;++L)N[L]=5;var X=B(M,9,0),P=B(M,9,1),Y=B(N,5,0),j=B(N,5,1),U=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},x=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},K=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},J=function(e){return(e+7)/8|0},H=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?A:4==e.BYTES_PER_ELEMENT?S:b)(n-t);return r.set(e.subarray(t,n)),r},z=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Q=function(e,t,n){var r=new Error(t||z[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Q),!n)throw r;return r},$=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},q=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},ee=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,o=n.slice();if(!i)return[se,0];if(1==i){var a=new b(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],l=n[1],c=0,u=1,d=2;for(n[0]={s:-1,f:s.f+l.f,l:s,r:l};u!=i-1;)s=n[n[c].f<n[d].f?c++:d++],l=n[c!=u&&n[c].f<n[d].f?c++:d++],n[u++]={s:-1,f:s.f+l.f,l:s,r:l};var g=o[0].s;for(r=1;r<i;++r)o[r].s>g&&(g=o[r].s);var h=new A(g+1),m=te(n[u-1],h,0);if(m>t){r=0;var f=0,p=m-t,C=1<<p;for(o.sort((function(e,t){return h[t.s]-h[e.s]||e.f-t.f}));r<i;++r){var w=o[r].s;if(!(h[w]>t))break;f+=C-(1<<m-h[w]),h[w]=t}for(f>>>=p;f>0;){var y=o[r].s;h[y]<t?f-=1<<t-h[y]++-1:++r}for(;r>=0&&f;--r){var I=o[r].s;h[I]==t&&(--h[I],++f)}m=t}return[new b(h),m]},te=function(e,t,n){return-1==e.s?Math.max(te(e.l,t,n+1),te(e.r,t,n+1)):t[e.s]=n},ne=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new A(++t),r=0,i=e[0],o=1,a=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(i);o=1,i=e[s]}return[n.subarray(0,r),t]},re=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},ie=function(e,t,n){var r=n.length,i=J(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<r;++o)e[i+o+4]=n[o];return 8*(i+4+r)},oe=function(e,t,n,r,i,o,a,s,l,c,u){$(t,u++,n),++i[256];for(var d=ee(i,15),g=d[0],h=d[1],m=ee(o,15),f=m[0],p=m[1],C=ne(g),w=C[0],y=C[1],I=ne(f),v=I[0],b=I[1],S=new A(19),E=0;E<w.length;++E)S[31&w[E]]++;for(E=0;E<v.length;++E)S[31&v[E]]++;for(var V=ee(S,7),W=V[0],T=V[1],R=19;R>4&&!W[_[R-1]];--R);var G,F,O,L,D=c+5<<3,P=re(i,M)+re(o,N)+a,j=re(i,g)+re(o,f)+a+14+3*R+re(S,W)+(2*S[16]+3*S[17]+7*S[18]);if(D<=P&&D<=j)return ie(t,u,e.subarray(l,l+c));if($(t,u,1+(j<P)),u+=2,j<P){G=B(g,h,0),F=g,O=B(f,p,0),L=f;var U=B(W,T,0);$(t,u,y-257),$(t,u+5,b-1),$(t,u+10,R-4),u+=14;for(E=0;E<R;++E)$(t,u+3*E,W[_[E]]);u+=3*R;for(var x=[w,v],K=0;K<2;++K){var J=x[K];for(E=0;E<J.length;++E){var H=31&J[E];$(t,u,U[H]),u+=W[H],H>15&&($(t,u,J[E]>>>5&127),u+=J[E]>>>12)}}}else G=X,F=M,O=Y,L=N;for(E=0;E<s;++E)if(r[E]>255){H=r[E]>>>18&31;q(t,u,G[H+257]),u+=F[H+257],H>7&&($(t,u,r[E]>>>23&31),u+=k[H]);var z=31&r[E];q(t,u,O[z]),u+=L[z],z>3&&(q(t,u,r[E]>>>5&8191),u+=Z[z])}else q(t,u,G[r[E]]),u+=F[r[E]];return q(t,u,G[256]),u+F[256]},ae=new S([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),se=new b(0),le=function(e,t,n,r,i){return function(e,t,n,r,i,o){var a=e.length,s=new b(r+a+5*(1+Math.ceil(a/7e3))+i),l=s.subarray(r,s.length-i),c=0;if(!t||a<8)for(var u=0;u<=a;u+=65535){var d=u+65535;d>=a&&(l[c>>3]=o),c=ie(l,c+1,e.subarray(u,d))}else{for(var g=ae[t-1],h=g>>>13,m=8191&g,f=(1<<n)-1,p=new A(32768),C=new A(f+1),w=Math.ceil(n/3),y=2*w,I=function(t){return(e[t]^e[t+1]<<w^e[t+2]<<y)&f},v=new S(25e3),_=new A(288),E=new A(32),V=0,W=0,R=(u=0,0),G=0,O=0;u<a;++u){var L=I(u),D=32767&u,B=C[L];if(p[D]=B,C[L]=D,G<=u){var M=a-u;if((V>7e3||R>24576)&&M>423){c=oe(e,l,0,v,_,E,W,R,O,u-O,c),R=V=W=0,O=u;for(var N=0;N<286;++N)_[N]=0;for(N=0;N<30;++N)E[N]=0}var X=2,P=0,Y=m,j=D-B&32767;if(M>2&&L==I(u-j))for(var U=Math.min(h,M)-1,x=Math.min(32767,u),K=Math.min(258,M);j<=x&&--Y&&D!=B;){if(e[u+X]==e[u+X-j]){for(var z=0;z<K&&e[u+z]==e[u+z-j];++z);if(z>X){if(X=z,P=j,z>U)break;var Q=Math.min(j,z-2),$=0;for(N=0;N<Q;++N){var q=u-j+N+32768&32767,ee=q-p[q]+32768&32767;ee>$&&($=ee,B=q)}}}j+=(D=B)-(B=p[D])+32768&32767}if(P){v[R++]=268435456|T[X]<<18|F[P];var te=31&T[X],ne=31&F[P];W+=k[te]+Z[ne],++_[257+te],++E[ne],G=u+X,++V}else v[R++]=e[u],++_[e[u]]}}c=oe(e,l,o,v,_,E,W,R,O,u-O,c),!o&&7&c&&(c=ie(l,c+1,se))}return H(s,0,r+J(c)+i)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)};function ce(e,t){t||(t={});var n=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,o=0|n.length,a=0;a!=o;){for(var s=Math.min(a+2655,o);a<s;++a)i+=r+=n[a];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}}();n.p(e);var r=le(e,t,2,4);return function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)}(r,t),function(e,t,n){for(;n;++t)e[t]=n,n>>>=8}(r,r.length-4,n.d()),r}function ue(e,t){return function(e,t,n){var r=e.length;if(!r||n&&n.f&&!n.l)return t||new b(0);var i=!t||n,o=!n||n.i;n||(n={}),t||(t=new b(3*r));var a=function(e){var n=t.length;if(e>n){var r=new b(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,g=n.m,h=n.n,m=8*r;do{if(!u){s=x(e,l,1);var f=x(e,l+1,3);if(l+=3,!f){var p=e[(R=J(l)+4)-4]|e[R-3]<<8,C=R+p;if(C>r){o&&Q(0);break}i&&a(c+p),t.set(e.subarray(R,C),c),n.b=c+=p,n.p=l=8*C,n.f=s;continue}if(1==f)u=P,d=j,g=9,h=5;else if(2==f){var w=x(e,l,31)+257,y=x(e,l+10,15)+4,I=w+x(e,l+5,31)+1;l+=14;for(var v=new b(I),A=new b(19),S=0;S<y;++S)A[_[S]]=x(e,l+3*S,7);l+=3*y;var E=U(A),V=(1<<E)-1,T=B(A,E,1);for(S=0;S<I;){var R,F=T[x(e,l,V)];if(l+=15&F,(R=F>>>4)<16)v[S++]=R;else{var O=0,L=0;for(16==R?(L=3+x(e,l,3),l+=2,O=v[S-1]):17==R?(L=3+x(e,l,7),l+=3):18==R&&(L=11+x(e,l,127),l+=7);L--;)v[S++]=O}}var D=v.subarray(0,w),M=v.subarray(w);g=U(D),h=U(M),u=B(D,g,1),d=B(M,h,1)}else Q(1);if(l>m){o&&Q(0);break}}i&&a(c+131072);for(var N=(1<<g)-1,X=(1<<h)-1,Y=l;;Y=l){var z=(O=u[K(e,l)&N])>>>4;if((l+=15&O)>m){o&&Q(0);break}if(O||Q(2),z<256)t[c++]=z;else{if(256==z){Y=l,u=null;break}var $=z-254;if(z>264){var q=k[S=z-257];$=x(e,l,(1<<q)-1)+W[S],l+=q}var ee=d[K(e,l)&X],te=ee>>>4;if(ee||Q(3),l+=15&ee,M=G[te],te>3&&(q=Z[te],M+=K(e,l)&(1<<q)-1,l+=q),l>m){o&&Q(0);break}i&&a(c+131072);for(var ne=c+$;c<ne;c+=4)t[c]=t[c-M],t[c+1]=t[c+1-M],t[c+2]=t[c+2-M],t[c+3]=t[c+3-M];c=ne}}n.l=u,n.p=Y,n.b=c,n.f=s,u&&(s=1,n.m=g,n.d=d,n.n=h)}while(!s);return c==t.length?t:H(t,0,c)}(((8!=(15&(n=e)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&Q(6,"invalid zlib data"),32&n[1]&&Q(6,"invalid zlib data: preset dictionaries not supported"),e.subarray(2,-4)),t);var n}var de="undefined"!=typeof TextDecoder&&new TextDecoder;try{de.decode(se,{stream:!0}),1}catch(_e){}function ge(e){if("object"!==typeof e||null===e)throw new Error("Failed to parse options dataChannels. Options dataChannels element must be type 'object'");const t=e,n={};return"string"===typeof t.label&&(n.label=t.label),"string"===typeof t.direction&&(n.direction=t.direction),"boolean"===typeof t.ordered&&(n.ordered=t.ordered),"boolean"===typeof t.compress&&(n.compress=t.compress),"number"===typeof t.maxPacketLifeTime&&(n.max_packet_life_time=t.maxPacketLifeTime),"number"===typeof t.maxRetransmits&&(n.max_retransmits=t.maxRetransmits),"string"===typeof t.protocol&&(n.protocol=t.protocol),n}function he(){return"safari"===function(){const e=window.navigator.userAgent.toLocaleLowerCase();return-1!==e.indexOf("edge")?"edge":-1!==e.indexOf("chrome")&&-1===e.indexOf("edge")?"chrome":-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")?"safari":-1!==e.indexOf("opera")?"opera":-1!==e.indexOf("firefox")?"firefox":null}()}function me(e,t,n,r,i,o){if("sendrecv"!==t&&"sendonly"!==t&&"recvonly"!==t)throw new Error("Unknown role type");if(null===n||void 0===n)throw new Error("channelId can not be null or undefined");const a={type:"connect",sora_client:"Sora JavaScript SDK 2022.3.2",environment:window.navigator.userAgent,role:t,channel_id:n,sdp:e,audio:!0,video:!0};if("sendrecv"===t&&!0!==i.multistream)throw new Error("Failed to parse options. Options multistream must be true when connecting using 'sendrecv'");!0===o&&(a.redirect=!0),"boolean"===typeof i.multistream&&(a.multistream=i.multistream),"boolean"===typeof i.simulcast&&(a.simulcast=i.simulcast);void 0!==i.simulcastRid&&0<=["r0","r1","r2"].indexOf(i.simulcastRid)&&(a.simulcast_rid=i.simulcastRid),"boolean"===typeof i.spotlight&&(a.spotlight=i.spotlight),"spotlightNumber"in i&&(a.spotlight_number=i.spotlightNumber);const s=["none","r0","r1","r2"];void 0!==i.spotlightFocusRid&&0<=s.indexOf(i.spotlightFocusRid)&&(a.spotlight_focus_rid=i.spotlightFocusRid),void 0!==i.spotlightUnfocusRid&&0<=s.indexOf(i.spotlightUnfocusRid)&&(a.spotlight_unfocus_rid=i.spotlightUnfocusRid),void 0!==r&&(a.metadata=r),void 0!==i.signalingNotifyMetadata&&(a.signaling_notify_metadata=i.signalingNotifyMetadata),void 0!==i.clientId&&(a.client_id=i.clientId),void 0!==i.bundleId&&(a.bundle_id=i.bundleId),"boolean"===typeof i.dataChannelSignaling&&(a.data_channel_signaling=i.dataChannelSignaling),"boolean"===typeof i.ignoreDisconnectWebSocket&&(a.ignore_disconnect_websocket=i.ignoreDisconnectWebSocket);const l=["audioCodecType","audioBitRate"],c=["audioOpusParamsChannels","audioOpusParamsMaxplaybackrate","audioOpusParamsStereo","audioOpusParamsSpropStereo","audioOpusParamsMinptime","audioOpusParamsPtime","audioOpusParamsUseinbandfec","audioOpusParamsUsedtx"],u=["audioLyraParamsBitrate","audioLyraParamsUsedtx"],d=["videoCodecType","videoBitRate"],g=Object.assign({},i);Object.keys(g).forEach((e=>{"audio"===e&&"boolean"===typeof g[e]||"video"===e&&"boolean"===typeof g[e]||0<=l.indexOf(e)&&null!==g[e]||0<=c.indexOf(e)&&null!==g[e]||0<=u.indexOf(e)&&null!==g[e]||0<=d.indexOf(e)&&null!==g[e]||delete g[e]})),void 0!==g.audio&&(a.audio=g.audio);const h=Object.keys(g).some((e=>0<=l.indexOf(e)));a.audio&&h&&(a.audio={},"audioCodecType"in g&&(a.audio.codec_type=g.audioCodecType),"audioBitRate"in g&&(a.audio.bit_rate=g.audioBitRate));const m=Object.keys(g).some((e=>0<=c.indexOf(e)));a.audio&&m&&("object"!=typeof a.audio&&(a.audio={}),a.audio.opus_params={},"audioOpusParamsChannels"in g&&(a.audio.opus_params.channels=g.audioOpusParamsChannels),"audioOpusParamsMaxplaybackrate"in g&&(a.audio.opus_params.maxplaybackrate=g.audioOpusParamsMaxplaybackrate),"audioOpusParamsStereo"in g&&(a.audio.opus_params.stereo=g.audioOpusParamsStereo),"audioOpusParamsSpropStereo"in g&&(a.audio.opus_params.sprop_stereo=g.audioOpusParamsSpropStereo),"audioOpusParamsMinptime"in g&&(a.audio.opus_params.minptime=g.audioOpusParamsMinptime),"audioOpusParamsPtime"in g&&(a.audio.opus_params.ptime=g.audioOpusParamsPtime),"audioOpusParamsUseinbandfec"in g&&(a.audio.opus_params.useinbandfec=g.audioOpusParamsUseinbandfec),"audioOpusParamsUsedtx"in g&&(a.audio.opus_params.usedtx=g.audioOpusParamsUsedtx)),a.audio&&"LYRA"==i.audioCodecType&&("object"!=typeof a.audio&&(a.audio={}),a.audio.lyra_params={version:"1.3.0"},"audioLyraParamsBitrate"in g&&(a.audio.lyra_params.bitrate=g.audioLyraParamsBitrate),"audioLyraParamsUsedtx"in g&&(a.audio.lyra_params.usedtx=g.audioLyraParamsUsedtx)),void 0!==g.video&&(a.video=g.video);const f=Object.keys(g).some((e=>0<=d.indexOf(e)));if(a.video&&f&&(a.video={},"videoCodecType"in g&&(a.video.codec_type=g.videoCodecType),"videoBitRate"in g&&(a.video.bit_rate=g.videoBitRate)),a.simulcast&&!function(){if(!window.RTCRtpSender)return!1;if(!RTCRtpSender.getCapabilities)return!1;const e=RTCRtpSender.getCapabilities("video");if(!e)return!1;const t=e.headerExtensions.map((e=>e.uri));return["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"].every((e=>t.includes(e)))}()&&"recvonly"!==t)throw new Error("Simulcast can not be used with this browser");if("boolean"===typeof i.e2ee&&(a.e2ee=i.e2ee),!0===i.e2ee){if(void 0===a.signaling_notify_metadata&&(a.signaling_notify_metadata={}),null===a.signaling_notify_metadata||"object"!==typeof a.signaling_notify_metadata)throw new Error("E2EE failed. Options signalingNotifyMetadata must be type 'object'");!0===a.video&&(a.video={}),a.video&&(a.video.codec_type="VP8")}return Array.isArray(i.dataChannels)&&0<i.dataChannels.length&&(a.data_channels=function(e){const t=[];for(const n of e)t.push(ge(n));return t}(i.dataChannels)),void 0!==i.audioStreamingLanguageCode&&(a.audio_streaming_language_code=i.audioStreamingLanguageCode),a}function fe(e){return void 0!==e.authn_metadata?e.authn_metadata:void 0!==e.metadata?e.metadata:null}function pe(e){return"object"===typeof e&&null!==e&&"pre_key_bundle"in e?e.pre_key_bundle:null}class Ce extends Error{}function we(e,t,n){const r=new Event(e);try{r.data=JSON.parse(JSON.stringify(t))}catch(i){r.data=t}return r.transportType=n,r}function ye(e,t,n,r,i){const o=new Event(e);try{o.data=JSON.parse(JSON.stringify(t))}catch(a){o.data=t}return o.logType=n,o.dataChannelId=r,o.dataChannelLabel=i,o}function Ie(e){const t=new Event("datachannel");return t.datachannel=e,t}function ve(e,t){if(t){const t=ue(new Uint8Array(e));return(new TextDecoder).decode(t)}return e}class be{constructor(e,t,n,r,i,o){this.midToAudioCodecType=new Map,this.senderStreamInitialized=new WeakSet,this.role=t,this.channelId=n,this.metadata=r,this.signalingUrlCandidates=e,this.options=i,this.connectionTimeout=6e4,"number"===typeof this.options.timeout&&(console.warn("@deprecated timeout option will be removed in a future version. Use connectionTimeout."),this.connectionTimeout=this.options.timeout),"number"===typeof this.options.connectionTimeout&&(this.connectionTimeout=this.options.connectionTimeout),this.disconnectWaitTimeout=3e3,"number"===typeof this.options.disconnectWaitTimeout&&(this.disconnectWaitTimeout=this.options.disconnectWaitTimeout),this.signalingCandidateTimeout=3e3,"number"===typeof this.options.signalingCandidateTimeout&&(this.signalingCandidateTimeout=this.options.signalingCandidateTimeout),this.constraints=null,this.debug=o,this.clientId=null,this.connectionId=null,this.remoteConnectionIds=[],this.stream=null,this.ws=null,this.pc=null,this.encodings=[],this.callbacks={disconnect:()=>{},push:()=>{},addstream:()=>{},track:()=>{},removestream:()=>{},removetrack:()=>{},notify:()=>{},log:()=>{},timeout:()=>{},timeline:()=>{},signaling:()=>{},message:()=>{},datachannel:()=>{}},this.authMetadata=null,this.e2ee=null,this.connectionTimeoutTimerId=0,this.monitorSignalingWebSocketEventTimerId=0,this.monitorIceConnectionStateChangeTimerId=0,this.soraDataChannels={},this.mids={audio:"",video:""},this.signalingSwitched=!1,this.signalingOfferMessageDataChannels={},this.connectedSignalingUrl="",this.contactSignalingUrl="",void 0!==C&&(this.lyra=new v)}on(e,t){"addstream"===e?console.warn("@deprecated addstream callback will be removed in a future version. Use track callback."):"removestream"===e&&console.warn("@deprecated removestream callback will be removed in a future version. Use removetrack callback."),e in this.callbacks&&(this.callbacks[e]=t)}stopAudioTrack(e){for(const t of e.getAudioTracks())t.enabled=!1;return new Promise((t=>{setTimeout((async()=>{for(const t of e.getAudioTracks())if(t.stop(),e.removeTrack(t),null!==this.pc){const e=this.pc.getSenders().find((e=>e.track&&e.track.id===t.id));e&&await e.replaceTrack(null)}t()}),100)}))}stopVideoTrack(e){for(const t of e.getVideoTracks())t.enabled=!1;return new Promise((t=>{setTimeout((async()=>{for(const t of e.getVideoTracks())if(t.stop(),e.removeTrack(t),null!==this.pc){const e=this.pc.getSenders().find((e=>e.track&&e.track.id===t.id));e&&await e.replaceTrack(null)}t()}),100)}))}async replaceAudioTrack(e,t){await this.stopAudioTrack(e);const n=this.getAudioTransceiver();if(null===n)throw new Error("Unable to set an audio track. Audio track sender is undefined");e.addTrack(t),await n.sender.replaceTrack(t),await this.setupSenderTransform(n.sender)}async replaceVideoTrack(e,t){await this.stopVideoTrack(e);const n=this.getVideoTransceiver();if(null===n)throw new Error("Unable to set video track. Video track sender is undefined");e.addTrack(t),await n.sender.replaceTrack(t),await this.setupSenderTransform(n.sender)}signalingTerminate(){for(const e of Object.keys(this.soraDataChannels)){const t=this.soraDataChannels[e];t&&t.close(),delete this.soraDataChannels[e]}this.ws&&(this.ws.close(),this.ws=null),this.pc&&this.pc.close(),this.e2ee&&this.e2ee.terminateWorker(),this.initializeConnection()}abendPeerConnectionState(e){this.clearMonitorIceConnectionStateChange(),this.pc&&(this.pc.ondatachannel=null,this.pc.oniceconnectionstatechange=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null),this.ws&&(this.ws.onclose=e=>{this.writeWebSocketTimelineLog("onclose",{code:e.code,reason:e.reason})},this.ws.onmessage=null,this.ws.onerror=null);for(const n of Object.keys(this.soraDataChannels)){const e=this.soraDataChannels[n];e&&(e.onclose=e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onclose",t),this.trace("CLOSE DATA CHANNEL",t.label)},e.onmessage=null,e.onerror=null)}for(const n of Object.keys(this.soraDataChannels)){const e=this.soraDataChannels[n];e&&e.close(),delete this.soraDataChannels[n]}this.ws&&(this.ws.close(),this.ws=null),this.pc&&this.pc.close(),this.e2ee&&this.e2ee.terminateWorker(),this.initializeConnection();const t=this.soraCloseEvent("abend",e);this.callbacks.disconnect(t),this.writeSoraTimelineLog("disconnect-abend",t)}async abend(e,t){this.clearMonitorIceConnectionStateChange(),this.pc&&(this.pc.ondatachannel=null,this.pc.oniceconnectionstatechange=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null),this.ws&&(this.ws.onclose=e=>{this.writeWebSocketTimelineLog("onclose",{code:e.code,reason:e.reason})},this.ws.onmessage=null,this.ws.onerror=null);for(const r of Object.keys(this.soraDataChannels)){const e=this.soraDataChannels[r];e&&(e.onclose=e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onclose",t),this.trace("CLOSE DATA CHANNEL",t.label)},e.onmessage=null,e.onerror=null)}if(this.soraDataChannels.signaling){const t={type:"disconnect",reason:e};if(this.signalingOfferMessageDataChannels.signaling&&!0===this.signalingOfferMessageDataChannels.signaling.compress){const e=ce((new TextEncoder).encode(JSON.stringify(t)),{});if("open"===this.soraDataChannels.signaling.readyState)try{this.soraDataChannels.signaling.send(e),this.writeDataChannelSignalingLog("send-disconnect",this.soraDataChannels.signaling,t)}catch(_e){const t=_e.message;this.writeDataChannelSignalingLog("failed-to-send-disconnect",this.soraDataChannels.signaling,t)}}else if("open"===this.soraDataChannels.signaling.readyState)try{this.soraDataChannels.signaling.send(JSON.stringify(t)),this.writeDataChannelSignalingLog("send-disconnect",this.soraDataChannels.signaling,t)}catch(_e){const t=_e.message;this.writeDataChannelSignalingLog("failed-to-send-disconnect",this.soraDataChannels.signaling,t)}}for(const r of Object.keys(this.soraDataChannels)){const e=this.soraDataChannels[r];e&&(e.onerror=null,e.close()),delete this.soraDataChannels[r]}if(await this.disconnectWebSocket(e),await this.disconnectPeerConnection(),this.e2ee&&this.e2ee.terminateWorker(),this.initializeConnection(),"WEBSOCKET-ONCLOSE"===e&&t&&(1e3===t.code||1005===t.code)){const e=this.soraCloseEvent("normal","DISCONNECT",t);return this.writeSoraTimelineLog("disconnect-normal",e),void this.callbacks.disconnect(e)}const n=this.soraCloseEvent("abend",e,t);this.writeSoraTimelineLog("disconnect-abend",n),this.callbacks.disconnect(this.soraCloseEvent("abend",e,t))}initializeConnection(){this.clientId=null,this.connectionId=null,this.remoteConnectionIds=[],this.stream=null,this.ws=null,this.pc=null,this.encodings=[],this.authMetadata=null,this.e2ee=null,this.soraDataChannels={},this.mids={audio:"",video:""},this.signalingSwitched=!1,this.signalingOfferMessageDataChannels={},this.contactSignalingUrl="",this.connectedSignalingUrl="",this.clearConnectionTimeout()}disconnectWebSocket(e){let t=0;return this.signalingSwitched?(this.ws&&(this.ws.close(),this.ws=null),Promise.resolve(null)):new Promise(((n,r)=>{if(!this.ws)return n(null);if(this.ws.onclose=e=>(this.ws&&(this.ws.close(),this.ws=null),clearTimeout(t),this.writeWebSocketTimelineLog("onclose",{code:e.code,reason:e.reason}),n({code:e.code,reason:e.reason})),1!==this.ws.readyState)return this.ws.close(),this.ws=null,n(null);{const r={type:"disconnect",reason:e};this.ws.send(JSON.stringify(r)),this.writeWebSocketSignalingLog("send-disconnect",r),t=setTimeout((()=>{this.ws&&(this.ws.close(),this.ws=null),n({code:1006,reason:""})}),this.disconnectWaitTimeout)}}))}disconnectDataChannel(){const e=()=>{for(const e of Object.keys(this.soraDataChannels)){const t=this.soraDataChannels[e];t&&(t.onerror=null,t.close()),delete this.soraDataChannels[e]}};return new Promise(((t,n)=>{if(!this.soraDataChannels.signaling)return e(),t({code:4999,reason:""});const r=setTimeout((()=>(e(),n())),this.disconnectWaitTimeout),i=[];for(const a of Object.keys(this.soraDataChannels)){const n=this.soraDataChannels[a];if(n){n.onerror=()=>(clearTimeout(r),e(),t({code:4999,reason:""}));const o=()=>new Promise(((e,t)=>{let r=0;const i=setInterval((()=>{r++,"closed"===n.readyState&&(clearInterval(i),e()),this.disconnectWaitTimeout<100*r&&(e(),clearInterval(i))}),100)}));i.push(o())}}Promise.all(i).then((()=>{0===Object.keys(this.soraDataChannels).length?t(null):t({code:4999,reason:""})})).finally((()=>{e(),clearTimeout(r)}));const o={type:"disconnect",reason:"NO-ERROR"};if(this.signalingOfferMessageDataChannels.signaling&&!0===this.signalingOfferMessageDataChannels.signaling.compress){const e=ce((new TextEncoder).encode(JSON.stringify(o)),{});if("open"===this.soraDataChannels.signaling.readyState)try{this.soraDataChannels.signaling.send(e),this.writeDataChannelSignalingLog("send-disconnect",this.soraDataChannels.signaling,o)}catch(_e){const t=_e.message;this.writeDataChannelSignalingLog("failed-to-send-disconnect",this.soraDataChannels.signaling,t)}}else if("open"===this.soraDataChannels.signaling.readyState)try{this.soraDataChannels.signaling.send(JSON.stringify(o)),this.writeDataChannelSignalingLog("send-disconnect",this.soraDataChannels.signaling,o)}catch(_e){const t=_e.message;this.writeDataChannelSignalingLog("failed-to-send-disconnect",this.soraDataChannels.signaling,t)}}))}disconnectPeerConnection(){return new Promise(((e,t)=>(this.pc&&"closed"!==this.pc.connectionState&&this.pc.close(),e())))}async disconnect(){this.clearMonitorIceConnectionStateChange(),this.pc&&(this.pc.ondatachannel=null,this.pc.oniceconnectionstatechange=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null),this.ws&&(this.ws.onclose=e=>{this.writeWebSocketTimelineLog("onclose",{code:e.code,reason:e.reason})},this.ws.onmessage=null,this.ws.onerror=null);for(const n of Object.keys(this.soraDataChannels)){const e=this.soraDataChannels[n];e&&(e.onmessage=null,e.onclose=e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onclose",t),this.trace("CLOSE DATA CHANNEL",t.label)})}let e=null;if(this.signalingSwitched){try{const t=await this.disconnectDataChannel();null!==t&&(e=this.soraCloseEvent("normal","DISCONNECT",t))}catch(t){e=this.soraCloseEvent("abend","DISCONNECT-TIMEOUT")}await this.disconnectWebSocket("NO-ERROR"),await this.disconnectPeerConnection()}else{const t=await this.disconnectWebSocket("NO-ERROR");await this.disconnectPeerConnection(),null!==t&&(e=this.soraCloseEvent("normal","DISCONNECT",t))}this.e2ee&&this.e2ee.terminateWorker(),this.initializeConnection(),e&&("abend"===e.type?this.writeSoraTimelineLog("disconnect-abend",e):"normal"===e.type&&this.writeSoraTimelineLog("disconnect-normal",e),this.callbacks.disconnect(e))}setupE2EE(){!0===this.options.e2ee&&(this.e2ee=new o,this.e2ee.onWorkerDisconnect=async()=>{await this.abend("INTERNAL-ERROR",{reason:"CRASH-E2EE-WORKER"})},this.e2ee.startWorker())}startE2EE(){if(!0===this.options.e2ee&&this.e2ee){if(!this.connectionId){const e=new Error;throw e.message="E2EE failed. Self connectionId is null",e}this.e2ee.clearWorker();const e=this.e2ee.start(this.connectionId);this.e2ee.postSelfSecretKeyMaterial(this.connectionId,e.selfKeyId,e.selfSecretKeyMaterial)}}async getSignalingWebSocket(e){if("string"===typeof e){const t=e;return new Promise(((e,n)=>{const r=new WebSocket(t);r.onclose=e=>{const t=new Ce(`Signaling failed. CloseEventCode:${e.code} CloseEventReason:'${e.reason}'`);t.code=e.code,t.reason=e.reason,this.writeWebSocketTimelineLog("onclose",t),n(t)},r.onopen=t=>{e(r)}}))}if(Array.isArray(e)){let t=!1;const n=e=>new Promise(((n,r)=>{const i=new WebSocket(e),o=setTimeout((()=>{this.writeWebSocketSignalingLog("signaling-url-candidate",{type:"timeout",url:i.url}),i&&!t&&(i.onclose=null,i.onerror=null,i.onopen=null,i.close(),r())}),this.signalingCandidateTimeout);i.onclose=e=>{this.writeWebSocketSignalingLog("signaling-url-candidate",{type:"close",url:i.url,message:"WebSocket closed",code:e.code,reason:e.reason}),i&&i.close(),clearInterval(o),r()},i.onerror=e=>{this.writeWebSocketSignalingLog("signaling-url-candidate",{type:"error",url:i.url,message:"Failed to connect WebSocket"}),i&&(i.onclose=null,i.close()),clearInterval(o),r()},i.onopen=e=>{i&&(clearInterval(o),t?(this.writeWebSocketSignalingLog("signaling-url-candidate",{type:"open",url:i.url,selected:!1}),i.onerror=null,i.onclose=null,i.onopen=null,i.close(),r()):(this.writeWebSocketSignalingLog("signaling-url-candidate",{type:"open",url:i.url,selected:!0}),i.onerror=null,i.onclose=null,i.onopen=null,t=!0,n(i)))}}));try{return await Promise.any(e.map((e=>n(e))))}catch(_e){throw new Ce("Signaling failed. All signaling URL candidates failed to connect")}}throw new Ce("Signaling failed. Invalid format signaling URL candidates")}async signaling(e,t=!1){const n=await this.createOffer();return this.trace("CREATE OFFER",n),new Promise(((r,i)=>{this.writeWebSocketSignalingLog("new-websocket",e.url),e.binaryType="arraybuffer",e.onclose=e=>{const t=new Ce(`Signaling failed. CloseEventCode:${e.code} CloseEventReason:'${e.reason}'`);t.code=e.code,t.reason=e.reason,this.writeWebSocketTimelineLog("onclose",t),this.signalingTerminate(),i(t)},e.onmessage=async t=>{if(t.data instanceof ArrayBuffer)return this.writeWebSocketSignalingLog("onmessage-e2ee",t.data),void this.signalingOnMessageE2EE(t.data);if("string"!==typeof t.data)throw new Error("Received invalid signaling data");const n=JSON.parse(t.data);if("offer"==n.type)this.writeWebSocketSignalingLog("onmessage-offer",n),this.signalingOnMessageTypeOffer(n),this.connectedSignalingUrl=e.url,r(n);else if("update"==n.type)this.writeWebSocketSignalingLog("onmessage-update",n),await this.signalingOnMessageTypeUpdate(n);else if("re-offer"==n.type)this.writeWebSocketSignalingLog("onmessage-re-offer",n),await this.signalingOnMessageTypeReOffer(n);else if("ping"==n.type)await this.signalingOnMessageTypePing(n);else if("push"==n.type)this.callbacks.push(n,"websocket");else if("notify"==n.type)"connection.created"===n.event_type?this.writeWebSocketTimelineLog("notify-connection.created",n):"connection.destroyed"===n.event_type&&this.writeWebSocketTimelineLog("notify-connection.destroyed",n),this.signalingOnMessageTypeNotify(n,"websocket");else if("switched"==n.type)this.writeWebSocketSignalingLog("onmessage-switched",n),this.signalingOnMessageTypeSwitched(n);else if("redirect"==n.type){this.writeWebSocketSignalingLog("onmessage-redirect",n);try{const e=await this.signalingOnMessageTypeRedirect(n);r(e)}catch(o){i(o)}}},(async()=>{let r;try{r=me(n.sdp||"",this.role,this.channelId,this.metadata,this.options,t)}catch(o){return void i(o)}if(r.e2ee&&this.e2ee){const e=await this.e2ee.init();r.signaling_notify_metadata.pre_key_bundle=e}this.trace("SIGNALING CONNECT MESSAGE",r),e&&(e.send(JSON.stringify(r)),this.writeWebSocketSignalingLog(`send-${r.type}`,r),this.ws=e,t||(this.contactSignalingUrl=e.url,this.writeWebSocketSignalingLog("contact-signaling-url",this.contactSignalingUrl)))})()}))}async connectPeerConnection(e){let t=Object.assign({},e.config);if((this.e2ee||this.lyra)&&(t=Object.assign({encodedInsertableStreams:!0},t)),void 0!==window.RTCPeerConnection.generateCertificate){const e=await window.RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"});t=Object.assign({certificates:[e]},t)}this.trace("PEER CONNECTION CONFIG",t),this.writePeerConnectionTimelineLog("new-peerconnection",t),this.pc=new window.RTCPeerConnection(t,this.constraints),this.pc.oniceconnectionstatechange=e=>{this.pc&&(this.writePeerConnectionTimelineLog("oniceconnectionstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState}),this.trace("ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE",this.pc.iceConnectionState))},this.pc.onicegatheringstatechange=e=>{this.pc&&this.writePeerConnectionTimelineLog("onicegatheringstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState})},this.pc.onconnectionstatechange=e=>{this.pc&&this.writePeerConnectionTimelineLog("onconnectionstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState})},this.pc.ondatachannel=e=>{this.onDataChannel(e)}}async setRemoteDescription(e){if(!this.pc)return;const t=this.processOfferSdp(e.sdp),n=new RTCSessionDescription({type:"offer",sdp:t});await this.pc.setRemoteDescription(n),this.writePeerConnectionTimelineLog("set-remote-description",n)}async createAnswer(e){if(!this.pc)return;for(const n of Object.values(this.mids)){const e=this.pc.getTransceivers().find((e=>e.mid===n));e&&"recvonly"===e.direction&&(e.direction="sendrecv")}if(this.options.simulcast&&("sendrecv"===this.role||"sendonly"===this.role)){const t=this.pc.getTransceivers().find((e=>{if(null!==e.mid&&null!==e.sender.track&&(null===e.currentDirection||"sendonly"===e.currentDirection))return""!==this.mids.video&&this.mids.video===e.mid||0<=e.mid.indexOf("video")?e:void 0}));if(t){await this.setSenderParameters(t,this.encodings),await this.setRemoteDescription(e),this.trace("TRANSCEIVER SENDER GET_PARAMETERS",t.sender.getParameters()),await this.setSenderParameters(t,this.encodings);const n=await this.pc.createAnswer();return void 0!==n.sdp&&(n.sdp=this.processAnswerSdpForLocal(n.sdp)),await this.pc.setLocalDescription(n),void this.trace("TRANSCEIVER SENDER GET_PARAMETERS",t.sender.getParameters())}}const t=await this.pc.createAnswer();void 0!==t.sdp&&(t.sdp=this.processAnswerSdpForLocal(t.sdp)),this.writePeerConnectionTimelineLog("create-answer",t),await this.pc.setLocalDescription(t),this.writePeerConnectionTimelineLog("set-local-description",t)}processOfferSdp(e){if(void 0===this.lyra||!e.includes("109 lyra/"))return e;this.midToAudioCodecType.clear();for(const t of e.split(/^m=/m).slice(1)){if(!t.startsWith("audio"))continue;const e=/a=mid:(.*)/.exec(t);if(e){const n=t.includes("109 lyra/")?"LYRA":"OPUS";this.midToAudioCodecType.set(e[1],n)}}return this.lyra.processOfferSdp(e)}processAnswerSdpForLocal(e){return void 0===this.lyra?e:this.lyra.processAnswerSdpForLocal(e)}processAnswerSdpForSora(e){return void 0===this.lyra?e:this.lyra.processAnswerSdpForSora(e)}async setupSenderTransform(e){if(null===this.e2ee&&void 0===this.lyra||null===e.track)return;if(this.senderStreamInitialized.has(e))return;const t=e.createEncodedStreams(),n="audio"===e.track.kind&&"LYRA"===this.options.audioCodecType;let r=t.readable;if(n&&void 0!==this.lyra){const e=await this.lyra.createEncoder(),n=new TransformStream({transform:(t,n)=>function(e,t,n){const r=new DataView(t.data),i=new Int16Array(t.data.byteLength/2);for(let a=0;a<t.data.byteLength;a+=2)i[a/2]=r.getInt16(a,!1);const o=e.encode(i);void 0!==o&&(t.data=o.buffer,n.enqueue(t))}(e,t,n)});r=t.readable.pipeThrough(n)}this.e2ee?this.e2ee.setupSenderTransform(r,t.writable):r.pipeTo(t.writable).catch((e=>console.warn(e))),this.senderStreamInitialized.add(e)}async setupReceiverTransform(e,t){if(null===this.e2ee&&void 0===this.lyra)return;const n=t.createEncodedStreams(),r=this.midToAudioCodecType.get(e||"");let i=n.writable;if("LYRA"==r&&void 0!==this.lyra){const e=await this.lyra.createDecoder(),t=new TransformStream({transform:(t,n)=>function(e,t,n){if(0===t.data.byteLength)return;if(3===t.data.byteLength)return;const r=e.decode(new Uint8Array(t.data)),i=new ArrayBuffer(2*r.length),o=new DataView(i);for(const[a,s]of r.entries())o.setInt16(2*a,s,!1);t.data=i,n.enqueue(t)}(e,t,n)});t.readable.pipeTo(n.writable).catch((e=>console.warn(e))),i=t.writable}this.e2ee?this.e2ee.setupReceiverTransform(n.readable,i):n.readable.pipeTo(i).catch((e=>console.warn(e)))}sendAnswer(){if(this.pc&&this.ws&&this.pc.localDescription){this.trace("ANSWER SDP",this.pc.localDescription.sdp);const e={type:"answer",sdp:this.processAnswerSdpForSora(this.pc.localDescription.sdp)};this.ws.send(JSON.stringify(e)),this.writeWebSocketSignalingLog("send-answer",e)}}onIceCandidate(){return new Promise(((e,t)=>{this.pc&&(this.pc.oniceconnectionstatechange=t=>{this.pc&&(this.writePeerConnectionTimelineLog("oniceconnectionstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState}),this.trace("ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE",this.pc.iceConnectionState),"connected"===this.pc.iceConnectionState&&e())},this.pc.onicecandidate=t=>{if(this.writePeerConnectionTimelineLog("onicecandidate",t.candidate),this.pc&&this.trace("ONICECANDIDATE ICEGATHERINGSTATE",this.pc.iceGatheringState),null===t.candidate)e();else{const e=t.candidate.toJSON(),n=Object.assign(e,{type:"candidate"});this.trace("ONICECANDIDATE CANDIDATE MESSAGE",n),this.sendSignalingMessage(n)}})}))}waitChangeConnectionStateConnected(){return new Promise(((e,t)=>{if(this.pc&&void 0===this.pc.connectionState)return void e();const n=setInterval((()=>{if(this.pc)this.pc&&"connected"===this.pc.connectionState&&(clearInterval(n),e());else{const e=new Error;e.message="PeerConnection connectionState did not change to 'connected'",clearInterval(n),t(e)}}),10)}))}monitorSignalingWebSocketEvent(){return new Promise(((e,t)=>{this.monitorSignalingWebSocketEventTimerId=setInterval((()=>{this.ws&&(this.clearMonitorSignalingWebSocketEvent(),this.ws.onclose=e=>{const n=new Ce(`Signaling failed. CloseEventCode:${e.code} CloseEventReason:'${e.reason}'`);n.code=e.code,n.reason=e.reason,this.writeWebSocketTimelineLog("onclose",n),this.signalingTerminate(),t(n)},this.ws.onerror=e=>{const n=new Ce("Signaling failed. WebSocket onerror was called");this.writeWebSocketSignalingLog("onerror",n),this.signalingTerminate(),t(n)})}),100)}))}monitorWebSocketEvent(){this.ws&&(this.ws.onclose=async e=>{this.writeWebSocketTimelineLog("onclose",{code:e.code,reason:e.reason}),await this.abend("WEBSOCKET-ONCLOSE",{code:e.code,reason:e.reason})},this.ws.onerror=async e=>{this.writeWebSocketSignalingLog("onerror"),await this.abend("WEBSOCKET-ONERROR")})}monitorPeerConnectionState(){this.pc&&(this.pc.oniceconnectionstatechange=e=>{this.pc&&void 0===this.pc.connectionState&&(this.writePeerConnectionTimelineLog("oniceconnectionstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState}),this.trace("ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE",this.pc.iceConnectionState),clearTimeout(this.monitorIceConnectionStateChangeTimerId),"failed"===this.pc.iceConnectionState?this.abendPeerConnectionState("ICE-CONNECTION-STATE-FAILED"):"disconnected"===this.pc.iceConnectionState&&(this.monitorIceConnectionStateChangeTimerId=setTimeout((()=>{this.pc&&"disconnected"===this.pc.iceConnectionState&&this.abendPeerConnectionState("ICE-CONNECTION-STATE-DISCONNECTED-TIMEOUT")}),1e4)))},this.pc.onconnectionstatechange=e=>{this.pc&&(this.writePeerConnectionTimelineLog("onconnectionstatechange",{connectionState:this.pc.connectionState,iceConnectionState:this.pc.iceConnectionState,iceGatheringState:this.pc.iceGatheringState}),"failed"===this.pc.connectionState&&this.abendPeerConnectionState("CONNECTION-STATE-FAILED"))})}setConnectionTimeout(){return new Promise(((e,t)=>{0<this.connectionTimeout&&(this.connectionTimeoutTimerId=setTimeout((()=>{if(!this.pc||this.pc&&void 0!==this.pc.connectionState&&"connected"!==this.pc.connectionState){const e=new Error;e.message="Signaling connection timeout",this.callbacks.timeout(),this.trace("DISCONNECT","Signaling connection timeout"),this.writePeerConnectionTimelineLog("signaling-connection-timeout",{connectionTimeout:this.connectionTimeout}),this.signalingTerminate(),t(e)}}),this.connectionTimeout))}))}clearConnectionTimeout(){clearTimeout(this.connectionTimeoutTimerId)}clearMonitorSignalingWebSocketEvent(){clearInterval(this.monitorSignalingWebSocketEventTimerId)}clearMonitorIceConnectionStateChange(){clearInterval(this.monitorIceConnectionStateChangeTimerId)}trace(e,t){this.callbacks.log(e,t),this.debug&&function(e,t,n){const r=e=>{if(e&&"object"===typeof e){let n=null;try{n=Object.keys(JSON.parse(JSON.stringify(e)))}catch(t){}n&&Array.isArray(n)?n.forEach((t=>{console.group(t),r(e[t]),console.groupEnd()})):console.info(e)}else console.info(e)};let i="";window.performance&&(i="["+(window.performance.now()/1e3).toFixed(3)+"]"),e&&(i=i+"["+e+"]"),void 0!==console.info&&void 0!==console.group?(console.group(i+" "+t),r(n),console.groupEnd()):console.log(i+" "+t+"\n",n)}(this.clientId,e,t)}writeWebSocketSignalingLog(e,t){this.callbacks.signaling(we(e,t,"websocket")),this.writeWebSocketTimelineLog(e,t)}writeDataChannelSignalingLog(e,t,n){this.callbacks.signaling(we(e,n,"datachannel")),this.writeDataChannelTimelineLog(e,t,n)}writeWebSocketTimelineLog(e,t){const n=ye(e,t,"websocket");this.callbacks.timeline(n)}writeDataChannelTimelineLog(e,t,n){const r=ye(e,n,"datachannel",t.id,t.label);this.callbacks.timeline(r)}writePeerConnectionTimelineLog(e,t){const n=ye(e,t,"peerconnection");this.callbacks.timeline(n)}writeSoraTimelineLog(e,t){const n=ye(e,t,"sora");this.callbacks.timeline(n)}async createOffer(){const e=new window.RTCPeerConnection({iceServers:[]});if(he()){e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"});const t=await e.createOffer();return e.close(),this.writePeerConnectionTimelineLog("create-offer",t),t}const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});return e.close(),this.writePeerConnectionTimelineLog("create-offer",t),t}signalingOnMessageE2EE(e){if(this.e2ee){const t=new Uint8Array(e),n=this.e2ee.receiveMessage(t);this.e2ee.postRemoteSecretKeyMaterials(n),n.messages.forEach((e=>{this.sendE2EEMessage(e.buffer)}))}}signalingOnMessageTypeOffer(e){if(this.clientId=e.client_id,this.connectionId=e.connection_id,void 0!==e.metadata&&(this.authMetadata=e.metadata),Array.isArray(e.encodings)&&(this.encodings=e.encodings),void 0!==e.mid&&void 0!==e.mid.audio&&(this.mids.audio=e.mid.audio),void 0!==e.mid&&void 0!==e.mid.video&&(this.mids.video=e.mid.video),e.data_channels)for(const t of e.data_channels)this.signalingOfferMessageDataChannels[t.label]=t;this.trace("SIGNALING OFFER MESSAGE",e),this.trace("OFFER SDP",e.sdp)}sendUpdateAnswer(){this.pc&&this.ws&&this.pc.localDescription&&(this.trace("ANSWER SDP",this.pc.localDescription.sdp),this.sendSignalingMessage({type:"update",sdp:this.pc.localDescription.sdp}))}sendReAnswer(){this.pc&&this.pc.localDescription&&(this.trace("RE ANSWER SDP",this.pc.localDescription.sdp),this.sendSignalingMessage({type:"re-answer",sdp:this.pc.localDescription.sdp}))}async signalingOnMessageTypeUpdate(e){this.trace("SIGNALING UPDATE MESSGE",e),this.trace("UPDATE SDP",e.sdp),await this.setRemoteDescription(e),await this.createAnswer(e),this.sendUpdateAnswer()}async signalingOnMessageTypeReOffer(e){this.trace("SIGNALING RE OFFER MESSGE",e),this.trace("RE OFFER SDP",e.sdp),await this.setRemoteDescription(e),await this.createAnswer(e),this.sendReAnswer()}async signalingOnMessageTypePing(e){const t={type:"pong"};if(e.stats){const e=await this.getStats();t.stats=e}this.ws&&this.ws.send(JSON.stringify(t))}signalingOnMessageTypeNotify(e,t){if("connection.created"===e.event_type){const t=e.connection_id;if(this.connectionId!==t){const n=pe(fe(e));if(n&&this.e2ee&&t){const e=this.e2ee.startSession(t,n);this.e2ee.postRemoteSecretKeyMaterials(e),e.messages.forEach((e=>{this.sendE2EEMessage(e.buffer)})),this.e2ee.postSelfSecretKeyMaterial(e.selfConnectionId,e.selfKeyId,e.selfSecretKeyMaterial)}}const n=function(e){return e.data&&Array.isArray(e.data)?e.data:e.metadata_list&&Array.isArray(e.metadata_list)?e.metadata_list:[]}(e);n.forEach((e=>{const t=pe(fe(e)),n=e.connection_id;n&&this.e2ee&&t&&this.e2ee.addPreKeyBundle(n,t)}))}else if("connection.destroyed"===e.event_type){const t=pe(fe(e)),n=e.connection_id;if(t&&this.e2ee&&n){const e=this.e2ee.stopSession(n);this.e2ee.postSelfSecretKeyMaterial(e.selfConnectionId,e.selfKeyId,e.selfSecretKeyMaterial,5e3),e.messages.forEach((e=>{this.sendE2EEMessage(e.buffer)})),this.e2ee.postRemoveRemoteDeriveKey(n)}}this.callbacks.notify(e,t)}signalingOnMessageTypeSwitched(e){if(this.signalingSwitched=!0,this.ws){e.ignore_disconnect_websocket&&(this.ws&&(this.ws.onclose=null,this.ws.close(),this.ws=null),this.writeWebSocketSignalingLog("close"));for(const e of this.datachannels)this.callbacks.datachannel(Ie(e))}}async signalingOnMessageTypeRedirect(e){this.ws&&(this.ws.onclose=null,this.ws.onerror=null,this.ws.close(),this.ws=null);const t=await this.getSignalingWebSocket(e.location);return await this.signaling(t,!0)}async setSenderParameters(e,t){const n=e.sender.getParameters();n.encodings=t,await e.sender.setParameters(n),this.trace("TRANSCEIVER SENDER SET_PARAMETERS",n),this.writePeerConnectionTimelineLog("transceiver-sender-set-parameters",n)}async getStats(){const e=[];if(!this.pc)return e;return(await this.pc.getStats()).forEach((t=>{e.push(t)})),e}onDataChannel(e){const t=e.channel;var n;t.bufferedAmountLowThreshold=65536,t.binaryType="arraybuffer",this.soraDataChannels[t.label]=t,this.writeDataChannelTimelineLog("ondatachannel",t,{binaryType:(n=t).binaryType,bufferedAmount:n.bufferedAmount,bufferedAmountLowThreshold:n.bufferedAmountLowThreshold,id:n.id,label:n.label,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,negotiated:n.negotiated,ordered:n.ordered,protocol:n.protocol,readyState:n.readyState,reliable:n.reliable}),e.channel.onbufferedamountlow=e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onbufferedamountlow",t)},e.channel.onopen=e=>{const t=e.currentTarget;this.trace("OPEN DATA CHANNEL",t.label),"signaling"===t.label&&this.ws?this.writeDataChannelSignalingLog("onopen",t):this.writeDataChannelTimelineLog("onopen",t)},e.channel.onclose=async e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onclose",t),this.trace("CLOSE DATA CHANNEL",t.label),await this.disconnect()},e.channel.onerror=async e=>{const t=e.currentTarget;this.writeDataChannelTimelineLog("onerror",t),this.trace("ERROR DATA CHANNEL",t.label),await this.abend("DATA-CHANNEL-ONERROR",{params:{label:t.label}})},"signaling"===e.channel.label?e.channel.onmessage=async e=>{const t=e.currentTarget,n=t.label,r=this.signalingOfferMessageDataChannels[n];if(!r)return void console.warn(`Received onmessage event for '${n}' DataChannel. But '${n}' DataChannel settings doesn't exist`);const i=ve(e.data,r.compress),o=JSON.parse(i);this.writeDataChannelSignalingLog(`onmessage-${o.type}`,t,o),"re-offer"===o.type&&await this.signalingOnMessageTypeReOffer(o)}:"notify"===e.channel.label?e.channel.onmessage=e=>{const t=e.currentTarget,n=t.label,r=this.signalingOfferMessageDataChannels[n];if(!r)return void console.warn(`Received onmessage event for '${n}' DataChannel. But '${n}' DataChannel settings doesn't exist`);const i=ve(e.data,r.compress),o=JSON.parse(i);"connection.created"===o.event_type?this.writeDataChannelTimelineLog("notify-connection.created",t,o):"connection.destroyed"===o.event_type&&this.writeDataChannelTimelineLog("notify-connection.destroyed",t,o),this.signalingOnMessageTypeNotify(o,"datachannel")}:"push"===e.channel.label?e.channel.onmessage=e=>{const t=e.currentTarget.label,n=this.signalingOfferMessageDataChannels[t];if(!n)return void console.warn(`Received onmessage event for '${t}' DataChannel. But '${t}' DataChannel settings doesn't exist`);const r=ve(e.data,n.compress),i=JSON.parse(r);this.callbacks.push(i,"datachannel")}:"e2ee"===e.channel.label?e.channel.onmessage=e=>{const t=e.currentTarget,n=e.data;this.signalingOnMessageE2EE(n),this.writeDataChannelSignalingLog("onmessage-e2ee",t,n)}:"stats"===e.channel.label?e.channel.onmessage=async e=>{const t=e.currentTarget.label,n=this.signalingOfferMessageDataChannels[t];if(!n)return void console.warn(`Received onmessage event for '${t}' DataChannel. But '${t}' DataChannel settings doesn't exist`);const r=ve(e.data,n.compress);if("req-stats"===JSON.parse(r).type){const e=await this.getStats();this.sendStatsMessage(e)}}:/^#.*/.exec(e.channel.label)&&(e.channel.onmessage=e=>{if(null===e.currentTarget)return;const t=e.currentTarget.label,n=this.signalingOfferMessageDataChannels[t];if(!n)return void console.warn(`Received onmessage event for '${t}' DataChannel. But '${t}' DataChannel settings doesn't exist`);const r=e.target;let i;"string"===typeof e.data?i=(new TextEncoder).encode(e.data):e.data instanceof ArrayBuffer?i=e.data:console.warn("Received onmessage event data is not of type String or ArrayBuffer."),void 0!==i&&(!0===n.compress&&(i=ue(new Uint8Array(i)).buffer),this.callbacks.message(function(e,t){const n=new Event("message");return n.label=e,n.data=t,n}(r.label,i)))})}sendSignalingMessage(e){if(this.soraDataChannels.signaling){if(this.signalingOfferMessageDataChannels.signaling&&!0===this.signalingOfferMessageDataChannels.signaling.compress){const t=ce((new TextEncoder).encode(JSON.stringify(e)),{});this.soraDataChannels.signaling.send(t)}else this.soraDataChannels.signaling.send(JSON.stringify(e));this.writeDataChannelSignalingLog(`send-${e.type}`,this.soraDataChannels.signaling,e)}else null!==this.ws&&(this.ws.send(JSON.stringify(e)),this.writeWebSocketSignalingLog(`send-${e.type}`,e))}sendE2EEMessage(e){this.soraDataChannels.e2ee?(this.soraDataChannels.e2ee.send(e),this.writeDataChannelSignalingLog("send-e2ee",this.soraDataChannels.e2ee,e)):null!==this.ws&&(this.ws.send(e),this.writeWebSocketSignalingLog("send-e2ee",e))}sendStatsMessage(e){if(this.soraDataChannels.stats){const t={type:"stats",reports:e};if(this.signalingOfferMessageDataChannels.stats&&!0===this.signalingOfferMessageDataChannels.stats.compress){const e=ce((new TextEncoder).encode(JSON.stringify(t)),{});this.soraDataChannels.stats.send(e)}else this.soraDataChannels.stats.send(JSON.stringify(t))}}getAudioTransceiver(){if(this.pc&&this.mids.audio){return this.pc.getTransceivers().find((e=>e.mid===this.mids.audio))||null}return null}getVideoTransceiver(){if(this.pc&&this.mids.video){return this.pc.getTransceivers().find((e=>e.mid===this.mids.video))||null}return null}soraCloseEvent(e,t,n){const r=class extends Event{constructor(e,t,n){super(e),n&&(n.code&&(this.code=n.code),n.reason&&(this.reason=n.reason),n.params&&(this.params=n.params)),this.title=t}};return new r(e,t,n)}sendMessage(e,t){const n=this.soraDataChannels[e];if(null===this.pc)return;if(void 0===n)throw new Error("Could not find DataChannel");if("open"!==n.readyState)throw new Error("Messaging DataChannel is not open");const r=this.signalingOfferMessageDataChannels[e];if(void 0!==r&&!0===r.compress){const e=ce(t,{});n.send(e)}else n.send(t)}get e2eeSelfFingerprint(){if(this.options.e2ee&&this.e2ee)return this.e2ee.selfFingerprint()}get e2eeRemoteFingerprints(){if(this.options.e2ee&&this.e2ee)return this.e2ee.remoteFingerprints()}get audio(){return null!==this.getAudioTransceiver()}get video(){return null!==this.getVideoTransceiver()}get signalingUrl(){return this.signalingUrlCandidates}get datachannels(){if(!this.signalingSwitched)return[];const e=Object.keys(this.signalingOfferMessageDataChannels).filter((e=>/^#.*/.exec(e))),t=[];for(const n of e){const e=this.soraDataChannels[n];if(!e)continue;const r=this.signalingOfferMessageDataChannels[n];if(!r)continue;const i={label:e.label,ordered:e.ordered,protocol:e.protocol,compress:r.compress,direction:r.direction};"number"===typeof e.maxPacketLifeTime&&(i.maxPacketLifeTime=e.maxPacketLifeTime),"number"===typeof e.maxRetransmits&&(i.maxRetransmits=e.maxRetransmits),t.push(i)}return t}}class Ae extends be{async connect(e){return this.options.multistream?await Promise.race([this.multiStream(e).finally((()=>{this.clearConnectionTimeout(),this.clearMonitorSignalingWebSocketEvent()})),this.setConnectionTimeout(),this.monitorSignalingWebSocketEvent()]):await Promise.race([this.singleStream(e).finally((()=>{this.clearConnectionTimeout(),this.clearMonitorSignalingWebSocketEvent()})),this.setConnectionTimeout(),this.monitorSignalingWebSocketEvent()]),this.monitorWebSocketEvent(),this.monitorPeerConnectionState(),e}async singleStream(e){await this.disconnect(),this.setupE2EE();const t=await this.getSignalingWebSocket(this.signalingUrlCandidates),n=await this.signaling(t);if(this.startE2EE(),await this.connectPeerConnection(n),await this.setRemoteDescription(n),e.getTracks().forEach((t=>{this.pc&&this.pc.addTrack(t,e)})),this.pc)for(const r of this.pc.getSenders())await this.setupSenderTransform(r);return this.stream=e,await this.createAnswer(n),this.sendAnswer(),await this.onIceCandidate(),await this.waitChangeConnectionStateConnected(),e}async multiStream(e){await this.disconnect(),this.setupE2EE();const t=await this.getSignalingWebSocket(this.signalingUrlCandidates),n=await this.signaling(t);if(this.startE2EE(),await this.connectPeerConnection(n),this.pc&&(this.pc.ontrack=async e=>{await this.setupReceiverTransform(e.transceiver.mid,e.receiver);const t=e.streams[0];if(!t)return;const n={"stream.id":t.id,id:e.track.id,label:e.track.label,enabled:e.track.enabled,kind:e.track.kind,muted:e.track.muted,readyState:e.track.readyState};this.writePeerConnectionTimelineLog("ontrack",n),"default"!==t.id&&t.id!==this.connectionId&&(this.callbacks.track(e),t.onremovetrack=e=>{if(this.callbacks.removetrack(e),e.target){const t=this.remoteConnectionIds.indexOf(e.target.id);-1<t&&(delete this.remoteConnectionIds[t],e.stream=e.target,this.callbacks.removestream(e))}},-1<this.remoteConnectionIds.indexOf(t.id)||(e.stream=t,this.remoteConnectionIds.push(t.id),this.callbacks.addstream(e)))}),await this.setRemoteDescription(n),e.getTracks().forEach((t=>{this.pc&&this.pc.addTrack(t,e)})),this.pc)for(const r of this.pc.getSenders())await this.setupSenderTransform(r);return this.stream=e,await this.createAnswer(n),this.sendAnswer(),await this.onIceCandidate(),await this.waitChangeConnectionStateConnected(),e}}class Se extends be{async connect(){if(this.options.multistream)return await Promise.race([this.multiStream().finally((()=>{this.clearConnectionTimeout(),this.clearMonitorSignalingWebSocketEvent()})),this.setConnectionTimeout(),this.monitorSignalingWebSocketEvent()]),this.monitorWebSocketEvent(),void this.monitorPeerConnectionState();{const e=await Promise.race([this.singleStream().finally((()=>{this.clearConnectionTimeout(),this.clearMonitorSignalingWebSocketEvent()})),this.setConnectionTimeout(),this.monitorSignalingWebSocketEvent()]);return this.monitorWebSocketEvent(),this.monitorPeerConnectionState(),e}}async singleStream(){await this.disconnect(),this.setupE2EE();const e=await this.getSignalingWebSocket(this.signalingUrlCandidates),t=await this.signaling(e);return this.startE2EE(),await this.connectPeerConnection(t),this.pc&&(this.pc.ontrack=async e=>{await this.setupReceiverTransform(e.transceiver.mid,e.receiver),this.stream=e.streams[0];const t=this.stream.id;if("default"===t)return;const n={"stream.id":t,id:e.track.id,label:e.track.label,enabled:e.track.enabled,kind:e.track.kind,muted:e.track.muted,readyState:e.track.readyState};this.writePeerConnectionTimelineLog("ontrack",n),this.callbacks.track(e),this.stream.onremovetrack=e=>{if(this.callbacks.removetrack(e),e.target){const t=e.target.id,n=this.remoteConnectionIds.indexOf(t);-1<n&&(delete this.remoteConnectionIds[n],e.stream=e.target,this.callbacks.removestream(e))}},-1<this.remoteConnectionIds.indexOf(t)||(e.stream=this.stream,this.remoteConnectionIds.push(t),this.callbacks.addstream(e))}),await this.setRemoteDescription(t),await this.createAnswer(t),this.sendAnswer(),await this.onIceCandidate(),await this.waitChangeConnectionStateConnected(),this.stream||new MediaStream}async multiStream(){await this.disconnect(),this.setupE2EE();const e=await this.getSignalingWebSocket(this.signalingUrlCandidates),t=await this.signaling(e);this.startE2EE(),await this.connectPeerConnection(t),this.pc&&(this.pc.ontrack=async e=>{await this.setupReceiverTransform(e.transceiver.mid,e.receiver);const t=e.streams[0];if("default"===t.id)return;if(t.id===this.connectionId)return;const n={"stream.id":t.id,id:e.track.id,label:e.track.label,enabled:e.track.enabled,kind:e.track.kind,muted:e.track.muted,readyState:e.track.readyState};this.writePeerConnectionTimelineLog("ontrack",n),this.callbacks.track(e),t.onremovetrack=e=>{if(this.callbacks.removetrack(e),e.target){const t=e.target.id,n=this.remoteConnectionIds.indexOf(t);-1<n&&(delete this.remoteConnectionIds[n],e.stream=e.target,this.callbacks.removestream(e))}},-1<this.remoteConnectionIds.indexOf(t.id)||(e.stream=t,this.remoteConnectionIds.push(t.id),this.callbacks.addstream(e))}),await this.setRemoteDescription(t),await this.createAnswer(t),this.sendAnswer(),await this.onIceCandidate(),await this.waitChangeConnectionStateConnected()}}class ke{constructor(e,t=!1){this.signalingUrlCandidates=e,this.debug=t}sendrecv(e,t=null,n={audio:!0,video:!0}){const r=Object.assign({multistream:!0},n);return new Ae(this.signalingUrlCandidates,"sendrecv",e,t,r,this.debug)}sendonly(e,t=null,n={audio:!0,video:!0}){return new Ae(this.signalingUrlCandidates,"sendonly",e,t,n,this.debug)}recvonly(e,t=null,n={audio:!0,video:!0}){return new Se(this.signalingUrlCandidates,"recvonly",e,t,n,this.debug)}get signalingUrl(){return this.signalingUrlCandidates}}var Ze={initE2EE:async function(e){await o.loadWasm(e)},initLyra:function(e){return"createEncodedStreams"in RTCRtpSender.prototype?"undefined"===typeof SharedArrayBuffer?(console.warn("Lyra requires cross-origin isolation to use SharedArrayBuffer."),!1):(C=e,w=void 0,!0):(console.warn("This browser doesn't support WebRTC Encoded Transform feature that Lyra requires."),!1)},connection:function(e,t=!1){return new ke(e,t)},version:function(){return"2022.3.2"},helpers:{applyMediaStreamConstraints:async function(e,t){if(t.audio&&"boolean"!==typeof t.audio)for(const n of e.getAudioTracks())await n.applyConstraints(t.audio);if(t.video&&"boolean"!==typeof t.video)for(const n of e.getVideoTracks())await n.applyConstraints(t.video)}}}}}]);